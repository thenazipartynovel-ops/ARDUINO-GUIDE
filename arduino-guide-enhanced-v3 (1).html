<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Arduino: The Complete Beginner's Guide</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0e1a;
    --bg2: #0f1526;
    --bg3: #161d35;
    --surface: #1a2240;
    --border: #2a3560;
    --accent: #00d4ff;
    --accent2: #ff6b35;
    --accent3: #7c3aed;
    --green: #00ff88;
    --yellow: #ffd700;
    --text: #e8eaf6;
    --muted: #8892b0;
    --card: #1e2a4a;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  html { scroll-behavior: smooth; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Syne', sans-serif;
    overflow-x: hidden;
  }

  /* ── SCROLLBAR ── */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: var(--bg); }
  ::-webkit-scrollbar-thumb { background: var(--accent3); border-radius: 3px; }

  /* ── NAV ── */
  nav {
    position: fixed; top: 0; left: 0; right: 0; z-index: 1000;
    background: rgba(10,14,26,0.92);
    backdrop-filter: blur(16px);
    border-bottom: 1px solid var(--border);
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 2rem; height: 60px;
  }
  .nav-logo {
    font-family: 'Space Mono', monospace;
    font-size: 1.1rem; font-weight: 700;
    color: var(--accent);
    display: flex; align-items: center; gap: .5rem;
  }
  .nav-logo span { color: var(--accent2); }
  .nav-links {
    display: flex; gap: .25rem;
    list-style: none;
  }
  .nav-links a {
    color: var(--muted);
    text-decoration: none;
    font-size: .75rem; font-weight: 600;
    letter-spacing: .05em;
    text-transform: uppercase;
    padding: .4rem .7rem;
    border-radius: 6px;
    transition: all .2s;
  }
  .nav-links a:hover { color: var(--accent); background: rgba(0,212,255,.08); }
  .progress-bar {
    position: fixed; top: 60px; left: 0; height: 2px;
    background: linear-gradient(90deg, var(--accent), var(--accent3));
    z-index: 999; transition: width .1s;
    width: 0%;
  }

  /* ── HERO ── */
  #hero {
    min-height: 100vh;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    text-align: center;
    padding: 80px 2rem 4rem;
    position: relative;
    overflow: hidden;
  }
  .hero-grid {
    position: absolute; inset: 0;
    background-image:
      linear-gradient(rgba(0,212,255,.04) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,212,255,.04) 1px, transparent 1px);
    background-size: 50px 50px;
    animation: gridScroll 20s linear infinite;
  }
  @keyframes gridScroll {
    0% { transform: translate(0,0); }
    100% { transform: translate(50px,50px); }
  }
  .hero-glow {
    position: absolute; width: 600px; height: 600px;
    background: radial-gradient(circle, rgba(0,212,255,.12) 0%, transparent 70%);
    top: 50%; left: 50%; transform: translate(-50%,-50%);
    animation: pulse 4s ease-in-out infinite;
  }
  @keyframes pulse { 0%,100% { opacity: .6; transform: translate(-50%,-50%) scale(1); } 50% { opacity: 1; transform: translate(-50%,-50%) scale(1.1); } }

  .hero-badge {
    display: inline-flex; align-items: center; gap: .5rem;
    background: rgba(0,212,255,.1);
    border: 1px solid rgba(0,212,255,.3);
    border-radius: 100px;
    padding: .4rem 1rem;
    font-size: .75rem; letter-spacing: .1em; text-transform: uppercase;
    color: var(--accent); font-family: 'Space Mono', monospace;
    margin-bottom: 2rem;
    animation: fadeUp .8s ease both;
  }
  .hero-badge .dot { width: 6px; height: 6px; border-radius: 50%; background: var(--green); animation: blink 1.5s infinite; }
  @keyframes blink { 0%,100% { opacity: 1; } 50% { opacity: .2; } }

  h1.hero-title {
    font-size: clamp(3rem, 8vw, 6.5rem);
    font-weight: 800;
    line-height: .95;
    margin-bottom: 1.5rem;
    animation: fadeUp .8s .1s ease both;
  }
  .hero-title .line1 { display: block; color: var(--text); }
  .hero-title .line2 { display: block; color: var(--accent); }
  .hero-title .line3 { display: block; color: var(--accent2); font-size: .7em; }

  .hero-sub {
    font-size: 1.1rem; color: var(--muted); max-width: 550px;
    line-height: 1.7; margin-bottom: 2.5rem;
    animation: fadeUp .8s .2s ease both;
  }
  .hero-btns {
    display: flex; gap: 1rem; flex-wrap: wrap; justify-content: center;
    animation: fadeUp .8s .3s ease both;
    margin-bottom: 4rem;
  }
  .btn-primary {
    background: var(--accent); color: var(--bg);
    padding: .8rem 2rem; border-radius: 8px;
    font-family: 'Space Mono', monospace; font-size: .85rem; font-weight: 700;
    text-decoration: none; border: none; cursor: pointer;
    transition: all .2s;
    letter-spacing: .05em;
  }
  .btn-primary:hover { background: #00b8d9; transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,212,255,.3); }
  .btn-secondary {
    background: transparent; color: var(--text);
    padding: .8rem 2rem; border-radius: 8px;
    font-family: 'Space Mono', monospace; font-size: .85rem; font-weight: 700;
    text-decoration: none; border: 1px solid var(--border); cursor: pointer;
    transition: all .2s;
  }
  .btn-secondary:hover { border-color: var(--accent); color: var(--accent); transform: translateY(-2px); }

  .hero-stats {
    display: flex; gap: 3rem; flex-wrap: wrap; justify-content: center;
    animation: fadeUp .8s .4s ease both;
  }
  .stat { text-align: center; }
  .stat-num { font-family: 'Space Mono', monospace; font-size: 2rem; font-weight: 700; color: var(--accent); }
  .stat-label { font-size: .75rem; color: var(--muted); letter-spacing: .1em; text-transform: uppercase; }

  /* ── ARDUINO VISUAL ── */
  .arduino-visual {
    position: relative; width: 300px; height: 200px; margin: 3rem auto;
    animation: fadeUp .8s .5s ease both;
  }
  .board {
    width: 280px; height: 170px;
    background: linear-gradient(135deg, #1a7a4a 0%, #0d5c35 100%);
    border-radius: 12px;
    border: 2px solid #2ca86e;
    position: relative;
    box-shadow: 0 20px 60px rgba(0,0,0,.5), 0 0 40px rgba(44,168,110,.2);
  }
  .pin-row {
    position: absolute; display: flex; gap: 4px;
  }
  .pin-row.top { top: -8px; left: 20px; }
  .pin-row.bottom { bottom: -8px; left: 40px; }
  .pin {
    width: 8px; height: 16px;
    background: linear-gradient(to bottom, #d4a853, #a07830);
    border-radius: 2px;
    box-shadow: 0 0 4px rgba(212,168,83,.5);
    animation: pinGlow 2s ease-in-out infinite alternate;
  }
  .pin:nth-child(odd) { animation-delay: .2s; }
  @keyframes pinGlow { 0% { box-shadow: 0 0 2px rgba(212,168,83,.3); } 100% { box-shadow: 0 0 8px rgba(212,168,83,.8); } }
  .chip {
    position: absolute;
    background: #1a1a1a;
    border: 1px solid #444;
    border-radius: 4px;
    display: flex; align-items: center; justify-content: center;
    font-family: 'Space Mono', monospace;
    font-size: .35rem; color: #888;
    letter-spacing: .03em;
  }
  .chip.main { width: 60px; height: 50px; top: 55px; left: 100px; }
  .chip.small1 { width: 24px; height: 18px; top: 20px; right: 30px; }
  .chip.small2 { width: 18px; height: 12px; top: 100px; right: 50px; }
  .led { width: 8px; height: 8px; border-radius: 50%; position: absolute; }
  .led.power { background: var(--green); top: 30px; left: 20px; box-shadow: 0 0 8px var(--green); animation: ledBlink 1.5s infinite; }
  .led.tx { background: #ff6600; top: 45px; left: 20px; box-shadow: 0 0 6px #ff6600; animation: ledBlink 2s .3s infinite; }
  .led.rx { background: #ff6600; top: 60px; left: 20px; box-shadow: 0 0 6px #ff6600; animation: ledBlink 2s .6s infinite; }
  .led.l { background: var(--yellow); top: 30px; left: 35px; box-shadow: 0 0 6px var(--yellow); animation: ledBlink 3s .5s infinite; }
  @keyframes ledBlink { 0%,100% { opacity: 1; } 50% { opacity: .3; } }
  .usb-port {
    position: absolute; bottom: 20px; left: -18px;
    width: 18px; height: 30px;
    background: linear-gradient(to right, #888, #aaa, #888);
    border-radius: 3px 0 0 3px;
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* ── SECTIONS ── */
  section {
    padding: 6rem 2rem;
    max-width: 1100px;
    margin: 0 auto;
  }
  .section-tag {
    display: inline-block;
    font-family: 'Space Mono', monospace;
    font-size: .7rem; letter-spacing: .15em; text-transform: uppercase;
    color: var(--accent); background: rgba(0,212,255,.08);
    border: 1px solid rgba(0,212,255,.2);
    padding: .3rem .8rem; border-radius: 100px;
    margin-bottom: 1rem;
  }
  h2.section-title {
    font-size: clamp(2rem, 4vw, 3.5rem);
    font-weight: 800; line-height: 1.1;
    margin-bottom: 1rem;
  }
  h2.section-title em { color: var(--accent); font-style: normal; }
  .section-sub { color: var(--muted); font-size: 1rem; line-height: 1.7; max-width: 600px; margin-bottom: 3rem; }

  /* ── CARDS ── */
  .cards-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px,1fr)); gap: 1.5rem; }
  .card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 2rem;
    transition: all .3s;
    position: relative; overflow: hidden;
  }
  .card::before {
    content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px;
    background: linear-gradient(90deg, var(--accent), var(--accent3));
    transform: scaleX(0); transform-origin: left;
    transition: transform .3s;
  }
  .card:hover { transform: translateY(-4px); border-color: rgba(0,212,255,.3); box-shadow: 0 20px 40px rgba(0,0,0,.3); }
  .card:hover::before { transform: scaleX(1); }
  .card-icon { font-size: 2rem; margin-bottom: 1rem; }
  .card h3 { font-size: 1.1rem; font-weight: 700; margin-bottom: .5rem; }
  .card p { color: var(--muted); font-size: .9rem; line-height: 1.6; }

  /* ── DIVIDER ── */
  .section-divider {
    width: 100%; height: 1px;
    background: linear-gradient(90deg, transparent, var(--border), transparent);
    margin: 0;
  }

  /* ── CIRCUIT ANIMATOR ── */
  .circuit-demo {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 2rem;
    margin-top: 2rem;
  }
  .circuit-tabs {
    display: flex; gap: .5rem; margin-bottom: 2rem; flex-wrap: wrap;
  }
  .circuit-tab {
    padding: .5rem 1rem;
    border-radius: 8px;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--muted);
    font-family: 'Space Mono', monospace; font-size: .75rem;
    cursor: pointer; transition: all .2s;
  }
  .circuit-tab.active { background: var(--accent); color: var(--bg); border-color: var(--accent); }
  .circuit-canvas-wrap {
    width: 100%; height: 320px;
    background: var(--bg);
    border-radius: 12px; border: 1px solid var(--border);
    position: relative; overflow: hidden;
    display: flex; align-items: center; justify-content: center;
  }
  canvas#circuitCanvas { display: block; }

  .circuit-info {
    display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1.5rem;
  }
  .circuit-info-box {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 10px; padding: 1rem;
  }
  .circuit-info-box h4 { font-size: .8rem; color: var(--accent); font-family: 'Space Mono', monospace; text-transform: uppercase; letter-spacing: .1em; margin-bottom: .5rem; }
  .circuit-info-box ul { list-style: none; }
  .circuit-info-box ul li { font-size: .85rem; color: var(--muted); padding: .2rem 0; }
  .circuit-info-box ul li::before { content: '→ '; color: var(--accent2); }

  /* ── CODE EDITOR ── */
  .code-editor {
    background: #0d1117;
    border: 1px solid var(--border);
    border-radius: 16px;
    overflow: hidden;
    margin-top: 2rem;
  }
  .editor-header {
    background: #161b22;
    padding: .75rem 1.25rem;
    display: flex; align-items: center; justify-content: space-between;
    border-bottom: 1px solid var(--border);
  }
  .editor-dots { display: flex; gap: .4rem; }
  .editor-dot { width: 12px; height: 12px; border-radius: 50%; }
  .dot-red { background: #ff5f57; }
  .dot-yellow { background: #febc2e; }
  .dot-green { background: #28c840; }
  .editor-title { font-family: 'Space Mono', monospace; font-size: .75rem; color: var(--muted); }
  .editor-tabs { display: flex; gap: .25rem; }
  .editor-tab-btn {
    padding: .3rem .8rem; border-radius: 6px; font-size: .75rem;
    font-family: 'Space Mono', monospace; cursor: pointer;
    border: 1px solid var(--border); background: transparent; color: var(--muted);
    transition: all .2s;
  }
  .editor-tab-btn.active { background: var(--accent3); color: white; border-color: var(--accent3); }
  .code-snippets { padding: 0; }
  .code-snippet { display: none; }
  .code-snippet.active { display: block; }
  .editor-body {
    display: flex; min-height: 280px;
  }
  .line-nums {
    background: #0d1117;
    padding: 1.25rem .75rem 1.25rem .5rem;
    font-family: 'JetBrains Mono', monospace; font-size: .82rem;
    color: #444; line-height: 1.7;
    text-align: right; user-select: none;
    border-right: 1px solid #1e2430;
    min-width: 40px;
  }
  .code-area {
    flex: 1;
    padding: 1.25rem 1.5rem;
    font-family: 'JetBrains Mono', monospace; font-size: .82rem;
    line-height: 1.7; overflow-x: auto;
  }
  .code-area code { white-space: pre; display: block; }
  .kw { color: #ff79c6; }
  .fn { color: #50fa7b; }
  .str { color: #f1fa8c; }
  .num { color: #bd93f9; }
  .cmt { color: #6272a4; font-style: italic; }
  .type { color: #8be9fd; }
  .op { color: #ff79c6; }
  .var { color: #e8eaf6; }
  .editor-run-bar {
    background: #161b22;
    padding: .75rem 1.25rem;
    display: flex; align-items: center; justify-content: space-between;
    border-top: 1px solid var(--border);
  }
  .run-btn {
    background: var(--green); color: #000;
    border: none; border-radius: 6px;
    padding: .4rem 1.2rem;
    font-family: 'Space Mono', monospace; font-size: .75rem; font-weight: 700;
    cursor: pointer; transition: all .2s;
  }
  .run-btn:hover { background: #00e67a; }
  .output-box {
    background: #0a0e1a;
    border-top: 1px solid var(--border);
    padding: .75rem 1.25rem;
    font-family: 'JetBrains Mono', monospace; font-size: .8rem;
    color: var(--green); min-height: 50px;
    display: none;
  }
  .output-box.visible { display: block; }

  /* ── COMPONENTS TABLE ── */
  .components-grid {
    display: grid; grid-template-columns: repeat(auto-fill, minmax(200px,1fr)); gap: 1rem;
    margin-top: 2rem;
  }
  .component-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 1.25rem;
    text-align: center;
    cursor: pointer;
    transition: all .3s;
  }
  .component-card:hover { transform: scale(1.04); border-color: var(--accent); }
  .component-card.selected { border-color: var(--accent); background: rgba(0,212,255,.05); }
  .component-icon { font-size: 2.5rem; margin-bottom: .75rem; display: block; }
  .component-name { font-weight: 700; font-size: .9rem; margin-bottom: .25rem; }
  .component-desc { font-size: .75rem; color: var(--muted); }
  .component-detail {
    background: var(--card); border: 1px solid var(--accent);
    border-radius: 12px; padding: 1.5rem; margin-top: 1.5rem;
    display: none; animation: fadeUp .3s ease;
  }
  .component-detail.visible { display: block; }
  .component-detail h4 { color: var(--accent); font-size: 1.1rem; margin-bottom: .75rem; }
  .component-detail p { color: var(--muted); line-height: 1.7; font-size: .9rem; margin-bottom: .5rem; }
  .component-detail .specs { display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem; }
  .spec-tag {
    background: rgba(0,212,255,.1); border: 1px solid rgba(0,212,255,.2);
    color: var(--accent); border-radius: 6px; padding: .25rem .75rem;
    font-family: 'Space Mono', monospace; font-size: .7rem;
  }

  /* ── QUIZ ── */
  .quiz-container {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 2rem;
    margin-top: 2rem;
  }
  .quiz-header {
    display: flex; align-items: center; justify-content: space-between; margin-bottom: 2rem;
  }
  .quiz-progress-wrap { flex: 1; margin: 0 1.5rem; }
  .quiz-progress-label { font-size: .75rem; color: var(--muted); font-family: 'Space Mono', monospace; margin-bottom: .4rem; }
  .quiz-progress-track {
    height: 6px; background: var(--border); border-radius: 3px; overflow: hidden;
  }
  .quiz-progress-fill {
    height: 100%; background: linear-gradient(90deg, var(--accent), var(--accent3));
    border-radius: 3px; transition: width .4s;
  }
  .quiz-score-badge {
    background: rgba(0,255,136,.1); border: 1px solid rgba(0,255,136,.3);
    border-radius: 8px; padding: .4rem .8rem;
    font-family: 'Space Mono', monospace; font-size: .8rem; color: var(--green);
  }
  .quiz-question-num { font-size: .75rem; color: var(--muted); font-family: 'Space Mono', monospace; }
  .quiz-q {
    font-size: 1.2rem; font-weight: 700; margin-bottom: 1.5rem; line-height: 1.4;
  }
  .quiz-options { display: grid; gap: .75rem; }
  .quiz-opt {
    background: var(--bg);
    border: 2px solid var(--border);
    border-radius: 12px; padding: 1rem 1.5rem;
    font-size: .95rem; cursor: pointer;
    transition: all .2s; text-align: left;
    font-family: 'Syne', sans-serif; color: var(--text);
    display: flex; align-items: center; gap: .75rem;
  }
  .quiz-opt .opt-letter {
    width: 28px; height: 28px; border-radius: 6px;
    background: var(--border); color: var(--muted);
    display: flex; align-items: center; justify-content: center;
    font-family: 'Space Mono', monospace; font-size: .75rem; font-weight: 700;
    flex-shrink: 0; transition: all .2s;
  }
  .quiz-opt:hover { border-color: var(--accent); }
  .quiz-opt:hover .opt-letter { background: var(--accent); color: var(--bg); }
  .quiz-opt.correct { border-color: var(--green); background: rgba(0,255,136,.05); }
  .quiz-opt.correct .opt-letter { background: var(--green); color: #000; }
  .quiz-opt.wrong { border-color: #ff4757; background: rgba(255,71,87,.05); }
  .quiz-opt.wrong .opt-letter { background: #ff4757; color: white; }
  .quiz-opt.disabled { cursor: not-allowed; opacity: .7; }
  .quiz-feedback {
    margin-top: 1rem;
    padding: 1rem 1.25rem;
    border-radius: 10px;
    font-size: .9rem; line-height: 1.6;
    display: none;
  }
  .quiz-feedback.show { display: block; animation: fadeUp .3s ease; }
  .quiz-feedback.correct-fb { background: rgba(0,255,136,.08); border: 1px solid rgba(0,255,136,.3); color: #00ff88; }
  .quiz-feedback.wrong-fb { background: rgba(255,71,87,.08); border: 1px solid rgba(255,71,87,.3); color: #ff6b81; }
  .quiz-next {
    margin-top: 1.5rem;
    background: var(--accent3); color: white;
    border: none; border-radius: 8px;
    padding: .7rem 1.5rem;
    font-family: 'Space Mono', monospace; font-size: .8rem; font-weight: 700;
    cursor: pointer; transition: all .2s; display: none;
  }
  .quiz-next.show { display: inline-flex; align-items: center; gap: .5rem; }
  .quiz-next:hover { background: #6d28d9; }
  .quiz-complete {
    text-align: center; padding: 2rem; display: none;
  }
  .quiz-complete.show { display: block; animation: fadeUp .4s ease; }
  .quiz-final-score {
    font-size: 4rem; font-weight: 800; font-family: 'Space Mono', monospace;
    color: var(--green); margin-bottom: .5rem;
  }
  .quiz-final-msg { font-size: 1.1rem; color: var(--muted); margin-bottom: 2rem; }
  .quiz-restart {
    background: var(--accent); color: var(--bg);
    border: none; border-radius: 8px;
    padding: .7rem 1.5rem;
    font-family: 'Space Mono', monospace; font-size: .8rem; font-weight: 700;
    cursor: pointer; transition: all .2s;
  }
  .quiz-restart:hover { background: #00b8d9; }

  /* ── PROJECTS ── */
  .projects-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px,1fr)); gap: 1.5rem; margin-top: 2rem; }
  .project-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 20px;
    overflow: hidden;
    transition: all .3s;
  }
  .project-card:hover { transform: translateY(-4px); box-shadow: 0 20px 40px rgba(0,0,0,.3); }
  .project-header {
    padding: 1.5rem;
    display: flex; align-items: flex-start; justify-content: space-between;
  }
  .project-icon { font-size: 2.5rem; }
  .difficulty-badge {
    font-family: 'Space Mono', monospace; font-size: .65rem; font-weight: 700;
    text-transform: uppercase; letter-spacing: .1em;
    padding: .25rem .75rem; border-radius: 100px;
  }
  .diff-easy { background: rgba(0,255,136,.15); color: var(--green); }
  .diff-med { background: rgba(255,215,0,.15); color: var(--yellow); }
  .diff-hard { background: rgba(255,107,53,.15); color: var(--accent2); }
  .project-body { padding: 0 1.5rem 1.5rem; }
  .project-title { font-size: 1.2rem; font-weight: 700; margin-bottom: .5rem; }
  .project-desc { color: var(--muted); font-size: .875rem; line-height: 1.6; margin-bottom: 1rem; }
  .project-steps { list-style: none; }
  .project-steps li {
    display: flex; align-items: flex-start; gap: .75rem;
    font-size: .82rem; color: var(--muted); padding: .4rem 0;
    border-bottom: 1px solid rgba(255,255,255,.04);
  }
  .project-steps li:last-child { border-bottom: none; }
  .step-num {
    min-width: 22px; height: 22px;
    background: rgba(0,212,255,.1); color: var(--accent);
    border-radius: 50%; display: flex; align-items: center; justify-content: center;
    font-family: 'Space Mono', monospace; font-size: .65rem; font-weight: 700;
    flex-shrink: 0;
  }
  .project-footer { padding: 1rem 1.5rem; border-top: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
  .project-tags { display: flex; gap: .4rem; flex-wrap: wrap; }
  .project-tag { background: var(--bg); border: 1px solid var(--border); border-radius: 6px; padding: .2rem .6rem; font-size: .7rem; color: var(--muted); font-family: 'Space Mono', monospace; }
  .time-badge { font-size: .75rem; color: var(--muted); font-family: 'Space Mono', monospace; display: flex; align-items: center; gap: .3rem; }

  /* ── OHM'S LAW CALC ── */
  .calc-box {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 2rem;
    max-width: 600px;
  }
  .calc-box h3 { font-size: 1.3rem; font-weight: 700; margin-bottom: .5rem; }
  .calc-box p { color: var(--muted); font-size: .875rem; margin-bottom: 1.5rem; }
  .calc-formula {
    background: var(--bg); border: 1px solid var(--border);
    border-radius: 10px; padding: 1rem;
    font-family: 'Space Mono', monospace; font-size: 1.1rem;
    text-align: center; color: var(--accent); margin-bottom: 1.5rem;
    letter-spacing: .05em;
  }
  .calc-inputs { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem; }
  .calc-input-group label { display: block; font-size: .75rem; font-family: 'Space Mono', monospace; color: var(--muted); margin-bottom: .4rem; text-transform: uppercase; }
  .calc-input-group input {
    width: 100%; background: var(--bg); border: 1px solid var(--border);
    border-radius: 8px; padding: .6rem .8rem;
    font-family: 'JetBrains Mono', monospace; font-size: .9rem; color: var(--text);
    transition: border-color .2s; outline: none;
  }
  .calc-input-group input:focus { border-color: var(--accent); }
  .calc-result {
    background: linear-gradient(135deg, rgba(0,212,255,.1), rgba(124,58,237,.1));
    border: 1px solid rgba(0,212,255,.2);
    border-radius: 10px; padding: 1rem 1.5rem;
    font-family: 'Space Mono', monospace; font-size: .9rem;
    color: var(--accent); display: none;
  }
  .calc-result.visible { display: block; }
  .calc-btn {
    background: var(--accent3); color: white;
    border: none; border-radius: 8px;
    padding: .6rem 1.5rem;
    font-family: 'Space Mono', monospace; font-size: .8rem;
    cursor: pointer; transition: all .2s; margin-right: .5rem;
  }
  .calc-btn:hover { background: #6d28d9; }

  /* ── STEP BUILDER ── */
  .builder-steps { margin-top: 2rem; }
  .builder-step {
    display: flex; gap: 1.5rem;
    margin-bottom: 2rem; opacity: .4;
    transition: opacity .3s;
  }
  .builder-step.active { opacity: 1; }
  .builder-step.done { opacity: .75; }
  .step-connector {
    display: flex; flex-direction: column; align-items: center; gap: 0;
    flex-shrink: 0;
  }
  .step-circle {
    width: 44px; height: 44px; border-radius: 50%;
    background: var(--border); border: 2px solid var(--border);
    display: flex; align-items: center; justify-content: center;
    font-family: 'Space Mono', monospace; font-size: .85rem; font-weight: 700; color: var(--muted);
    flex-shrink: 0; transition: all .4s; position: relative; z-index: 1;
  }
  .builder-step.active .step-circle { background: var(--accent); border-color: var(--accent); color: var(--bg); box-shadow: 0 0 20px rgba(0,212,255,.4); }
  .builder-step.done .step-circle { background: var(--green); border-color: var(--green); color: #000; }
  .step-line { width: 2px; flex: 1; min-height: 40px; background: var(--border); }
  .builder-step.done .step-line { background: var(--green); }
  .step-content {
    flex: 1;
    background: var(--card); border: 1px solid var(--border);
    border-radius: 12px; padding: 1.25rem;
    margin-top: 4px;
  }
  .builder-step.active .step-content { border-color: rgba(0,212,255,.3); }
  .builder-step.done .step-content { border-color: rgba(0,255,136,.2); }
  .step-title { font-weight: 700; font-size: 1rem; margin-bottom: .4rem; }
  .step-desc { color: var(--muted); font-size: .875rem; line-height: 1.6; }
  .step-btn {
    margin-top: 1rem;
    background: var(--accent); color: var(--bg);
    border: none; border-radius: 6px;
    padding: .5rem 1.2rem;
    font-family: 'Space Mono', monospace; font-size: .75rem; font-weight: 700;
    cursor: pointer; transition: all .2s;
  }
  .step-btn:hover { background: #00b8d9; }
  .step-done-badge {
    display: none; align-items: center; gap: .4rem;
    margin-top: .75rem;
    font-size: .8rem; color: var(--green);
    font-family: 'Space Mono', monospace;
  }
  .builder-step.done .step-done-badge { display: flex; }
  .builder-step.done .step-btn { display: none; }

  /* ── PINOUT ── */
  .pinout-wrap {
    background: var(--card); border: 1px solid var(--border);
    border-radius: 20px; padding: 2rem; margin-top: 2rem;
  }
  .pinout-board {
    width: 100%; max-width: 700px; margin: 0 auto;
    position: relative;
  }
  .pinout-svg { width: 100%; height: auto; }
  .pin-tooltip {
    position: absolute; background: var(--bg2);
    border: 1px solid var(--accent); border-radius: 8px;
    padding: .5rem .75rem; font-size: .75rem;
    pointer-events: none; z-index: 100; display: none;
    font-family: 'Space Mono', monospace; color: var(--accent);
    white-space: nowrap;
  }

  /* ── FOOTER ── */
  footer {
    background: var(--bg2);
    border-top: 1px solid var(--border);
    padding: 4rem 2rem;
    text-align: center;
  }
  footer h3 { font-size: 1.5rem; margin-bottom: .5rem; }
  footer p { color: var(--muted); font-size: .875rem; line-height: 1.7; max-width: 500px; margin: 0 auto 2rem; }
  .footer-links { display: flex; gap: 1.5rem; justify-content: center; flex-wrap: wrap; margin-bottom: 2rem; }
  .footer-links a { color: var(--muted); text-decoration: none; font-size: .875rem; transition: color .2s; }
  .footer-links a:hover { color: var(--accent); }
  .footer-copy { font-family: 'Space Mono', monospace; font-size: .7rem; color: var(--border); letter-spacing: .05em; }

  /* ── MISC ── */
  .full-bleed { max-width: 100%; }
  .highlight-box {
    background: linear-gradient(135deg, rgba(0,212,255,.06), rgba(124,58,237,.06));
    border: 1px solid rgba(0,212,255,.15);
    border-radius: 16px; padding: 2rem;
    margin: 2rem 0;
  }
  .highlight-box h3 { color: var(--accent); font-size: 1.1rem; margin-bottom: .75rem; }
  .highlight-box p { color: var(--muted); font-size: .9rem; line-height: 1.7; }
  .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
  @media (max-width: 640px) {
    .two-col { grid-template-columns: 1fr; }
    .circuit-info { grid-template-columns: 1fr; }
    .calc-inputs { grid-template-columns: 1fr; }
    nav .nav-links { display: none; }
  }
  .tip-box {
    display: flex; gap: 1rem; align-items: flex-start;
    background: rgba(255,215,0,.05); border: 1px solid rgba(255,215,0,.2);
    border-radius: 12px; padding: 1rem 1.25rem;
    margin: 1rem 0;
  }
  .tip-icon { font-size: 1.2rem; flex-shrink: 0; }
  .tip-text { font-size: .875rem; color: var(--muted); line-height: 1.6; }
  .tip-text strong { color: var(--yellow); }

  /* ══════════════════════════════════════════════
     NEW CHAPTER STYLES
  ══════════════════════════════════════════════ */

  /* ── ANALOGY CARDS ── */
  .analogy-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px,1fr)); gap: 1.5rem; margin-top: 2rem; }
  .analogy-card {
    background: var(--card); border: 1px solid var(--border);
    border-radius: 20px; overflow: hidden; transition: all .3s;
  }
  .analogy-card:hover { transform: translateY(-4px); box-shadow: 0 20px 40px rgba(0,0,0,.3); }
  .analogy-top {
    background: linear-gradient(135deg, rgba(0,212,255,.08), rgba(124,58,237,.08));
    border-bottom: 1px solid var(--border);
    padding: 1.5rem; text-align: center;
  }
  .analogy-emoji { font-size: 3.5rem; display: block; margin-bottom: .5rem; }
  .analogy-title { font-weight: 800; font-size: 1.1rem; color: var(--accent); }
  .analogy-body { padding: 1.5rem; }
  .analogy-body p { color: var(--muted); font-size: .9rem; line-height: 1.7; }
  .analogy-arrow {
    display: flex; align-items: center; justify-content: center; gap: .75rem;
    background: var(--bg); border-radius: 10px; padding: .75rem 1rem;
    margin: 1rem 0; font-size: .85rem;
  }
  .analogy-arrow .real { color: var(--green); font-family: 'Space Mono', monospace; font-size: .8rem; }
  .analogy-arrow .arrow { color: var(--muted); }
  .analogy-arrow .world { color: var(--accent2); font-size: .8rem; }

  /* ── DATA TYPES TABLE ── */
  .dtype-table { width: 100%; border-collapse: collapse; margin-top: 1.5rem; font-size: .85rem; }
  .dtype-table th { background: var(--bg2); color: var(--accent); font-family: 'Space Mono', monospace; font-size: .75rem; text-transform: uppercase; letter-spacing: .05em; padding: .75rem 1rem; text-align: left; border-bottom: 2px solid var(--border); }
  .dtype-table td { padding: .65rem 1rem; border-bottom: 1px solid rgba(255,255,255,.04); color: var(--muted); vertical-align: top; }
  .dtype-table tr:hover td { background: rgba(0,212,255,.03); }
  .dtype-table .td-name { color: var(--text); font-family: 'JetBrains Mono', monospace; font-weight: 700; }
  .dtype-table .td-size { color: var(--accent2); font-family: 'JetBrains Mono', monospace; }
  .dtype-table .td-range { color: var(--green); font-family: 'JetBrains Mono', monospace; font-size: .75rem; }
  .dtype-badge { display: inline-block; padding: .15rem .5rem; border-radius: 4px; font-size: .7rem; font-family: 'Space Mono', monospace; }
  .badge-int { background: rgba(0,212,255,.1); color: var(--accent); border: 1px solid rgba(0,212,255,.2); }
  .badge-float { background: rgba(124,58,237,.1); color: #a78bfa; border: 1px solid rgba(124,58,237,.2); }
  .badge-bool { background: rgba(0,255,136,.1); color: var(--green); border: 1px solid rgba(0,255,136,.2); }
  .badge-other { background: rgba(255,107,53,.1); color: var(--accent2); border: 1px solid rgba(255,107,53,.2); }

  /* ── INTERACTIVE FLOWCHART ── */
  .flow-demo {
    background: var(--card); border: 1px solid var(--border);
    border-radius: 20px; padding: 2rem; margin-top: 2rem;
  }
  .flow-canvas-wrap {
    background: var(--bg); border: 1px solid var(--border);
    border-radius: 12px; overflow: hidden;
    display: flex; align-items: center; justify-content: center;
    margin-bottom: 1.5rem;
  }
  .flow-controls { display: flex; gap: 1rem; flex-wrap: wrap; align-items: center; margin-bottom: 1rem; }
  .flow-slider-group { display: flex; flex-direction: column; gap: .3rem; flex: 1; min-width: 160px; }
  .flow-slider-group label { font-size: .75rem; color: var(--muted); font-family: 'Space Mono', monospace; }
  .flow-slider-group input[type=range] { width: 100%; accent-color: var(--accent); }
  .flow-output {
    background: var(--bg); border: 1px solid var(--border);
    border-radius: 8px; padding: 1rem;
    font-family: 'JetBrains Mono', monospace; font-size: .82rem; color: var(--green);
    min-height: 60px; white-space: pre-wrap;
  }

  /* ── LOOP VISUALIZER ── */
  .loop-vis { margin-top: 2rem; }
  .loop-boxes { display: flex; gap: .4rem; flex-wrap: wrap; margin: 1rem 0; }
  .loop-box {
    width: 44px; height: 44px; border-radius: 8px;
    background: var(--bg); border: 2px solid var(--border);
    display: flex; align-items: center; justify-content: center;
    font-family: 'Space Mono', monospace; font-size: .75rem; font-weight: 700;
    transition: all .3s; color: var(--muted);
  }
  .loop-box.active { background: var(--accent); border-color: var(--accent); color: var(--bg); transform: scale(1.15); box-shadow: 0 0 16px rgba(0,212,255,.5); }
  .loop-box.done { background: rgba(0,255,136,.15); border-color: var(--green); color: var(--green); }
  .loop-controls { display: flex; gap: .75rem; align-items: center; flex-wrap: wrap; }
  .loop-btn {
    background: var(--accent3); color: white; border: none;
    border-radius: 8px; padding: .5rem 1.2rem;
    font-family: 'Space Mono', monospace; font-size: .75rem; font-weight: 700;
    cursor: pointer; transition: all .2s;
  }
  .loop-btn:hover { background: #6d28d9; }
  .loop-speed { display: flex; align-items: center; gap: .5rem; }
  .loop-speed label { font-size: .75rem; color: var(--muted); font-family: 'Space Mono', monospace; }
  .loop-status { font-family: 'Space Mono', monospace; font-size: .8rem; color: var(--accent2); margin-left: auto; }

  /* ── FUNCTION VISUALIZER ── */
  .fn-vis {
    background: var(--card); border: 1px solid var(--border);
    border-radius: 20px; padding: 2rem; margin-top: 2rem;
  }
  .fn-playground { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
  .fn-inputs { }
  .fn-inputs label { display: block; font-size: .75rem; color: var(--muted); font-family: 'Space Mono', monospace; margin-bottom: .3rem; }
  .fn-inputs input {
    width: 100%; background: var(--bg); border: 1px solid var(--border);
    border-radius: 8px; padding: .6rem .8rem;
    font-family: 'JetBrains Mono', monospace; font-size: .9rem; color: var(--text);
    outline: none; margin-bottom: 1rem; transition: border-color .2s;
  }
  .fn-inputs input:focus { border-color: var(--accent); }
  .fn-result {
    background: var(--bg); border: 1px solid var(--border); border-radius: 12px;
    padding: 1.25rem; display: flex; flex-direction: column; justify-content: center;
  }
  .fn-result-label { font-family: 'Space Mono', monospace; font-size: .7rem; color: var(--muted); text-transform: uppercase; margin-bottom: .5rem; }
  .fn-result-value { font-family: 'JetBrains Mono', monospace; font-size: 1.5rem; font-weight: 700; color: var(--green); }
  .fn-result-code { font-family: 'JetBrains Mono', monospace; font-size: .8rem; color: var(--accent); margin-top: .5rem; }
  @media (max-width: 640px) { .fn-playground { grid-template-columns: 1fr; } }

  /* ── ARRAY VISUALIZER ── */
  .array-vis {
    background: var(--card); border: 1px solid var(--border);
    border-radius: 20px; padding: 2rem; margin-top: 2rem;
  }
  .array-grid-vis { display: flex; gap: .5rem; flex-wrap: wrap; margin: 1.5rem 0; }
  .array-cell {
    display: flex; flex-direction: column; align-items: center;
  }
  .array-idx { font-family: 'Space Mono', monospace; font-size: .65rem; color: var(--muted); margin-bottom: .25rem; }
  .array-val {
    width: 54px; height: 54px; border-radius: 10px;
    background: var(--bg); border: 2px solid var(--border);
    display: flex; align-items: center; justify-content: center;
    font-family: 'JetBrains Mono', monospace; font-size: .95rem; font-weight: 700;
    color: var(--text); transition: all .3s; cursor: pointer; position: relative;
  }
  .array-val:hover { border-color: var(--accent); background: rgba(0,212,255,.05); }
  .array-val.highlighted { background: rgba(0,212,255,.15); border-color: var(--accent); color: var(--accent); box-shadow: 0 0 16px rgba(0,212,255,.3); }
  .array-val.modified { background: rgba(0,255,136,.15); border-color: var(--green); color: var(--green); }
  .array-controls { display: flex; gap: .75rem; flex-wrap: wrap; align-items: center; margin-bottom: 1rem; }
  .array-control-input {
    background: var(--bg); border: 1px solid var(--border);
    border-radius: 8px; padding: .45rem .8rem;
    font-family: 'JetBrains Mono', monospace; font-size: .85rem; color: var(--text);
    outline: none; width: 70px; transition: border-color .2s;
  }
  .array-control-input:focus { border-color: var(--accent); }
  .array-log { font-family: 'JetBrains Mono', monospace; font-size: .78rem; color: var(--green); background: var(--bg); border: 1px solid var(--border); border-radius: 8px; padding: .75rem 1rem; min-height: 44px; }

  /* ── MILLIS TIMELINE ── */
  .millis-demo {
    background: var(--card); border: 1px solid var(--border);
    border-radius: 20px; padding: 2rem; margin-top: 2rem;
  }
  .millis-canvas-wrap {
    background: var(--bg); border: 1px solid var(--border);
    border-radius: 12px; overflow: hidden; margin-bottom: 1rem;
  }
  .millis-btns { display: flex; gap: .75rem; flex-wrap: wrap; margin-bottom: 1rem; }
  .millis-btn { background: var(--accent); color: var(--bg); border: none; border-radius: 8px; padding: .5rem 1.2rem; font-family: 'Space Mono', monospace; font-size: .75rem; font-weight: 700; cursor: pointer; transition: all .2s; }
  .millis-btn:hover { background: #00b8d9; }
  .millis-btn.secondary { background: var(--border); color: var(--text); }
  .millis-btn.secondary:hover { background: var(--accent3); color: white; border-color: var(--accent3); }

  /* ── C++ COMPARISON ── */
  .cpp-compare {
    display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 2rem;
  }
  .cpp-side {
    background: var(--card); border: 1px solid var(--border);
    border-radius: 16px; overflow: hidden;
  }
  .cpp-side-header {
    padding: .75rem 1.25rem; font-family: 'Space Mono', monospace;
    font-size: .8rem; font-weight: 700; text-transform: uppercase; letter-spacing: .05em;
    display: flex; align-items: center; gap: .5rem;
  }
  .cpp-side-header.arduino { background: rgba(0,212,255,.1); color: var(--accent); border-bottom: 1px solid rgba(0,212,255,.2); }
  .cpp-side-header.cpp { background: rgba(124,58,237,.1); color: #a78bfa; border-bottom: 1px solid rgba(124,58,237,.2); }
  .cpp-code { padding: 1.25rem; font-family: 'JetBrains Mono', monospace; font-size: .78rem; line-height: 1.7; }
  @media (max-width: 640px) { .cpp-compare { grid-template-columns: 1fr; } }

  /* ── MEMORY CHART ── */
  .memory-bars { display: flex; flex-direction: column; gap: .75rem; margin-top: 1.5rem; }
  .memory-bar-row { display: flex; align-items: center; gap: 1rem; }
  .memory-bar-label { font-family: 'Space Mono', monospace; font-size: .75rem; color: var(--muted); width: 100px; flex-shrink: 0; text-align: right; }
  .memory-bar-track { flex: 1; height: 28px; background: var(--bg); border: 1px solid var(--border); border-radius: 6px; overflow: hidden; position: relative; }
  .memory-bar-fill { height: 100%; border-radius: 6px; display: flex; align-items: center; justify-content: flex-end; padding-right: .6rem; font-family: 'Space Mono', monospace; font-size: .7rem; font-weight: 700; transition: width 1s ease; white-space: nowrap; }
  .memory-bar-fill.flash { background: linear-gradient(90deg, rgba(0,212,255,.3), var(--accent)); color: var(--bg); }
  .memory-bar-fill.sram  { background: linear-gradient(90deg, rgba(0,255,136,.3), var(--green)); color: #000; }
  .memory-bar-fill.eeprom{ background: linear-gradient(90deg, rgba(255,107,53,.3), var(--accent2)); color: var(--bg); }

  /* ── CHAPTER TAGS ── */
  .new-chapter-tag { background: rgba(0,255,136,.1); border-color: rgba(0,255,136,.3); color: var(--green); }

  /* ══════════════════════════════════════════════
     VISUAL SIMULATOR STYLES
  ══════════════════════════════════════════════ */
  .sim-layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0;
    min-height: 300px;
  }
  @media(max-width:700px){ .sim-layout { grid-template-columns: 1fr; } }
  .sim-panel {
    background: #070b14;
    border-left: 1px solid var(--border);
    display: flex; flex-direction: column;
  }
  .sim-panel-header {
    background: #0d1117;
    border-bottom: 1px solid var(--border);
    padding: .5rem 1rem;
    display: flex; align-items: center; justify-content: space-between;
    font-family: 'Space Mono', monospace; font-size: .7rem; color: var(--muted);
  }
  .sim-panel-header .sim-live {
    display: flex; align-items: center; gap: .4rem;
    color: var(--green); font-size: .65rem;
  }
  .sim-live .dot { width: 6px; height: 6px; border-radius: 50%; background: var(--green); animation: blink 1s infinite; }
  .sim-canvas-wrap {
    flex: 1; display: flex; align-items: center; justify-content: center;
    position: relative; overflow: hidden;
    padding: .5rem;
    transition: box-shadow .4s ease;
  }
  canvas.simCanvas { display: block; max-width: 100%; }

  /* ── improved run bar ── */
  .editor-run-bar-v2 {
    background: #0d1117;
    padding: .6rem 1.25rem;
    display: flex; align-items: center; justify-content: space-between;
    border-top: 1px solid var(--border);
    gap: .75rem; flex-wrap: wrap;
  }
  .run-meta { font-family:'Space Mono',monospace; font-size:.68rem; color:var(--muted); }
  .run-btns { display: flex; gap: .5rem; }
  .run-btn-v2 {
    background: var(--green); color: #000;
    border: none; border-radius: 6px; padding: .38rem 1rem;
    font-family: 'Space Mono',monospace; font-size: .72rem; font-weight: 700;
    cursor: pointer; transition: all .2s; display: flex; align-items: center; gap: .35rem;
  }
  .run-btn-v2:hover { background: #00e67a; transform: translateY(-1px); }
  .run-btn-stop {
    background: var(--border); color: var(--muted);
    border: none; border-radius: 6px; padding: .38rem .8rem;
    font-family: 'Space Mono',monospace; font-size: .72rem;
    cursor: pointer; transition: all .2s;
  }
  .run-btn-stop:hover { background: #ff4757; color: white; }

  /* ── serial monitor overlay ── */
  .serial-monitor {
    background: #0a0f0a;
    border: 1px solid #1a3a1a;
    border-radius: 8px; padding: .75rem;
    font-family: 'JetBrains Mono',monospace; font-size: .72rem;
    color: #00ff88; width: 100%; height: 100%;
    overflow-y: auto; line-height: 1.7;
    box-sizing: border-box;
  }
  .serial-line { display: flex; gap: .5rem; }
  .serial-ts { color: #2a5a2a; flex-shrink: 0; }
  .serial-cursor { display: inline-block; width: 7px; height: 13px; background: #00ff88; animation: blink .7s step-end infinite; vertical-align: text-bottom; }

  /* ── speed control ── */
  .sim-speed-wrap {
    display: flex; align-items: center; gap: .5rem;
    font-family: 'Space Mono',monospace; font-size: .65rem; color: var(--muted);
  }
  .sim-speed-wrap input[type=range] { width: 80px; accent-color: var(--accent); }

  /* ══════════════════════════════════════════════
     IMPROVED HERO PARTICLE SYSTEM
  ══════════════════════════════════════════════ */
  #heroParticles {
    position: absolute; inset: 0; pointer-events: none;
    overflow: hidden;
  }
  .hparticle {
    position: absolute;
    width: 2px; height: 2px;
    border-radius: 50%;
    background: var(--accent);
    animation: hpFloat linear infinite;
    opacity: 0;
  }
  @keyframes hpFloat {
    0% { transform: translateY(100vh) scale(0); opacity: 0; }
    10% { opacity: .7; }
    90% { opacity: .4; }
    100% { transform: translateY(-20vh) scale(1.5); opacity: 0; }
  }

  /* ══════════════════════════════════════════════
     CH14 – LIBRARIES
  ══════════════════════════════════════════════ */
  .lib-cards { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px,1fr)); gap: 1rem; margin-top: 1.5rem; }
  .lib-card {
    background: var(--card); border: 1px solid var(--border);
    border-radius: 14px; padding: 1.25rem;
    transition: all .3s; cursor: pointer; position: relative; overflow: hidden;
  }
  .lib-card::after { content:''; position:absolute; inset:0; background: linear-gradient(135deg,rgba(0,212,255,.05),transparent); opacity:0; transition:.3s; }
  .lib-card:hover { border-color: rgba(0,212,255,.4); transform: translateY(-3px); }
  .lib-card:hover::after { opacity:1; }
  .lib-name { font-family:'Space Mono',monospace; font-size:.85rem; font-weight:700; color:var(--accent); margin-bottom:.4rem; }
  .lib-desc { font-size:.8rem; color:var(--muted); line-height:1.6; margin-bottom:.75rem; }
  .lib-include { background:var(--bg); border:1px solid var(--border); border-radius:6px; padding:.4rem .6rem; font-family:'JetBrains Mono',monospace; font-size:.72rem; color:var(--accent2); }
  .lib-type-badge { display:inline-flex; align-items:center; gap:.3rem; font-size:.65rem; font-family:'Space Mono',monospace; padding:.15rem .5rem; border-radius:4px; margin-top:.5rem; }
  .lib-builtin { background:rgba(0,255,136,.1); color:var(--green); border:1px solid rgba(0,255,136,.2); }
  .lib-thirdparty { background:rgba(124,58,237,.1); color:#a78bfa; border:1px solid rgba(124,58,237,.2); }

  /* ══════════════════════════════════════════════
     CH15 – OPERATORS
  ══════════════════════════════════════════════ */
  .ops-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px,1fr)); gap: 1rem; margin-top: 1.5rem; }
  .ops-card {
    background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 1.25rem;
  }
  .ops-card h4 { font-size:.85rem; font-weight:700; color:var(--accent); margin-bottom:.75rem; font-family:'Space Mono',monospace; }
  .op-row { display:flex; gap:.5rem; align-items:center; margin-bottom:.5rem; }
  .op-sym { font-family:'JetBrains Mono',monospace; font-size:.9rem; font-weight:700; color:var(--accent2); min-width:36px; }
  .op-name { font-size:.75rem; color:var(--muted); flex:1; }
  .op-ex { font-family:'JetBrains Mono',monospace; font-size:.7rem; color:#50fa7b; }

  /* operator playground */
  .op-playground {
    background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 2rem; margin-top: 2rem;
  }
  .op-inputs { display: flex; gap: 1rem; flex-wrap: wrap; align-items: center; margin-bottom: 1.5rem; }
  .op-in-group { display: flex; flex-direction: column; gap: .3rem; }
  .op-in-group label { font-family:'Space Mono',monospace; font-size:.7rem; color:var(--muted); }
  .op-in-group input {
    background:var(--bg); border:1px solid var(--border); border-radius:8px;
    padding:.5rem .75rem; font-family:'JetBrains Mono',monospace; font-size:.9rem;
    color:var(--text); outline:none; width:90px; transition:border-color .2s;
  }
  .op-in-group input:focus { border-color:var(--accent); }
  .op-results { display:grid; grid-template-columns: repeat(auto-fill,minmax(180px,1fr)); gap:.75rem; }
  .op-result-row {
    background:var(--bg); border:1px solid var(--border); border-radius:8px; padding:.75rem 1rem;
    display:flex; flex-direction:column; gap:.25rem;
  }
  .op-result-expr { font-family:'JetBrains Mono',monospace; font-size:.78rem; color:var(--muted); }
  .op-result-val { font-family:'JetBrains Mono',monospace; font-size:1rem; font-weight:700; }
  .op-result-val.true { color:var(--green); }
  .op-result-val.false { color:#ff4757; }
  .op-result-val.num { color:var(--accent); }
  .op-result-val.str { color:var(--accent2); }

  /* ══════════════════════════════════════════════
     CH16 – STRINGS & SERIAL
  ══════════════════════════════════════════════ */
  .serial-playground {
    background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 2rem; margin-top: 2rem;
  }
  .serial-layout { display:grid; grid-template-columns:1fr 1fr; gap:2rem; }
  @media(max-width:640px){ .serial-layout{grid-template-columns:1fr;} }
  .serial-monitor-big {
    background:#0a0f0a; border:1px solid #1a4a1a; border-radius:12px;
    font-family:'JetBrains Mono',monospace; font-size:.8rem; color:#00ff88;
    padding:1rem; min-height:200px; max-height:260px; overflow-y:auto; line-height:1.8;
  }
  .serial-input-wrap { display:flex; gap:.5rem; margin-top:1rem; }
  .serial-input {
    flex:1; background:var(--bg); border:1px solid var(--border); border-radius:8px;
    padding:.5rem .8rem; font-family:'JetBrains Mono',monospace; font-size:.85rem; color:var(--text); outline:none;
  }
  .serial-input:focus { border-color:var(--accent); }
  .serial-send-btn {
    background:var(--accent); color:var(--bg); border:none; border-radius:8px;
    padding:.5rem 1rem; font-family:'Space Mono',monospace; font-size:.75rem; font-weight:700; cursor:pointer;
  }
  .serial-send-btn:hover { background:#00b8d9; }

  /* ══════════════════════════════════════════════
     CH17 – DEBUGGING & ERRORS
  ══════════════════════════════════════════════ */
  .error-cards { display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:1rem; margin-top:1.5rem; }
  .error-card {
    background:var(--card); border:1px solid rgba(255,71,87,.2); border-radius:14px; overflow:hidden; transition:.3s;
  }
  .error-card:hover { border-color:rgba(255,71,87,.5); transform:translateY(-3px); }
  .error-header { background:rgba(255,71,87,.08); padding:.75rem 1.25rem; border-bottom:1px solid rgba(255,71,87,.15); }
  .error-type { font-family:'Space Mono',monospace; font-size:.72rem; color:#ff4757; text-transform:uppercase; letter-spacing:.08em; }
  .error-title { font-weight:700; font-size:1rem; margin-top:.2rem; }
  .error-body { padding:1.25rem; }
  .error-code { background:#0d1117; border:1px solid var(--border); border-radius:8px; padding:.75rem; font-family:'JetBrains Mono',monospace; font-size:.75rem; color:#ff6b81; margin:.5rem 0; line-height:1.6; }
  .error-fix { background:rgba(0,255,136,.05); border:1px solid rgba(0,255,136,.15); border-radius:8px; padding:.75rem; font-family:'JetBrains Mono',monospace; font-size:.75rem; color:#00ff88; margin:.5rem 0; line-height:1.6; }
  .error-explain { font-size:.8rem; color:var(--muted); line-height:1.6; }

  /* error matcher */
  .error-matcher {
    background:var(--card); border:1px solid var(--border); border-radius:20px; padding:2rem; margin-top:2rem;
  }
  .error-input-big {
    width:100%; background:var(--bg); border:1px solid var(--border); border-radius:10px;
    padding:.75rem 1rem; font-family:'JetBrains Mono',monospace; font-size:.82rem; color:var(--text);
    outline:none; resize:vertical; min-height:80px; margin-bottom:1rem; transition:border-color .2s;
    color: #ff6b81;
  }
  .error-input-big:focus { border-color:rgba(255,71,87,.4); }
  .error-diagnosis {
    background:var(--bg); border:1px solid var(--border); border-radius:10px; padding:1rem;
    font-family:'JetBrains Mono',monospace; font-size:.8rem; min-height:60px;
  }

  /* ── BACK TO TOP ── */
  .back-top {
    position: fixed; bottom: 2rem; right: 2rem;
    width: 44px; height: 44px;
    background: var(--accent3); color: white;
    border: none; border-radius: 50%;
    font-size: 1.2rem; cursor: pointer;
    transition: all .2s; z-index: 500;
    opacity: 0; pointer-events: none;
    display: flex; align-items: center; justify-content: center;
  }
  .back-top.show { opacity: 1; pointer-events: auto; }
  .back-top:hover { background: #6d28d9; transform: translateY(-3px); }
</style>
</head>
<body>

<!-- NAV -->
<nav>
  <div class="nav-logo">⚡ <span>ARDUINO</span>.guide</div>
  <button class="nav-toggle" id="navToggle" aria-label="Toggle navigation" onclick="this.closest('nav').querySelector('.nav-links').classList.toggle('open');this.textContent=this.closest('nav').querySelector('.nav-links').classList.contains('open')?'✕':'☰'">☰</button>
  <ul class="nav-links">
    <li><a href="#basics">Basics</a></li>
    <li><a href="#components">Parts</a></li>
    <li><a href="#circuits">Circuits</a></li>
    <li><a href="#code">Code</a></li>
    <li><a href="#projects">Projects</a></li>
    <li><a href="#coding101">Ch.08</a></li>
    <li><a href="#variables">Ch.09</a></li>
    <li><a href="#controlflow">Ch.10</a></li>
    <li><a href="#functions">Ch.11</a></li>
    <li><a href="#arrays">Ch.12</a></li>
    <li><a href="#timing">Ch.13</a></li>
    <li><a href="#libraries">Ch.14</a></li>
    <li><a href="#operators">Ch.15</a></li>
    <li><a href="#strings">Ch.16</a></li>
    <li><a href="#debugging">Ch.17</a></li>
    <li><a href="#quiz">Quiz</a></li>
  </ul>
</nav>
<div class="progress-bar" id="progressBar"></div>

<!-- HERO -->
<section id="hero" style="max-width:100%; padding-top:100px;">
  <div class="hero-grid"></div>
  <div class="hero-glow"></div>
  <div id="heroParticles"></div>

  <div class="hero-badge">
    <span class="dot"></span>
    Beginner-Friendly Guide
  </div>

  <h1 class="hero-title">
    <span class="line1">LEARN</span>
    <span class="line2">ARDUINO</span>
    <span class="line3">from zero to maker</span>
  </h1>

  <p class="hero-sub">
    Your complete hands-on guide to building real electronics. From blinking LEDs to full sensor projects — no experience needed.
  </p>

  <div class="hero-btns">
    <a href="#basics" class="btn-primary">Start Learning →</a>
    <a href="#projects" class="btn-secondary">See Projects</a>
  </div>

  <!-- Animated Arduino Board -->
  <div class="arduino-visual">
    <div class="board">
      <div class="pin-row top">
        <div class="pin"></div><div class="pin"></div><div class="pin"></div><div class="pin"></div>
        <div class="pin"></div><div class="pin"></div><div class="pin"></div><div class="pin"></div>
        <div class="pin"></div><div class="pin"></div><div class="pin"></div><div class="pin"></div>
      </div>
      <div class="pin-row bottom">
        <div class="pin"></div><div class="pin"></div><div class="pin"></div><div class="pin"></div>
        <div class="pin"></div><div class="pin"></div><div class="pin"></div><div class="pin"></div>
        <div class="pin"></div><div class="pin"></div><div class="pin"></div><div class="pin"></div>
        <div class="pin"></div><div class="pin"></div>
      </div>
      <div class="chip main">ATmega328P</div>
      <div class="chip small1">16MHz</div>
      <div class="chip small2">CH340</div>
      <div class="led power"></div>
      <div class="led tx"></div>
      <div class="led rx"></div>
      <div class="led l"></div>
      <div class="usb-port"></div>
    </div>
  </div>

  <div class="hero-stats">
    <div class="stat"><div class="stat-num">17</div><div class="stat-label">Full Chapters</div></div>
    <div class="stat"><div class="stat-num">40+</div><div class="stat-label">Code Examples</div></div>
    <div class="stat"><div class="stat-num">12+</div><div class="stat-label">Live Demos</div></div>
    <div class="stat"><div class="stat-num">20</div><div class="stat-label">Quiz Questions</div></div>
  </div>
</section>

<div class="section-divider"></div>

<!-- ══════════════════════════════ SECTION 1 — BASICS ══════════════════════════════ -->
<section id="basics">
  <div class="section-tag">Chapter 01</div>
  <h2 class="section-title">What is <em>Arduino?</em></h2>
  <p class="section-sub">Arduino is an open-source electronics platform that combines a simple microcontroller board with easy-to-use software. It reads inputs (sensors, buttons) and turns them into outputs (motors, LEDs, displays).</p>

  <div class="cards-grid">
    <div class="card">
      <div class="card-icon">🧠</div>
      <h3>Microcontroller</h3>
      <p>The brain of Arduino — a tiny computer on a chip. The popular Uno uses the ATmega328P which runs at 16MHz and has 32KB of flash memory.</p>
    </div>
    <div class="card">
      <div class="card-icon">⚡</div>
      <h3>Pins & I/O</h3>
      <p>Arduino has digital pins (HIGH or LOW) and analog pins (0–1023). These connect to sensors, LEDs, motors — basically anything electronic.</p>
    </div>
    <div class="card">
      <div class="card-icon">💻</div>
      <h3>Arduino IDE</h3>
      <p>Free software where you write code (called "sketches"). Upload via USB. Runs on Windows, Mac, and Linux. It's simpler than it looks!</p>
    </div>
    <div class="card">
      <div class="card-icon">🔋</div>
      <h3>Power</h3>
      <p>Powered via USB (5V) or a 9V battery through the barrel jack. Built-in voltage regulator protects your components automatically.</p>
    </div>
    <div class="card">
      <div class="card-icon">🛡️</div>
      <h3>Open Source</h3>
      <p>All hardware designs and software are open-source. A huge global community shares projects, libraries, and tutorials freely.</p>
    </div>
    <div class="card">
      <div class="card-icon">🚀</div>
      <h3>Many Versions</h3>
      <p>Uno (starter), Nano (tiny), Mega (more pins), Leonardo, Due, MKR, and more. The Uno is perfect for beginners.</p>
    </div>
  </div>

  <div class="highlight-box" style="margin-top:2rem;">
    <h3>⚡ The Two Core Functions</h3>
    <p>Every Arduino sketch has exactly <strong style="color:var(--accent)">two functions</strong>:</p>
    <p style="margin-top:.75rem;"><strong style="color:var(--green)">setup()</strong> — Runs once when the board powers on. Use it to configure pins, start communication, set initial values.</p>
    <p style="margin-top:.5rem;"><strong style="color:var(--green)">loop()</strong> — Runs forever in a cycle (thousands of times per second). Your main program logic goes here.</p>
  </div>

  <div class="tip-box" style="margin-top:1.5rem;">
    <div class="tip-icon">💡</div>
    <div class="tip-text"><strong>Did you know?</strong> "Arduino" is named after a bar in Ivrea, Italy where the founders used to meet. The word itself is a medieval Italian name meaning "strong friend." Your circuit's best friend indeed!</div>
  </div>
</section>

<div class="section-divider"></div>

<!-- ══════════════════════════════ SECTION 2 — COMPONENTS ══════════════════════════════ -->
<section id="components">
  <div class="section-tag">Chapter 02</div>
  <h2 class="section-title">Essential <em>Components</em></h2>
  <p class="section-sub">Click any component to learn what it is, how it works, and when to use it. These are the building blocks of every Arduino project.</p>

  <div class="components-grid" id="componentsGrid">
    <!-- populated by JS -->
  </div>

  <div class="component-detail" id="componentDetail">
    <h4 id="detailName"></h4>
    <p id="detailDesc"></p>
    <p id="detailUsage"></p>
    <div class="specs" id="detailSpecs"></div>
  </div>

  <!-- OHM'S LAW CALCULATOR -->
  <div style="margin-top:3rem;">
    <div class="section-tag">Interactive Tool</div>
    <h3 style="font-size:1.6rem;font-weight:800;margin:.5rem 0 .5rem;">Ohm's Law <em style="color:var(--accent);font-style:normal">Calculator</em></h3>
    <p style="color:var(--muted);font-size:.9rem;margin-bottom:1.5rem;">V = I × R — the most important formula in electronics. Enter any two values to find the third.</p>

    <div class="calc-box">
      <div class="calc-formula">V = I × R</div>
      <div class="calc-inputs">
        <div class="calc-input-group">
          <label>Voltage (V)</label>
          <input type="number" id="calcV" placeholder="e.g. 5" step="0.1">
        </div>
        <div class="calc-input-group">
          <label>Current (A)</label>
          <input type="number" id="calcI" placeholder="e.g. 0.02" step="0.001">
        </div>
        <div class="calc-input-group">
          <label>Resistance (Ω)</label>
          <input type="number" id="calcR" placeholder="e.g. 220" step="1">
        </div>
      </div>
      <button class="calc-btn" onclick="calcOhm()">Calculate</button>
      <button class="calc-btn" style="background:var(--border);color:var(--text);" onclick="clearCalc()">Clear</button>
      <div class="calc-result" id="calcResult"></div>
    </div>
  </div>
</section>

<div class="section-divider"></div>

<!-- ══════════════════════════════ SECTION 3 — CIRCUITS ══════════════════════════════ -->
<section id="circuits">
  <div class="section-tag">Chapter 03</div>
  <h2 class="section-title">Circuit <em>Fundamentals</em></h2>
  <p class="section-sub">Understanding circuits is the key to building anything. Choose a circuit type below to see an animated interactive demo.</p>

  <div class="circuit-demo">
    <div class="circuit-tabs">
      <button class="circuit-tab active" onclick="switchCircuit(0,this)">💡 LED + Resistor</button>
      <button class="circuit-tab" onclick="switchCircuit(1,this)">🔘 Button Switch</button>
      <button class="circuit-tab" onclick="switchCircuit(2,this)">📡 Voltage Divider</button>
      <button class="circuit-tab" onclick="switchCircuit(3,this)">⚡ Series vs Parallel</button>
    </div>

    <div class="circuit-canvas-wrap">
      <canvas id="circuitCanvas" width="680" height="300"></canvas>
    </div>

    <div class="circuit-info" id="circuitInfo">
      <div class="circuit-info-box">
        <h4>How It Works</h4>
        <ul id="howItWorks"></ul>
      </div>
      <div class="circuit-info-box">
        <h4>Key Points</h4>
        <ul id="keyPoints"></ul>
      </div>
    </div>
  </div>

  <div class="two-col" style="margin-top:3rem; gap:1.5rem;">
    <div class="highlight-box" style="margin:0;">
      <h3>🔴 Digital Pins</h3>
      <p>Digital pins are either <strong style="color:var(--green)">HIGH (5V)</strong> or <strong style="color:#ff4757">LOW (0V)</strong>. Use them for LEDs, buttons, buzzers, and relay switches. Pins marked with <strong style="color:var(--accent)">~</strong> support PWM (fake analog output).</p>
    </div>
    <div class="highlight-box" style="margin:0;">
      <h3>🔵 Analog Pins</h3>
      <p>Analog input pins (A0–A5) read voltages from 0–5V and convert them to values from <strong style="color:var(--green)">0 to 1023</strong> using the built-in ADC. Use these for sensors, potentiometers, and photoresistors.</p>
    </div>
  </div>

  <div class="tip-box">
    <div class="tip-icon">⚠️</div>
    <div class="tip-text"><strong>Safety Rule #1:</strong> Always use a resistor with an LED! Without one, too much current flows and the LED (and possibly the Arduino pin) will burn out. A 220Ω–1kΩ resistor is typical for a 5V system.</div>
  </div>
</section>

<div class="section-divider"></div>

<!-- ══════════════════════════════ SECTION 4 — CODE ══════════════════════════════ -->
<section id="code">
  <div class="section-tag">Chapter 04</div>
  <h2 class="section-title">Arduino <em>Coding</em></h2>
  <p class="section-sub">Arduino uses C++ with simplified wrappers. The syntax is clean, the functions are intuitive. Click each example to explore it.</p>

  <div class="code-editor">
    <div class="editor-header">
      <div class="editor-dots">
        <div class="editor-dot dot-red"></div>
        <div class="editor-dot dot-yellow"></div>
        <div class="editor-dot dot-green"></div>
      </div>
      <span class="editor-title" id="editorTitle">sketch.ino</span>
      <div class="editor-tabs">
        <button class="editor-tab-btn active" onclick="switchCode(0,this)">Blink</button>
        <button class="editor-tab-btn" onclick="switchCode(1,this)">Button</button>
        <button class="editor-tab-btn" onclick="switchCode(2,this)">Analog</button>
        <button class="editor-tab-btn" onclick="switchCode(3,this)">Serial</button>
        <button class="editor-tab-btn" onclick="switchCode(4,this)">Servo</button>
        <button class="editor-tab-btn" onclick="switchCode(5,this)">PWM</button>
      </div>
    </div>
    <!-- Split: code left, visual right -->
    <div class="sim-layout">
      <div id="codeDisplay" class="editor-body"></div>
      <div class="sim-panel">
        <div class="sim-panel-header">
          <span id="simTitle">Visual Simulator</span>
          <div class="sim-live"><div class="dot"></div> LIVE PREVIEW</div>
        </div>
        <div class="sim-canvas-wrap" id="simCanvasWrap">
          <canvas class="simCanvas" id="simCanvas" width="320" height="240"></canvas>
        </div>
      </div>
    </div>
    <div class="editor-run-bar-v2">
      <div class="run-meta">▶ Interactive simulator — matches real board behavior</div>
      <div class="sim-speed-wrap">
        Speed: <input type="range" id="simSpeed" min="1" max="5" value="3">
        <span id="simSpeedLabel">3×</span>
      </div>
      <div class="run-btns">
        <button class="run-btn-v2" id="runSimBtn" onclick="runCode()">▶ Run</button>
        <button class="run-btn-stop" id="stopSimBtn" onclick="stopCode()">■ Stop</button>
      </div>
    </div>
    <div class="output-box" id="outputBox"></div>
  </div>

  <div class="cards-grid" style="margin-top:2rem;">
    <div class="card">
      <div class="card-icon">📌</div>
      <h3>digitalWrite()</h3>
      <p>Sets a digital pin HIGH (5V) or LOW (0V). Use it to turn LEDs on/off, trigger relays, or communicate with sensors.</p>
    </div>
    <div class="card">
      <div class="card-icon">👂</div>
      <h3>digitalRead()</h3>
      <p>Reads a digital pin. Returns HIGH or LOW. Use with buttons, switches, PIR sensors, IR receivers.</p>
    </div>
    <div class="card">
      <div class="card-icon">📊</div>
      <h3>analogRead()</h3>
      <p>Reads a voltage from an analog pin (A0–A5). Returns 0–1023. Great for potentiometers, LDRs, temperature sensors.</p>
    </div>
    <div class="card">
      <div class="card-icon">🌊</div>
      <h3>analogWrite()</h3>
      <p>Outputs a PWM signal (0–255) on ~ pins. Simulates analog output for dimming LEDs or controlling motor speed.</p>
    </div>
    <div class="card">
      <div class="card-icon">⏱️</div>
      <h3>delay() / millis()</h3>
      <p><code style="color:var(--accent)">delay(ms)</code> pauses the sketch. <code style="color:var(--accent)">millis()</code> returns ms since start — better for non-blocking timing in complex projects.</p>
    </div>
    <div class="card">
      <div class="card-icon">📡</div>
      <h3>Serial.print()</h3>
      <p>Sends data to your computer via USB. Essential for debugging — like <code style="color:var(--accent)">console.log</code> for Arduino!</p>
    </div>
  </div>
</section>

<div class="section-divider"></div>

<!-- ══════════════════════════════ SECTION 5 — STEP BUILDER ══════════════════════════════ -->
<section id="setup">
  <div class="section-tag">Chapter 05</div>
  <h2 class="section-title">First-Time <em>Setup</em></h2>
  <p class="section-sub">Follow this interactive step-by-step guide to get your Arduino up and running. Check off each step as you go!</p>

  <div class="builder-steps" id="builderSteps">
    <!-- JS renders -->
  </div>
</section>

<div class="section-divider"></div>

<!-- ══════════════════════════════ SECTION 6 — PROJECTS ══════════════════════════════ -->
<section id="projects">
  <div class="section-tag">Chapter 06</div>
  <h2 class="section-title">Beginner <em>Projects</em></h2>
  <p class="section-sub">Real projects you can build today. Start with Blink, work your way up to the weather station. Each project teaches a new skill.</p>

  <div class="projects-grid" id="projectsGrid">
    <!-- JS renders -->
  </div>
</section>

<div class="section-divider"></div>

<!-- ══════════════════════════════ SECTION 7 — QUIZ ══════════════════════════════ -->
<section id="quiz">
  <div class="section-tag">Chapter 07</div>
  <h2 class="section-title">Test Your <em>Knowledge</em></h2>
  <p class="section-sub">20 questions covering everything in this guide. See how much you've learned!</p>

  <div class="quiz-container">
    <div id="quizMain">
      <div class="quiz-header">
        <span class="quiz-question-num" id="qNum">Question 1 / 20</span>
        <div class="quiz-progress-wrap">
          <div class="quiz-progress-label" id="qProgressLabel">0% complete</div>
          <div class="quiz-progress-track">
            <div class="quiz-progress-fill" id="qProgressFill" style="width:0%"></div>
          </div>
        </div>
        <div class="quiz-score-badge">Score: <span id="qScore">0</span></div>
      </div>
      <div class="quiz-q" id="quizQuestion"></div>
      <div class="quiz-options" id="quizOptions"></div>
      <div class="quiz-feedback" id="quizFeedback"></div>
      <button class="quiz-next" id="quizNextBtn" onclick="nextQuestion()">Next Question →</button>
    </div>
    <div class="quiz-complete" id="quizComplete">
      <div style="font-size:3rem;margin-bottom:1rem;">🎉</div>
      <div class="quiz-final-score" id="finalScore"></div>
      <div class="quiz-final-msg" id="finalMsg"></div>
      <button class="quiz-restart" onclick="restartQuiz()">🔄 Retake Quiz</button>
    </div>
  </div>
</section>

<!-- ══════════════ CH08 — CODING 101: ANALOGIES ══════════════ -->
<div class="section-divider"></div>
<section id="coding101">
  <div class="section-tag new-chapter-tag">Chapter 08 · NEW</div>
  <h2 class="section-title">Code in <em>Plain English</em></h2>
  <p class="section-sub">Before we dive into code syntax, let's make sure the big ideas click. Every concept below is explained with a real-world analogy — because if you understand the analogy, you understand the code.</p>

  <div class="analogy-grid">
    <div class="analogy-card">
      <div class="analogy-top">
        <span class="analogy-emoji">🏠</span>
        <div class="analogy-title">setup() vs loop()</div>
      </div>
      <div class="analogy-body">
        <div class="analogy-arrow">
          <span class="real">setup()</span><span class="arrow">→</span><span class="world">Moving into a house</span>
        </div>
        <p>When you move into a house, you do things <strong style="color:var(--text)">once</strong>: hang pictures, plug in appliances, set up the WiFi. That's <code style="color:var(--accent)">setup()</code> — it runs exactly once when the Arduino powers on.</p>
        <div class="analogy-arrow" style="margin-top:.75rem;">
          <span class="real">loop()</span><span class="arrow">→</span><span class="world">Daily routine</span>
        </div>
        <p>Once you're moved in, you <strong style="color:var(--text)">repeat your daily routine forever</strong>: wake up, make coffee, go to work. That's <code style="color:var(--accent)">loop()</code> — it runs over and over until you unplug the Arduino.</p>
      </div>
    </div>

    <div class="analogy-card">
      <div class="analogy-top">
        <span class="analogy-emoji">📦</span>
        <div class="analogy-title">Variables</div>
      </div>
      <div class="analogy-body">
        <div class="analogy-arrow">
          <span class="real">int x = 5;</span><span class="arrow">→</span><span class="world">A labeled box</span>
        </div>
        <p>Imagine a row of labeled shoeboxes in a closet. Each box has a <strong style="color:var(--text)">name</strong> (the variable name) and can hold <strong style="color:var(--text)">one thing</strong> (the value). The label <code style="color:var(--accent)">int</code> means the box only fits whole numbers — no shoes allowed, integers only!</p>
        <p style="margin-top:.75rem;">You can swap what's inside the box any time: <code style="color:var(--accent)">x = 10;</code> — new value, same box.</p>
      </div>
    </div>

    <div class="analogy-card">
      <div class="analogy-top">
        <span class="analogy-emoji">🌲</span>
        <div class="analogy-title">if / else (Decisions)</div>
      </div>
      <div class="analogy-body">
        <div class="analogy-arrow">
          <span class="real">if (rain) { ... }</span><span class="arrow">→</span><span class="world">A fork in the road</span>
        </div>
        <p>A tree has branches. Every branch splits into two directions. Your code does the same — when it hits an <code style="color:var(--accent)">if</code>, it asks a yes/no question and takes one of two paths. It <strong style="color:var(--text)">never takes both</strong>.</p>
        <p style="margin-top:.75rem;"><em style="color:var(--muted)">IF it's raining → take an umbrella. ELSE → wear sunglasses.</em></p>
      </div>
    </div>

    <div class="analogy-card">
      <div class="analogy-top">
        <span class="analogy-emoji">🔁</span>
        <div class="analogy-title">for loops</div>
      </div>
      <div class="analogy-body">
        <div class="analogy-arrow">
          <span class="real">for (int i=0; i&lt;10; i++)</span><span class="arrow">→</span><span class="world">A lap counter</span>
        </div>
        <p>Imagine a runner at a track. They start at lap 0, run a lap, add 1, and check: <em>still under 10?</em> If yes, run again. When they hit lap 10, they stop. A <code style="color:var(--accent)">for</code> loop is exactly that — a <strong style="color:var(--text)">counter that automatically stops</strong>.</p>
      </div>
    </div>

    <div class="analogy-card">
      <div class="analogy-top">
        <span class="analogy-emoji">🍕</span>
        <div class="analogy-title">Functions</div>
      </div>
      <div class="analogy-body">
        <div class="analogy-arrow">
          <span class="real">blinkLED(3);</span><span class="arrow">→</span><span class="world">Ordering a pizza</span>
        </div>
        <p>When you order a pizza, you don't walk through every step of making it. You just say <em>"one pepperoni"</em> and it happens. A function is a <strong style="color:var(--text)">named recipe</strong> you can call by name. You write the recipe once, call it whenever you need it.</p>
      </div>
    </div>

    <div class="analogy-card">
      <div class="analogy-top">
        <span class="analogy-emoji">📋</span>
        <div class="analogy-title">Arrays</div>
      </div>
      <div class="analogy-body">
        <div class="analogy-arrow">
          <span class="real">int leds[5];</span><span class="arrow">→</span><span class="world">An egg carton</span>
        </div>
        <p>An egg carton holds <strong style="color:var(--text)">12 eggs in numbered slots</strong>: slot 0, slot 1... slot 11. An array is the same — a row of numbered slots all holding the same <em>type</em> of thing. You pick which egg (element) you want by its slot number (index).</p>
      </div>
    </div>
  </div>

  <!-- Interactive Breathing Loop Demo -->
  <div style="margin-top:3rem;">
    <div class="section-tag">Interactive</div>
    <h3 style="font-size:1.4rem;font-weight:800;margin:.5rem 0 .5rem;">The Eternal <em style="color:var(--accent);font-style:normal">loop()</em> — Visualized</h3>
    <p style="color:var(--muted);font-size:.9rem;margin-bottom:1.5rem;">The loop() function runs thousands of times per second. Here's what that looks like. Press start to feel the heartbeat of your Arduino.</p>
    <div class="circuit-demo" style="padding:1.5rem;">
      <div style="display:flex;gap:1rem;align-items:center;flex-wrap:wrap;margin-bottom:1rem;">
        <button class="loop-btn" id="loopDemoBtn" onclick="toggleLoopDemo()">▶ Start loop()</button>
        <button class="loop-btn" style="background:var(--border);color:var(--text);" onclick="resetLoopDemo()">↺ Reset</button>
        <div class="loop-speed">
          <label>Speed:</label>
          <input type="range" id="loopSpeedSlider" min="50" max="800" value="300" style="width:100px;accent-color:var(--accent);">
        </div>
        <span class="loop-status" id="loopStatus">Stopped — 0 iterations</span>
      </div>
      <div class="loop-boxes" id="loopBoxes"></div>
      <div class="flow-output" id="loopOutput" style="font-size:.78rem;max-height:80px;overflow:hidden;">// Press Start to run the loop!\n</div>
    </div>
  </div>

  <!-- Memory Architecture Chart -->
  <div style="margin-top:3rem;">
    <div class="section-tag">Chart</div>
    <h3 style="font-size:1.4rem;font-weight:800;margin:.5rem 0 .5rem;">Arduino Uno <em style="color:var(--accent);font-style:normal">Memory</em> Breakdown</h3>
    <p style="color:var(--muted);font-size:.9rem;margin-bottom:1rem;">The Uno has 3 types of memory. Think of Flash as your hard drive, SRAM as your RAM, and EEPROM as a sticky note that survives reboots.</p>
    <div class="memory-bars" id="memoryBars">
      <div class="memory-bar-row">
        <div class="memory-bar-label">Flash (code)</div>
        <div class="memory-bar-track"><div class="memory-bar-fill flash" id="flashBar" style="width:0%">32 KB</div></div>
      </div>
      <div class="memory-bar-row">
        <div class="memory-bar-label">SRAM (runtime)</div>
        <div class="memory-bar-track"><div class="memory-bar-fill sram" id="sramBar" style="width:0%">2 KB</div></div>
      </div>
      <div class="memory-bar-row">
        <div class="memory-bar-label">EEPROM (saved)</div>
        <div class="memory-bar-track"><div class="memory-bar-fill eeprom" id="eepromBar" style="width:0%">1 KB</div></div>
      </div>
    </div>
    <p style="color:var(--muted);font-size:.78rem;margin-top:.75rem;font-family:'Space Mono',monospace;">* Bars shown proportional to Flash size. Flash:SRAM:EEPROM = 32:2:1 KB</p>
  </div>
</section>

<!-- ══════════════ CH09 — VARIABLES & DATA TYPES ══════════════ -->
<div class="section-divider"></div>
<section id="variables">
  <div class="section-tag new-chapter-tag">Chapter 09 · NEW</div>
  <h2 class="section-title">Variables & <em>Data Types</em></h2>
  <p class="section-sub">Every piece of information in your program lives inside a variable. Choosing the right data type is like choosing the right size box — too small and your data won't fit; too big and you waste memory.</p>

  <div class="highlight-box">
    <h3>🧠 The Anatomy of a Variable</h3>
    <p>In Arduino (C++), every variable declaration has three parts:</p>
    <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:1.25rem 1.5rem;margin-top:1rem;font-family:'JetBrains Mono',monospace;font-size:.9rem;">
      <span style="color:#8be9fd;">int</span>&nbsp;&nbsp;&nbsp;<span style="color:#e8eaf6;">sensorValue</span>&nbsp;&nbsp;<span style="color:#ff79c6;">=</span>&nbsp;&nbsp;<span style="color:#bd93f9;">0</span><span style="color:var(--muted);">;</span><br>
      <span style="color:var(--muted);font-size:.75rem;">▲ TYPE &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ▲ NAME &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ▲ VALUE</span>
    </div>
    <p style="margin-top:.75rem;color:var(--muted);">The <strong style="color:#8be9fd">type</strong> tells Arduino how much memory to set aside and what kind of data to expect. The <strong style="color:var(--text)">name</strong> is your label for the box. The <strong style="color:#bd93f9">value</strong> is what's stored inside.</p>
  </div>

  <!-- Data Types Table -->
  <h3 style="font-size:1.3rem;font-weight:700;margin-top:2.5rem;margin-bottom:.5rem;">Arduino Data Types <em style="color:var(--muted);font-style:normal;font-size:1rem;">— vs C++ Standard</em></h3>
  <p style="color:var(--muted);font-size:.875rem;margin-bottom:.5rem;">Arduino uses standard C++ types. The table below shows what they mean, how big they are on a Uno (ATmega328P), and what you'd write in plain C++.</p>

  <div style="overflow-x:auto;">
  <table class="dtype-table">
    <thead>
      <tr><th>Arduino Type</th><th>C++ Equivalent</th><th>Size</th><th>Range</th><th>Best For</th></tr>
    </thead>
    <tbody>
      <tr><td class="td-name">int</td><td><span class="dtype-badge badge-int">int16_t</span></td><td class="td-size">2 bytes</td><td class="td-range">-32,768 to 32,767</td><td>Pin numbers, counters, sensor values</td></tr>
      <tr><td class="td-name">unsigned int</td><td><span class="dtype-badge badge-int">uint16_t</span></td><td class="td-size">2 bytes</td><td class="td-range">0 to 65,535</td><td>When you need bigger positive numbers</td></tr>
      <tr><td class="td-name">long</td><td><span class="dtype-badge badge-int">int32_t</span></td><td class="td-size">4 bytes</td><td class="td-range">-2.1B to 2.1B</td><td>millis(), large counters, timestamps</td></tr>
      <tr><td class="td-name">float</td><td><span class="dtype-badge badge-float">float</span></td><td class="td-size">4 bytes</td><td class="td-range">±3.4×10³⁸ (6–7 digits)</td><td>Temperature in Celsius, voltage math</td></tr>
      <tr><td class="td-name">double</td><td><span class="dtype-badge badge-float">float</span>* same!</td><td class="td-size">4 bytes</td><td class="td-range">Same as float on Uno</td><td>Avoid on Uno — use float instead</td></tr>
      <tr><td class="td-name">bool</td><td><span class="dtype-badge badge-bool">bool</span></td><td class="td-size">1 byte</td><td class="td-range">true or false</td><td>Flags, button state, on/off</td></tr>
      <tr><td class="td-name">byte</td><td><span class="dtype-badge badge-other">uint8_t</span></td><td class="td-size">1 byte</td><td class="td-range">0 to 255</td><td>Small values, saving memory, PWM</td></tr>
      <tr><td class="td-name">char</td><td><span class="dtype-badge badge-other">char</span></td><td class="td-size">1 byte</td><td class="td-range">-128 to 127</td><td>Single characters, serial parsing</td></tr>
      <tr><td class="td-name">String</td><td><span class="dtype-badge badge-other">std::string</span>*</td><td class="td-size">variable</td><td class="td-range">Any text</td><td>Serial messages, display text (use carefully!)</td></tr>
    </tbody>
  </table>
  </div>
  <p style="color:var(--muted);font-size:.75rem;margin-top:.5rem;font-family:'Space Mono',monospace;">* Arduino's String class is similar but not identical to std::string. On microcontrollers, prefer char arrays for memory safety.</p>

  <!-- Arduino vs C++ Comparison -->
  <div style="margin-top:2.5rem;">
    <div class="section-tag">Side by Side</div>
    <h3 style="font-size:1.3rem;font-weight:700;margin:.5rem 0 .5rem;">Arduino Code vs Pure C++</h3>
    <p style="color:var(--muted);font-size:.9rem;margin-bottom:.5rem;">Arduino is literally C++. The main difference is Arduino <em>wraps</em> the hardware setup for you so you don't have to write main() or handle microcontroller registers manually.</p>
    <div class="cpp-compare">
      <div class="cpp-side">
        <div class="cpp-side-header arduino">⚡ Arduino Sketch</div>
        <div class="cpp-code">
          <span class="cmt">// Arduino hides the boring setup</span><br>
          <span class="cmt">// for you automatically</span><br><br>
          <span class="kw">const</span> <span class="type">int</span> <span class="var">LED</span> = <span class="num">13</span>;<br><br>
          <span class="type">void</span> <span class="fn">setup</span>() {<br>
          &nbsp;&nbsp;<span class="fn">pinMode</span>(<span class="var">LED</span>, <span class="kw">OUTPUT</span>);<br>
          }<br><br>
          <span class="type">void</span> <span class="fn">loop</span>() {<br>
          &nbsp;&nbsp;<span class="fn">digitalWrite</span>(<span class="var">LED</span>, <span class="kw">HIGH</span>);<br>
          &nbsp;&nbsp;<span class="fn">delay</span>(<span class="num">500</span>);<br>
          &nbsp;&nbsp;<span class="fn">digitalWrite</span>(<span class="var">LED</span>, <span class="kw">LOW</span>);<br>
          &nbsp;&nbsp;<span class="fn">delay</span>(<span class="num">500</span>);<br>
          }
        </div>
      </div>
      <div class="cpp-side">
        <div class="cpp-side-header cpp">🔷 Equivalent Pure C++</div>
        <div class="cpp-code">
          <span class="cmt">// Pure C++ — more boilerplate!</span><br>
          <span class="kw">#include</span> <span class="str">&lt;avr/io.h&gt;</span><br>
          <span class="kw">#include</span> <span class="str">&lt;util/delay.h&gt;</span><br><br>
          <span class="type">int</span> <span class="fn">main</span>() {<br>
          &nbsp;&nbsp;<span class="cmt">// Set PB5 (pin 13) as output</span><br>
          &nbsp;&nbsp;DDRB |= (1 &lt;&lt; PB5);<br><br>
          &nbsp;&nbsp;<span class="kw">while</span>(<span class="num">1</span>) {<br>
          &nbsp;&nbsp;&nbsp;&nbsp;PORTB |= (1 &lt;&lt; PB5);<br>
          &nbsp;&nbsp;&nbsp;&nbsp;_delay_ms(<span class="num">500</span>);<br>
          &nbsp;&nbsp;&nbsp;&nbsp;PORTB &= ~(1 &lt;&lt; PB5);<br>
          &nbsp;&nbsp;&nbsp;&nbsp;_delay_ms(<span class="num">500</span>);<br>
          &nbsp;&nbsp;}<br>
          }
        </div>
      </div>
    </div>
    <div class="tip-box" style="margin-top:1rem;">
      <div class="tip-icon">💡</div>
      <div class="tip-text"><strong>Key Insight:</strong> Arduino is C++ with a layer of <em>abstraction</em> on top. When you call <code style="color:var(--accent)">digitalWrite(13, HIGH)</code>, Arduino translates that into low-level register manipulation — you get to write the friendly version. All your C++ knowledge applies directly.</div>
    </div>
  </div>

  <!-- Variable Scope Demo -->
  <div style="margin-top:2.5rem;">
    <div class="section-tag">Concept</div>
    <h3 style="font-size:1.3rem;font-weight:700;margin:.5rem 0 .5rem;">Variable <em style="color:var(--accent);font-style:normal">Scope</em> — Where Does Your Variable Live?</h3>
    <div class="two-col" style="margin-top:1rem;">
      <div class="highlight-box" style="margin:0;">
        <h3>🌍 Global Variable</h3>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.8rem;margin:.75rem 0;"><span class="type">int</span> <span class="var">count</span> = <span class="num">0</span>; <span class="cmt">// global</span><br><br><span class="type">void</span> <span class="fn">setup</span>() { ... }<br><span class="type">void</span> <span class="fn">loop</span>() {<br>&nbsp;&nbsp;<span class="var">count</span>++; <span class="cmt">// accessible!</span><br>}</div>
        <p>Declared outside any function. Visible everywhere. Persists its value between loop() runs. <strong style="color:var(--yellow)">Use sparingly</strong> — too many globals waste SRAM.</p>
      </div>
      <div class="highlight-box" style="margin:0;">
        <h3>📌 Local Variable</h3>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.8rem;margin:.75rem 0;"><span class="type">void</span> <span class="fn">loop</span>() {<br>&nbsp;&nbsp;<span class="type">int</span> <span class="var">x</span> = <span class="num">5</span>; <span class="cmt">// local</span><br>&nbsp;&nbsp;<span class="var">x</span>++; <span class="cmt">// only exists here</span><br>} <span class="cmt">// x is destroyed!</span></div>
        <p>Declared inside a function. Only exists while that function runs. Resets to its initial value each time. Great for temporary calculations.</p>
      </div>
    </div>
  </div>
</section>

<!-- ══════════════ CH10 — CONTROL FLOW ══════════════ -->
<div class="section-divider"></div>
<section id="controlflow">
  <div class="section-tag new-chapter-tag">Chapter 10 · NEW</div>
  <h2 class="section-title">Control <em>Flow</em></h2>
  <p class="section-sub">Control flow is how you make decisions and repeat actions in code. Think of it as the roads and intersections of your program — deciding which route to take and how many times to drive around the block.</p>

  <!-- if/else interactive demo -->
  <div class="flow-demo">
    <div class="section-tag" style="margin-bottom:1rem;">Interactive Demo</div>
    <h3 style="font-size:1.2rem;font-weight:700;margin-bottom:.5rem;">The if / else Decision Tree</h3>
    <p style="color:var(--muted);font-size:.875rem;margin-bottom:1.5rem;">Drag the temperature slider. Watch the code make a real-time decision — just like your Arduino does thousands of times per second.</p>
    <div class="flow-controls">
      <div class="flow-slider-group">
        <label>🌡 Temperature: <span id="tempVal">25</span>°C</label>
        <input type="range" id="tempSlider" min="-20" max="100" value="25" oninput="updateFlowDemo()">
      </div>
      <div class="flow-slider-group">
        <label>🎚 Threshold: <span id="threshVal">30</span>°C</label>
        <input type="range" id="threshSlider" min="0" max="80" value="30" oninput="updateFlowDemo()">
      </div>
    </div>
    <div class="flow-canvas-wrap">
      <canvas id="flowCanvas" width="660" height="240"></canvas>
    </div>
    <div class="flow-output" id="flowOutput">// Adjust sliders to see the decision...</div>
  </div>

  <!-- All control flow patterns with code -->
  <div style="margin-top:3rem;">
    <div class="section-tag">Reference</div>
    <h3 style="font-size:1.3rem;font-weight:700;margin:.5rem 0 1.5rem;">All the Flow Patterns</h3>
    <div class="cards-grid">
      <div class="card">
        <div class="card-icon">🔀</div>
        <h3>if / else if / else</h3>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.75rem;margin-top:.75rem;line-height:1.8;">
          <span class="kw">if</span> (<span class="var">temp</span> <span class="op">&gt;</span> <span class="num">40</span>) {<br>
          &nbsp;&nbsp;<span class="cmt">// too hot!</span><br>
          } <span class="kw">else if</span> (<span class="var">temp</span> <span class="op">&gt;</span> <span class="num">20</span>) {<br>
          &nbsp;&nbsp;<span class="cmt">// comfortable</span><br>
          } <span class="kw">else</span> {<br>
          &nbsp;&nbsp;<span class="cmt">// cold</span><br>
          }
        </div>
        <p style="margin-top:.75rem;">Chains of decisions. The first true condition wins — the rest are skipped.</p>
      </div>
      <div class="card">
        <div class="card-icon">🔄</div>
        <h3>for loop</h3>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.75rem;margin-top:.75rem;line-height:1.8;">
          <span class="kw">for</span> (<span class="type">int</span> <span class="var">i</span> = <span class="num">0</span>; <span class="var">i</span> <span class="op">&lt;</span> <span class="num">10</span>; <span class="var">i</span><span class="op">++</span>) {<br>
          &nbsp;&nbsp;<span class="fn">digitalWrite</span>(<span class="var">i</span>, <span class="kw">HIGH</span>);<br>
          }
        </div>
        <p style="margin-top:.75rem;"><strong>Start; Condition; Increment.</strong> Runs a fixed number of times. Perfect for lighting up LED rows.</p>
      </div>
      <div class="card">
        <div class="card-icon">⏳</div>
        <h3>while loop</h3>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.75rem;margin-top:.75rem;line-height:1.8;">
          <span class="kw">while</span> (<span class="fn">digitalRead</span>(<span class="num">2</span>) <span class="op">==</span> <span class="kw">LOW</span>) {<br>
          &nbsp;&nbsp;<span class="cmt">// wait for button press</span><br>
          &nbsp;&nbsp;<span class="fn">delay</span>(<span class="num">10</span>);<br>
          }
        </div>
        <p style="margin-top:.75rem;">Keeps running <strong>as long as the condition is true</strong>. Great for waiting on sensor events.</p>
      </div>
      <div class="card">
        <div class="card-icon">🎛</div>
        <h3>switch / case</h3>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.75rem;margin-top:.75rem;line-height:1.8;">
          <span class="kw">switch</span> (<span class="var">mode</span>) {<br>
          &nbsp;&nbsp;<span class="kw">case</span> <span class="num">1</span>: <span class="fn">blink</span>(); <span class="kw">break</span>;<br>
          &nbsp;&nbsp;<span class="kw">case</span> <span class="num">2</span>: <span class="fn">fade</span>(); <span class="kw">break</span>;<br>
          &nbsp;&nbsp;<span class="kw">default</span>: <span class="fn">off</span>(); <span class="kw">break</span>;<br>
          }
        </div>
        <p style="margin-top:.75rem;">Cleaner than many if/else chains when testing one variable against fixed values.</p>
      </div>
    </div>
  </div>

  <!-- For Loop Visualizer -->
  <div style="margin-top:3rem;">
    <div class="section-tag">Interactive</div>
    <h3 style="font-size:1.3rem;font-weight:700;margin:.5rem 0 .5rem;">The <em style="color:var(--accent);font-style:normal">for</em> Loop Visualizer — Watch i Count</h3>
    <p style="color:var(--muted);font-size:.875rem;margin-bottom:1rem;">Each box is one LED pin. The loop visits each one in order. This is exactly how you'd light up a whole row of LEDs with 3 lines of code instead of 16.</p>
    <div class="circuit-demo" style="padding:1.5rem;">
      <div class="loop-controls" style="margin-bottom:1rem;">
        <button class="loop-btn" id="forLoopBtn" onclick="toggleForLoop()">▶ Run for loop</button>
        <button class="loop-btn" style="background:var(--border);color:var(--text);" onclick="resetForLoop()">↺ Reset</button>
        <div class="loop-speed">
          <label>Speed:</label>
          <input type="range" id="forLoopSpeed" min="100" max="900" value="400" style="width:100px;accent-color:var(--accent);">
        </div>
        <span class="loop-status" id="forLoopStatus" style="color:var(--accent);">for(int i=0; i&lt;16; i++)</span>
      </div>
      <div class="loop-boxes" id="forLoopBoxes"></div>
      <div class="flow-output" id="forLoopOutput" style="margin-top:.75rem;font-size:.78rem;max-height:72px;overflow:hidden;">//  LED strip:  16 LEDs, pins 0 to 15\n// Start the loop to light them up!\n</div>
    </div>
  </div>
</section>

<!-- ══════════════ CH11 — FUNCTIONS ══════════════ -->
<div class="section-divider"></div>
<section id="functions">
  <div class="section-tag new-chapter-tag">Chapter 11 · NEW</div>
  <h2 class="section-title">Writing Your Own <em>Functions</em></h2>
  <p class="section-sub">Functions let you name a block of code and call it whenever you need it. Instead of copy-pasting 10 lines 5 times, you write it once, name it, and call it. This is the foundation of clean, readable code.</p>

  <div class="highlight-box">
    <h3>📐 Anatomy of a Function</h3>
    <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:1.25rem 1.5rem;margin:1rem 0;font-family:'JetBrains Mono',monospace;font-size:.85rem;line-height:2;">
      <span style="color:#8be9fd;">int</span>&nbsp;&nbsp;&nbsp;<span style="color:#50fa7b;">addNumbers</span>&nbsp;&nbsp;<span style="color:#e8eaf6;">(</span><span style="color:#8be9fd;">int</span> <span style="color:#e8eaf6;">a</span>, <span style="color:#8be9fd;">int</span> <span style="color:#e8eaf6;">b</span><span style="color:#e8eaf6;">)</span>&nbsp;&nbsp;{<br>
      &nbsp;&nbsp;<span style="color:#ff79c6;">return</span> <span style="color:#e8eaf6;">a</span> + <span style="color:#e8eaf6;">b</span>;<br>
      }<br>
      <span style="color:var(--muted);font-size:.7rem;">▲ RETURN TYPE &nbsp;&nbsp; ▲ NAME &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ▲ PARAMETERS &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ▲ BODY</span>
    </div>
    <p style="color:var(--muted);">The <strong style="color:#8be9fd">return type</strong> is what the function gives back (<code style="color:var(--accent)">void</code> = nothing). The <strong style="color:#50fa7b">name</strong> is how you call it. <strong>Parameters</strong> are inputs. The <strong>body</strong> is what it does.</p>
  </div>

  <!-- Interactive Function Playground -->
  <div class="fn-vis" style="margin-top:2rem;">
    <div class="section-tag" style="margin-bottom:1rem;">Interactive Playground</div>
    <h3 style="font-size:1.2rem;font-weight:700;margin-bottom:.25rem;">Call a Function — See What Happens</h3>
    <p style="color:var(--muted);font-size:.875rem;margin-bottom:1.5rem;">Change the inputs below. The function runs instantly and shows you the output, just like it would on your Arduino.</p>
    <div style="margin-bottom:1.5rem;">
      <div style="margin-bottom:1rem;" id="fnSelector">
        <button class="calc-btn" id="fnBtn0" onclick="selectFn(0)" style="margin-bottom:.5rem;">int add(a,b)</button>
        <button class="calc-btn" id="fnBtn1" onclick="selectFn(1)" style="background:var(--border);color:var(--text);margin-bottom:.5rem;">float voltToC(v)</button>
        <button class="calc-btn" id="fnBtn2" onclick="selectFn(2)" style="background:var(--border);color:var(--text);margin-bottom:.5rem;">int map(v,0,1023,0,255)</button>
        <button class="calc-btn" id="fnBtn3" onclick="selectFn(3)" style="background:var(--border);color:var(--text);margin-bottom:.5rem;">bool isHot(temp)</button>
      </div>
    </div>
    <div class="fn-playground">
      <div class="fn-inputs" id="fnInputsArea"></div>
      <div class="fn-result" id="fnResultArea">
        <div class="fn-result-label">Function Returns:</div>
        <div class="fn-result-value" id="fnResultValue">—</div>
        <div class="fn-result-code" id="fnResultCode"></div>
      </div>
    </div>
  </div>

  <!-- Common Patterns -->
  <div style="margin-top:2.5rem;">
    <div class="section-tag">Reference</div>
    <h3 style="font-size:1.3rem;font-weight:700;margin:.5rem 0 1.5rem;">Common Function Patterns in Arduino</h3>
    <div class="cards-grid">
      <div class="card">
        <div class="card-icon">🔕</div>
        <h3>void — Do Something</h3>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.75rem;margin-top:.75rem;line-height:1.8;">
          <span class="type">void</span> <span class="fn">blinkLED</span>(<span class="type">int</span> <span class="var">times</span>) {<br>
          &nbsp;&nbsp;<span class="kw">for</span>(<span class="type">int</span> <span class="var">i</span>=<span class="num">0</span>; <span class="var">i</span>&lt;<span class="var">times</span>; <span class="var">i</span>++) {<br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="fn">digitalWrite</span>(<span class="num">13</span>,<span class="kw">HIGH</span>);<br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="fn">delay</span>(<span class="num">200</span>);<br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="fn">digitalWrite</span>(<span class="num">13</span>,<span class="kw">LOW</span>);<br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="fn">delay</span>(<span class="num">200</span>);<br>
          &nbsp;&nbsp;}<br>
          }
        </div>
        <p style="margin-top:.75rem;">Returns nothing. Perfect for actions that just <em>do</em> something without needing a result.</p>
      </div>
      <div class="card">
        <div class="card-icon">📊</div>
        <h3>float — Calculate & Return</h3>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.75rem;margin-top:.75rem;line-height:1.8;">
          <span class="type">float</span> <span class="fn">readTempC</span>() {<br>
          &nbsp;&nbsp;<span class="type">int</span> <span class="var">raw</span> = <span class="fn">analogRead</span>(<span class="num">A0</span>);<br>
          &nbsp;&nbsp;<span class="type">float</span> <span class="var">v</span> = <span class="var">raw</span> * <span class="num">5.0</span> / <span class="num">1023.0</span>;<br>
          &nbsp;&nbsp;<span class="kw">return</span> (<span class="var">v</span> - <span class="num">0.5</span>) * <span class="num">100.0</span>;<br>
          }
        </div>
        <p style="margin-top:.75rem;">Reads a sensor, does the math, and <em>returns</em> the result. Call it anywhere: <code style="color:var(--accent)">float t = readTempC();</code></p>
      </div>
      <div class="card">
        <div class="card-icon">✅</div>
        <h3>bool — Ask a Question</h3>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.75rem;margin-top:.75rem;line-height:1.8;">
          <span class="type">bool</span> <span class="fn">isButtonPressed</span>() {<br>
          &nbsp;&nbsp;<span class="kw">return</span> (<span class="fn">digitalRead</span>(<span class="num">2</span>) == <span class="kw">LOW</span>);<br>
          }<br><br>
          <span class="cmt">// Usage:</span><br>
          <span class="kw">if</span> (<span class="fn">isButtonPressed</span>()) {<br>
          &nbsp;&nbsp;<span class="cmt">// do something!</span><br>
          }
        </div>
        <p style="margin-top:.75rem;">Returns <code style="color:var(--accent)">true</code> or <code style="color:var(--accent)">false</code>. Makes if-statements read like natural English.</p>
      </div>
    </div>
  </div>
</section>

<!-- ══════════════ CH12 — ARRAYS ══════════════ -->
<div class="section-divider"></div>
<section id="arrays">
  <div class="section-tag new-chapter-tag">Chapter 12 · NEW</div>
  <h2 class="section-title">Arrays — <em>Lists of Data</em></h2>
  <p class="section-sub">Imagine you have 8 LEDs connected to pins 2 through 9. Would you rather write 8 separate variables or one tidy list? Arrays let you store many values under one name and access them by position number.</p>

  <div class="highlight-box">
    <h3>📋 Declaring an Array</h3>
    <div style="background:var(--bg);border:1px solid var(--border);border-radius:10px;padding:1.25rem 1.5rem;margin:1rem 0;font-family:'JetBrains Mono',monospace;font-size:.85rem;line-height:2;">
      <span style="color:#8be9fd;">int</span>&nbsp;&nbsp;<span style="color:#e8eaf6;">ledPins</span>[<span style="color:#bd93f9;">6</span>] = {<span style="color:#bd93f9;">3, 5, 6, 9, 10, 11</span>};<br>
      <span style="color:var(--muted);font-size:.7rem;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ▲ 6 items &nbsp;&nbsp; ▲ values inside braces</span><br><br>
      <span class="cmt">// Access element by index (starts at 0!)</span><br>
      <span class="fn">digitalWrite</span>(<span style="color:#e8eaf6;">ledPins</span>[<span style="color:#bd93f9;">0</span>], <span class="kw">HIGH</span>); <span class="cmt">// ledPins[0] = 3</span><br>
      <span class="fn">digitalWrite</span>(<span style="color:#e8eaf6;">ledPins</span>[<span style="color:#bd93f9;">5</span>], <span class="kw">HIGH</span>); <span class="cmt">// ledPins[5] = 11</span>
    </div>
    <p style="color:var(--muted);">⚠️ <strong style="color:var(--yellow)">Arrays start at index 0, not 1!</strong> An array of 6 has indices 0, 1, 2, 3, 4, 5. Accessing index 6 on a 6-element array is a bug — you'd read random memory.</p>
  </div>

  <!-- Array Visualizer -->
  <div class="array-vis">
    <div class="section-tag" style="margin-bottom:1rem;">Interactive</div>
    <h3 style="font-size:1.2rem;font-weight:700;margin-bottom:.5rem;">Poke the Array — Edit &amp; Access Elements</h3>
    <p style="color:var(--muted);font-size:.875rem;margin-bottom:1.5rem;">This is a live array. Type an index to read a value, or type an index + value to write. Watch the array update just like it does in real Arduino code.</p>
    <div class="array-controls">
      <span style="font-family:'JetBrains Mono',monospace;font-size:.8rem;color:var(--muted);">ledPins[</span>
      <input class="array-control-input" id="arrIdxInput" type="number" min="0" max="7" placeholder="idx" value="">
      <span style="font-family:'JetBrains Mono',monospace;font-size:.8rem;color:var(--muted);">] =</span>
      <input class="array-control-input" id="arrValInput" type="number" placeholder="val" value="" style="width:80px;">
      <button class="loop-btn" onclick="arrayWrite()">Write</button>
      <button class="loop-btn" style="background:var(--border);color:var(--text);" onclick="arrayRead()">Read</button>
      <button class="loop-btn" style="background:var(--border);color:var(--text);" onclick="arrayLoopThrough()">for loop all</button>
    </div>
    <div class="array-grid-vis" id="arrayGridVis"></div>
    <div class="array-log" id="arrayLog">// Ready. Pick an index to read or write.</div>
  </div>

  <!-- Arrays + for loops = magic -->
  <div style="margin-top:2.5rem;">
    <div class="section-tag">Power Combo</div>
    <h3 style="font-size:1.3rem;font-weight:700;margin:.5rem 0 1rem;">Arrays + for Loops = Superpowers</h3>
    <div class="two-col">
      <div class="highlight-box" style="margin:0;">
        <h3>😰 Without Arrays (Messy)</h3>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.75rem;line-height:1.8;margin-top:.75rem;">
          <span class="fn">pinMode</span>(<span class="num">3</span>, <span class="kw">OUTPUT</span>);<br>
          <span class="fn">pinMode</span>(<span class="num">4</span>, <span class="kw">OUTPUT</span>);<br>
          <span class="fn">pinMode</span>(<span class="num">5</span>, <span class="kw">OUTPUT</span>);<br>
          <span class="cmt">// ... 5 more lines just like this!</span>
        </div>
      </div>
      <div class="highlight-box" style="margin:0;">
        <h3>😎 With Arrays (Clean)</h3>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.75rem;line-height:1.8;margin-top:.75rem;">
          <span class="type">int</span> <span class="var">pins</span>[] = {<span class="num">3,4,5,6,7,8,9,10</span>};<br>
          <span class="kw">for</span>(<span class="type">int</span> <span class="var">i</span>=<span class="num">0</span>; <span class="var">i</span>&lt;<span class="num">8</span>; <span class="var">i</span>++) {<br>
          &nbsp;&nbsp;<span class="fn">pinMode</span>(<span class="var">pins</span>[<span class="var">i</span>], <span class="kw">OUTPUT</span>);<br>
          }
        </div>
      </div>
    </div>
    <div class="tip-box" style="margin-top:1rem;">
      <div class="tip-icon">🎵</div>
      <div class="tip-text"><strong>Real Example — Melody Player:</strong> Store note frequencies in an array: <code style="color:var(--accent)">int melody[] = {262, 294, 330, 349, 392};</code> then loop through them with <code style="color:var(--accent)">tone(9, melody[i], 300);</code>. Five notes, three lines of code!</div>
    </div>
  </div>
</section>

<!-- ══════════════ CH13 — TIMING & MILLIS ══════════════ -->
<div class="section-divider"></div>
<section id="timing">
  <div class="section-tag new-chapter-tag">Chapter 13 · NEW</div>
  <h2 class="section-title">Timing Without <em>Freezing</em></h2>
  <p class="section-sub">Every beginner starts with delay(). It works — but it completely freezes your Arduino. Want to blink an LED AND read a sensor at the same time? You need millis(). This chapter will change how you think about time.</p>

  <div class="two-col" style="margin-bottom:2rem;">
    <div class="highlight-box" style="margin:0;border-color:rgba(255,71,87,.3);background:rgba(255,71,87,.04);">
      <h3 style="color:#ff4757;">❌ delay() — The Freeze Ray</h3>
      <div style="font-family:'JetBrains Mono',monospace;font-size:.75rem;line-height:1.8;margin:.75rem 0;">
        <span class="fn">digitalWrite</span>(<span class="num">13</span>, <span class="kw">HIGH</span>);<br>
        <span class="fn">delay</span>(<span class="num">1000</span>); <span class="cmt">// ← FROZEN for 1 second!</span><br>
        <span class="cmt">// can't read sensors!</span><br>
        <span class="cmt">// can't check buttons!</span><br>
        <span class="cmt">// can't do ANYTHING!</span><br>
        <span class="fn">digitalWrite</span>(<span class="num">13</span>, <span class="kw">LOW</span>);
      </div>
      <p>During <code style="color:#ff4757">delay()</code>, the entire microcontroller stops. It's like putting your brain on pause — no reading, no reacting, just waiting.</p>
    </div>
    <div class="highlight-box" style="margin:0;border-color:rgba(0,255,136,.3);background:rgba(0,255,136,.04);">
      <h3 style="color:var(--green);">✅ millis() — The Non-Blocking Way</h3>
      <div style="font-family:'JetBrains Mono',monospace;font-size:.75rem;line-height:1.8;margin:.75rem 0;">
        <span class="type">unsigned long</span> <span class="var">prev</span> = <span class="num">0</span>;<br>
        <span class="kw">if</span> (<span class="fn">millis</span>() - <span class="var">prev</span> >= <span class="num">1000</span>) {<br>
        &nbsp;&nbsp;<span class="var">prev</span> = <span class="fn">millis</span>();<br>
        &nbsp;&nbsp;<span class="cmt">// do the thing!</span><br>
        }<br>
        <span class="cmt">// code here runs continuously!</span>
      </div>
      <p>Instead of <em>waiting</em>, you <em>check the clock</em>. Like glancing at your watch without stopping what you're doing. The rest of your code keeps running.</p>
    </div>
  </div>

  <!-- millis timeline visualizer -->
  <div class="millis-demo">
    <div class="section-tag" style="margin-bottom:1rem;">Interactive Demo</div>
    <h3 style="font-size:1.2rem;font-weight:700;margin-bottom:.5rem;">delay() vs millis() — Side by Side</h3>
    <p style="color:var(--muted);font-size:.875rem;margin-bottom:1.5rem;">Start both simulations. Watch how <code style="color:#ff4757">delay()</code> blocks Task B while <code style="color:var(--green)">millis()</code> lets both tasks run simultaneously.</p>
    <div class="millis-btns">
      <button class="millis-btn" id="millisStartBtn" onclick="toggleMillisSim()">▶ Start Simulation</button>
      <button class="millis-btn secondary" onclick="resetMillisSim()">↺ Reset</button>
    </div>
    <div class="millis-canvas-wrap">
      <canvas id="millisCanvas" width="660" height="200"></canvas>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-top:1rem;">
      <div style="background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:.75rem;font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--green);" id="millisLog1">Using delay()...</div>
      <div style="background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:.75rem;font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--green);" id="millisLog2">Using millis()...</div>
    </div>
  </div>

  <!-- millis() pattern reference -->
  <div style="margin-top:2.5rem;">
    <div class="section-tag">Reference</div>
    <h3 style="font-size:1.3rem;font-weight:700;margin:.5rem 0 1rem;">The Complete millis() Pattern</h3>
    <div class="code-editor">
      <div class="editor-header">
        <div class="editor-dots"><div class="editor-dot dot-red"></div><div class="editor-dot dot-yellow"></div><div class="editor-dot dot-green"></div></div>
        <span class="editor-title">millis_blink.ino</span>
      </div>
      <div class="editor-body">
        <div class="line-nums">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</div>
        <div class="code-area"><code><span class="cmt">// Non-blocking blink — the RIGHT way</span>
<span class="cmt">// LED blinks AND sensor reads simultaneously!</span>

<span class="kw">const</span> <span class="type">int</span> <span class="var">LED_PIN</span>  = <span class="num">13</span>;
<span class="kw">const</span> <span class="type">int</span> <span class="var">INTERVAL</span> = <span class="num">500</span>;  <span class="cmt">// ms between blinks</span>

<span class="type">unsigned long</span> <span class="var">prevMillis</span> = <span class="num">0</span>;
<span class="type">bool</span> <span class="var">ledState</span> = <span class="kw">false</span>;

<span class="type">void</span> <span class="fn">setup</span>() {
  <span class="fn">pinMode</span>(<span class="var">LED_PIN</span>, <span class="kw">OUTPUT</span>);
  <span class="var">Serial</span>.<span class="fn">begin</span>(<span class="num">9600</span>);
}

<span class="type">void</span> <span class="fn">loop</span>() {
  <span class="type">unsigned long</span> <span class="var">now</span> = <span class="fn">millis</span>();

  <span class="kw">if</span> (<span class="var">now</span> - <span class="var">prevMillis</span> >= <span class="var">INTERVAL</span>) {
    <span class="var">prevMillis</span> = <span class="var">now</span>;
    <span class="var">ledState</span> = !<span class="var">ledState</span>;    <span class="cmt">// toggle!</span>
    <span class="fn">digitalWrite</span>(<span class="var">LED_PIN</span>, <span class="var">ledState</span>);
  }

  <span class="cmt">// This line runs constantly — not blocked!</span>
  <span class="type">int</span> <span class="var">sensor</span> = <span class="fn">analogRead</span>(<span class="num">A0</span>);
}</code></div>
      </div>
    </div>
  </div>

  <!-- Timing cheat sheet -->
  <div style="margin-top:2.5rem;">
    <div class="cards-grid">
      <div class="card">
        <div class="card-icon">⌚</div>
        <h3>millis()</h3>
        <p>Returns milliseconds since boot as <code style="color:var(--accent)">unsigned long</code>. Overflows after ~49 days (that's OK for most projects). Use for general timing.</p>
      </div>
      <div class="card">
        <div class="card-icon">⚡</div>
        <h3>micros()</h3>
        <p>Returns <em>microseconds</em> since boot. 1000× more precise than millis(). Use for timing fast signals like ultrasonic sensors or IR pulses. Overflows in ~70 minutes.</p>
      </div>
      <div class="card">
        <div class="card-icon">🛑</div>
        <h3>When to use delay()</h3>
        <p>delay() is fine for: startup initialization, simple single-task sketches, or debouncing. Avoid it whenever your sketch needs to do two things "at once".</p>
      </div>
      <div class="card">
        <div class="card-icon">🔢</div>
        <h3>unsigned long — Why?</h3>
        <p>millis() returns numbers up to 4.2 billion. A regular <code style="color:var(--accent)">int</code> only holds 32,767 — it would overflow in 32 seconds! Always use <code style="color:var(--accent)">unsigned long</code> for timing variables.</p>
      </div>
    </div>
  </div>
</section>

<!-- ══════════════ CH14 — LIBRARIES ══════════════ -->
<div class="section-divider"></div>
<section id="libraries">
  <div class="section-tag new-chapter-tag">Chapter 14 · NEW</div>
  <h2 class="section-title">Using <em>Libraries</em></h2>
  <p class="section-sub">A library is a package of pre-written code that adds new capabilities to your Arduino. Instead of writing 500 lines to control a display from scratch, you install a library and call display.print("Hello") — done.</p>

  <div class="highlight-box">
    <h3>📦 How Libraries Work — The Analogy</h3>
    <p>Imagine you want to bake a cake. You <em>could</em> grind your own flour, churn your own butter, and cultivate your own yeast. Or you could <strong style="color:var(--accent)">buy these at the store</strong> — pre-made, tested, reliable. Libraries are the "store-bought ingredients" of programming. Someone else already wrote and debugged the hard parts.</p>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-top:1rem;">
      <div style="background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:1rem;">
        <div style="font-family:'Space Mono',monospace;font-size:.72rem;color:var(--muted);margin-bottom:.5rem;">WITHOUT library</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.72rem;line-height:1.7;color:#6272a4;">
          // Set up I2C pins manually<br>
          // Send start bit<br>
          // Send device address<br>
          // Send register bytes<br>
          // Handle ACK/NACK<br>
          // ... ~200 more lines
        </div>
      </div>
      <div style="background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:1rem;">
        <div style="font-family:'Space Mono',monospace;font-size:.72rem;color:var(--green);margin-bottom:.5rem;">WITH library ✅</div>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.72rem;line-height:1.7;">
          <span class="kw">#include</span> <span class="str">&lt;Wire.h&gt;</span><br>
          <span class="kw">#include</span> <span class="str">&lt;LiquidCrystal_I2C.h&gt;</span><br><br>
          <span class="var">lcd</span>.<span class="fn">begin</span>();<br>
          <span class="var">lcd</span>.<span class="fn">print</span>(<span class="str">"Hello!"</span>);<br>
          <span class="cmt">// Done! 4 lines.</span>
        </div>
      </div>
    </div>
  </div>

  <h3 style="font-size:1.3rem;font-weight:700;margin:2.5rem 0 .5rem;">Essential Arduino Libraries</h3>
  <p style="color:var(--muted);font-size:.875rem;margin-bottom:.5rem;">Green badges = built-in (already installed). Purple badges = download via Library Manager.</p>

  <div class="lib-cards">
    <div class="lib-card">
      <div class="lib-name">Servo.h</div>
      <div class="lib-desc">Control servo motors. Write an angle (0–180°) and the library handles the PWM timing for you.</div>
      <div class="lib-include">#include &lt;Servo.h&gt;</div>
      <div class="lib-type-badge lib-builtin">✅ Built-in</div>
    </div>
    <div class="lib-card">
      <div class="lib-name">Wire.h</div>
      <div class="lib-desc">I²C communication protocol. Lets you talk to sensors, displays, and other ICs with just 2 wires (SDA, SCL).</div>
      <div class="lib-include">#include &lt;Wire.h&gt;</div>
      <div class="lib-type-badge lib-builtin">✅ Built-in</div>
    </div>
    <div class="lib-card">
      <div class="lib-name">SPI.h</div>
      <div class="lib-desc">SPI communication — faster than I2C, used for SD cards, displays, and radio modules.</div>
      <div class="lib-include">#include &lt;SPI.h&gt;</div>
      <div class="lib-type-badge lib-builtin">✅ Built-in</div>
    </div>
    <div class="lib-card">
      <div class="lib-name">EEPROM.h</div>
      <div class="lib-desc">Read/write to the 1KB EEPROM — data that survives power-off. Great for saving settings.</div>
      <div class="lib-include">#include &lt;EEPROM.h&gt;</div>
      <div class="lib-type-badge lib-builtin">✅ Built-in</div>
    </div>
    <div class="lib-card">
      <div class="lib-name">DHT sensor</div>
      <div class="lib-desc">Read temperature and humidity from DHT11/DHT22 sensors with a single function call.</div>
      <div class="lib-include">#include &lt;DHT.h&gt;</div>
      <div class="lib-type-badge lib-thirdparty">📦 Library Manager</div>
    </div>
    <div class="lib-card">
      <div class="lib-name">LiquidCrystal_I2C</div>
      <div class="lib-desc">Control I2C LCD displays (16×2, 20×4) with a simple API. Just 4 wires to the Arduino.</div>
      <div class="lib-include">#include &lt;LiquidCrystal_I2C.h&gt;</div>
      <div class="lib-type-badge lib-thirdparty">📦 Library Manager</div>
    </div>
    <div class="lib-card">
      <div class="lib-name">IRremote</div>
      <div class="lib-desc">Decode IR remote signals and send IR commands. Build your own remote-controlled devices.</div>
      <div class="lib-include">#include &lt;IRremote.h&gt;</div>
      <div class="lib-type-badge lib-thirdparty">📦 Library Manager</div>
    </div>
    <div class="lib-card">
      <div class="lib-name">Adafruit NeoPixel</div>
      <div class="lib-desc">Control RGB LED strips (WS2812B). Animate hundreds of individually addressable LEDs.</div>
      <div class="lib-include">#include &lt;Adafruit_NeoPixel.h&gt;</div>
      <div class="lib-type-badge lib-thirdparty">📦 Library Manager</div>
    </div>
  </div>

  <!-- Install instructions -->
  <div style="margin-top:2.5rem;">
    <div class="section-tag">How To</div>
    <h3 style="font-size:1.3rem;font-weight:700;margin:.5rem 0 1rem;">Installing a Library — 3 Ways</h3>
    <div class="cards-grid">
      <div class="card">
        <div class="card-icon">🔍</div>
        <h3>Library Manager (Easiest)</h3>
        <p>In the IDE: <strong style="color:var(--accent)">Sketch → Include Library → Manage Libraries</strong>. Search by name, click Install. Done. This is how 95% of libraries are installed.</p>
      </div>
      <div class="card">
        <div class="card-icon">📁</div>
        <h3>From ZIP File</h3>
        <p>Download a library as a .zip from GitHub. Then: <strong style="color:var(--accent)">Sketch → Include Library → Add .ZIP Library</strong>. Useful for libraries not in the manager.</p>
      </div>
      <div class="card">
        <div class="card-icon">🛠</div>
        <h3>Manual Install</h3>
        <p>Copy the library folder into your Arduino/libraries/ directory. Restart the IDE. This is useful if you're modifying a library or installing from source.</p>
      </div>
    </div>
    <div class="tip-box" style="margin-top:1rem;">
      <div class="tip-icon">💡</div>
      <div class="tip-text"><strong>C++ comparison:</strong> In standard C++, you'd use <code style="color:var(--accent)">#include &lt;iostream&gt;</code> for the standard library. Arduino's <code style="color:var(--accent)">#include &lt;Servo.h&gt;</code> works exactly the same way — it tells the compiler to include that file's definitions before compiling your sketch.</div>
    </div>
  </div>
</section>

<!-- ══════════════ CH15 — OPERATORS & MATH ══════════════ -->
<div class="section-divider"></div>
<section id="operators">
  <div class="section-tag new-chapter-tag">Chapter 15 · NEW</div>
  <h2 class="section-title">Operators & <em>Math</em></h2>
  <p class="section-sub">Operators are the symbols that let you do math, compare values, combine logic, and manipulate bits. Arduino uses the same operators as C++ — once you know them here, you know them everywhere.</p>

  <div class="ops-grid">
    <div class="ops-card">
      <h4>➕ Arithmetic</h4>
      <div class="op-row"><span class="op-sym">+</span><span class="op-name">Add</span><span class="op-ex">3 + 4 = 7</span></div>
      <div class="op-row"><span class="op-sym">-</span><span class="op-name">Subtract</span><span class="op-ex">10 - 3 = 7</span></div>
      <div class="op-row"><span class="op-sym">*</span><span class="op-name">Multiply</span><span class="op-ex">4 * 5 = 20</span></div>
      <div class="op-row"><span class="op-sym">/</span><span class="op-name">Divide</span><span class="op-ex">9 / 2 = 4 (int!)</span></div>
      <div class="op-row"><span class="op-sym">%</span><span class="op-name">Modulo (remainder)</span><span class="op-ex">9 % 2 = 1</span></div>
    </div>
    <div class="ops-card">
      <h4>⚖️ Comparison</h4>
      <div class="op-row"><span class="op-sym">==</span><span class="op-name">Equal to</span><span class="op-ex">5 == 5 → true</span></div>
      <div class="op-row"><span class="op-sym">!=</span><span class="op-name">Not equal</span><span class="op-ex">5 != 3 → true</span></div>
      <div class="op-row"><span class="op-sym">&lt;</span><span class="op-name">Less than</span><span class="op-ex">3 &lt; 5 → true</span></div>
      <div class="op-row"><span class="op-sym">&gt;</span><span class="op-name">Greater than</span><span class="op-ex">5 &gt; 3 → true</span></div>
      <div class="op-row"><span class="op-sym">&lt;=</span><span class="op-name">Less or equal</span><span class="op-ex">3 &lt;= 3 → true</span></div>
      <div class="op-row"><span class="op-sym">&gt;=</span><span class="op-name">Greater or equal</span><span class="op-ex">5 &gt;= 5 → true</span></div>
    </div>
    <div class="ops-card">
      <h4>🔗 Logical</h4>
      <div class="op-row"><span class="op-sym">&amp;&amp;</span><span class="op-name">AND — both true</span><span class="op-ex">t &amp;&amp; t → true</span></div>
      <div class="op-row"><span class="op-sym">||</span><span class="op-name">OR — at least one</span><span class="op-ex">t || f → true</span></div>
      <div class="op-row"><span class="op-sym">!</span><span class="op-name">NOT — flip it</span><span class="op-ex">!true → false</span></div>
    </div>
    <div class="ops-card">
      <h4>⚡ Assignment Shortcuts</h4>
      <div class="op-row"><span class="op-sym">+=</span><span class="op-name">Add and assign</span><span class="op-ex">x+=5 → x=x+5</span></div>
      <div class="op-row"><span class="op-sym">-=</span><span class="op-name">Subtract and assign</span><span class="op-ex">x-=2 → x=x-2</span></div>
      <div class="op-row"><span class="op-sym">++</span><span class="op-name">Increment by 1</span><span class="op-ex">x++ → x=x+1</span></div>
      <div class="op-row"><span class="op-sym">--</span><span class="op-name">Decrement by 1</span><span class="op-ex">x-- → x=x-1</span></div>
      <div class="op-row"><span class="op-sym">*=</span><span class="op-name">Multiply assign</span><span class="op-ex">x*=2 → x=x*2</span></div>
    </div>
    <div class="ops-card">
      <h4>🔢 Bitwise (Advanced)</h4>
      <div class="op-row"><span class="op-sym">&amp;</span><span class="op-name">AND bits</span><span class="op-ex">0b1010 &amp; 0b1100 = 0b1000</span></div>
      <div class="op-row"><span class="op-sym">|</span><span class="op-name">OR bits</span><span class="op-ex">0b1010 | 0b0101 = 0b1111</span></div>
      <div class="op-row"><span class="op-sym">^</span><span class="op-name">XOR bits</span><span class="op-ex">0b1010 ^ 0b1100 = 0b0110</span></div>
      <div class="op-row"><span class="op-sym">&lt;&lt;</span><span class="op-name">Left shift</span><span class="op-ex">1 &lt;&lt; 3 = 8 (×2ⁿ)</span></div>
      <div class="op-row"><span class="op-sym">&gt;&gt;</span><span class="op-name">Right shift</span><span class="op-ex">8 &gt;&gt; 1 = 4 (÷2ⁿ)</span></div>
    </div>
    <div class="ops-card">
      <h4>🎯 Arduino Math Functions</h4>
      <div class="op-row"><span class="op-sym" style="font-size:.75rem;">map()</span><span class="op-name">Re-scale a range</span></div>
      <div class="op-row"><span class="op-sym" style="font-size:.75rem;">constrain()</span><span class="op-name">Clamp to min/max</span></div>
      <div class="op-row"><span class="op-sym" style="font-size:.75rem;">abs()</span><span class="op-name">Absolute value</span></div>
      <div class="op-row"><span class="op-sym" style="font-size:.75rem;">min()/max()</span><span class="op-name">Smaller/larger of two</span></div>
      <div class="op-row"><span class="op-sym" style="font-size:.75rem;">sqrt()</span><span class="op-name">Square root</span></div>
      <div class="op-row"><span class="op-sym" style="font-size:.75rem;">pow(b,e)</span><span class="op-name">b raised to power e</span></div>
    </div>
  </div>

  <!-- Live Operator Playground -->
  <div class="op-playground">
    <div class="section-tag" style="margin-bottom:1rem;">Interactive Playground</div>
    <h3 style="font-size:1.2rem;font-weight:700;margin-bottom:.25rem;">Type Two Numbers — See All Operations Live</h3>
    <p style="color:var(--muted);font-size:.875rem;margin-bottom:1.5rem;">Every operator runs instantly as you type. This is exactly what Arduino evaluates when your code runs.</p>
    <div class="op-inputs">
      <div class="op-in-group"><label>Value A</label><input id="opA" type="number" value="10" oninput="updateOps()"></div>
      <div style="display:flex;align-items:flex-end;padding-bottom:.3rem;font-size:1.5rem;color:var(--muted);">⊕</div>
      <div class="op-in-group"><label>Value B</label><input id="opB" type="number" value="3" oninput="updateOps()"></div>
    </div>
    <div class="op-results" id="opResults"></div>
  </div>

  <!-- Important: integer division warning -->
  <div class="tip-box" style="margin-top:1.5rem;">
    <div class="tip-icon">⚠️</div>
    <div class="tip-text"><strong>Integer Division Trap!</strong> In Arduino (and C++), <code style="color:var(--accent)">9 / 2</code> returns <code style="color:var(--accent2)">4</code>, not 4.5! Both sides are integers, so the decimal is dropped. To get 4.5, write <code style="color:var(--accent)">9.0 / 2</code> or <code style="color:var(--accent)">9 / 2.0</code> — one float makes the whole operation floating-point.</div>
  </div>
  <div class="tip-box">
    <div class="tip-icon">🎯</div>
    <div class="tip-text"><strong>map() vs constrain():</strong> <code style="color:var(--accent)">map(val, 0,1023, 0,255)</code> rescales a number from one range to another. <code style="color:var(--accent)">constrain(val, 0,255)</code> clamps a value so it never goes below 0 or above 255. Use both together: <code style="color:var(--accent)">constrain(map(val,0,1023,0,255), 0,255)</code> for safe PWM output.</div>
  </div>
</section>

<!-- ══════════════ CH16 — STRINGS & SERIAL ══════════════ -->
<div class="section-divider"></div>
<section id="strings">
  <div class="section-tag new-chapter-tag">Chapter 16 · NEW</div>
  <h2 class="section-title">Strings & <em>Serial Communication</em></h2>
  <p class="section-sub">Strings are sequences of characters — text, basically. Serial communication is how your Arduino talks to your computer through the USB cable. Together, they're your window into what's happening inside your code — like a walkie-talkie between the board and your screen.</p>

  <div class="two-col" style="margin-bottom:2rem;">
    <div class="highlight-box" style="margin:0;">
      <h3>📝 Two Ways to Store Text</h3>
      <div style="font-family:'JetBrains Mono',monospace;font-size:.75rem;line-height:2;margin-top:.75rem;">
        <span class="cmt">// C-style: char array (saves memory)</span><br>
        <span class="type">char</span> <span class="var">name</span>[] = <span class="str">"Arduino"</span>;<br>
        <span class="cmt">// name[0]='A', name[1]='r', etc.</span><br><br>
        <span class="cmt">// Arduino String class (easier)</span><br>
        <span class="type">String</span> <span class="var">msg</span> = <span class="str">"Hello "</span> + <span class="var">name</span>;<br>
        <span class="cmt">// msg = "Hello Arduino"</span>
      </div>
    </div>
    <div class="highlight-box" style="margin:0;">
      <h3>📡 Serial Functions</h3>
      <div style="font-family:'JetBrains Mono',monospace;font-size:.75rem;line-height:2;margin-top:.75rem;">
        <span class="fn">Serial</span>.<span class="fn">begin</span>(<span class="num">9600</span>);  <span class="cmt">// init</span><br>
        <span class="fn">Serial</span>.<span class="fn">print</span>(<span class="str">"hi"</span>);   <span class="cmt">// no newline</span><br>
        <span class="fn">Serial</span>.<span class="fn">println</span>(<span class="str">"hi"</span>); <span class="cmt">// + newline</span><br>
        <span class="fn">Serial</span>.<span class="fn">available</span>(); <span class="cmt">// bytes ready?</span><br>
        <span class="fn">Serial</span>.<span class="fn">read</span>();       <span class="cmt">// get one byte</span><br>
        <span class="fn">Serial</span>.<span class="fn">readString</span>(); <span class="cmt">// get string</span>
      </div>
    </div>
  </div>

  <!-- Interactive Serial Monitor -->
  <div class="serial-playground">
    <div class="section-tag" style="margin-bottom:1rem;">Interactive Demo</div>
    <h3 style="font-size:1.2rem;font-weight:700;margin-bottom:.25rem;">Virtual Serial Monitor</h3>
    <p style="color:var(--muted);font-size:.875rem;margin-bottom:1.5rem;">This simulates Arduino's Serial Monitor. Type a number (pin value), and the "sketch" responds as if it's running on a real board.</p>
    <div class="serial-layout">
      <div>
        <div style="font-family:'Space Mono',monospace;font-size:.72rem;color:var(--muted);margin-bottom:.5rem;">📋 Running Sketch:</div>
        <div style="background:#0d1117;border:1px solid var(--border);border-radius:10px;padding:1rem;font-family:'JetBrains Mono',monospace;font-size:.75rem;line-height:1.8;">
          <span class="type">void</span> <span class="fn">setup</span>() {<br>
          &nbsp;&nbsp;<span class="fn">Serial</span>.<span class="fn">begin</span>(<span class="num">9600</span>);<br>
          &nbsp;&nbsp;<span class="fn">Serial</span>.<span class="fn">println</span>(<span class="str">"Ready!"</span>);<br>
          }<br><br>
          <span class="type">void</span> <span class="fn">loop</span>() {<br>
          &nbsp;&nbsp;<span class="kw">if</span> (<span class="fn">Serial</span>.<span class="fn">available</span>()) {<br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="type">int</span> <span class="var">n</span> = <span class="fn">Serial</span>.<span class="fn">parseInt</span>();<br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="fn">Serial</span>.<span class="fn">print</span>(<span class="str">"Got: "</span>);<br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="fn">Serial</span>.<span class="fn">print</span>(<span class="var">n</span>);<br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="fn">Serial</span>.<span class="fn">print</span>(<span class="str">" → map→PWM: "</span>);<br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="fn">Serial</span>.<span class="fn">println</span>(<span class="fn">map</span>(<span class="var">n</span>,<span class="num">0</span>,<span class="num">1023</span>,<span class="num">0</span>,<span class="num">255</span>));<br>
          &nbsp;&nbsp;}<br>
          }
        </div>
        <div class="serial-input-wrap">
          <input class="serial-input" id="serialInput" type="text" placeholder="Type a number (0–1023) and press Send..." onkeydown="if(event.key==='Enter')sendSerial()">
          <button class="serial-send-btn" onclick="sendSerial()">Send →</button>
        </div>
      </div>
      <div>
        <div style="font-family:'Space Mono',monospace;font-size:.72rem;color:var(--muted);margin-bottom:.5rem;">📟 Serial Monitor (9600 baud):</div>
        <div class="serial-monitor-big" id="serialMonitorBig"></div>
      </div>
    </div>
  </div>

  <!-- String methods -->
  <div style="margin-top:2.5rem;">
    <div class="section-tag">Reference</div>
    <h3 style="font-size:1.3rem;font-weight:700;margin:.5rem 0 1.5rem;">String Methods — Quick Reference</h3>
    <div class="cards-grid">
      <div class="card">
        <div class="card-icon">📏</div>
        <h3>.length()</h3>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.75rem;margin:.5rem 0;"><span class="type">String</span> s = <span class="str">"Hello"</span>;<br>s.<span class="fn">length</span>(); <span class="cmt">// returns 5</span></div>
        <p>Returns the number of characters. Essential for looping through characters one by one.</p>
      </div>
      <div class="card">
        <div class="card-icon">🔍</div>
        <h3>.indexOf()</h3>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.75rem;margin:.5rem 0;">s.<span class="fn">indexOf</span>(<span class="str">'e'</span>); <span class="cmt">// returns 1</span><br>s.<span class="fn">indexOf</span>(<span class="str">"xyz"</span>); <span class="cmt">// -1 = not found</span></div>
        <p>Find where a character or substring appears. Returns -1 if not found.</p>
      </div>
      <div class="card">
        <div class="card-icon">✂️</div>
        <h3>.substring()</h3>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.75rem;margin:.5rem 0;">s.<span class="fn">substring</span>(<span class="num">1</span>, <span class="num">4</span>); <span class="cmt">// "ell"</span></div>
        <p>Extract a portion of a string. Start index is inclusive, end is exclusive. Just like Python slicing!</p>
      </div>
      <div class="card">
        <div class="card-icon">🔄</div>
        <h3>.toInt() / .toFloat()</h3>
        <div style="font-family:'JetBrains Mono',monospace;font-size:.75rem;margin:.5rem 0;"><span class="type">String</span> n = <span class="str">"42"</span>;<br>n.<span class="fn">toInt</span>(); <span class="cmt">// returns 42</span></div>
        <p>Convert a numeric string to a number. Critical for parsing Serial input from the user!</p>
      </div>
    </div>
    <div class="tip-box" style="margin-top:1rem;">
      <div class="tip-icon">⚠️</div>
      <div class="tip-text"><strong>String vs char[] on Microcontrollers:</strong> Arduino's <code style="color:var(--accent)">String</code> class is convenient but dynamically allocates memory — on a Uno with only 2KB of SRAM, this can cause memory fragmentation and crashes. For production code, prefer <code style="color:var(--accent)">char</code> arrays. For learning and simple projects, <code style="color:var(--accent)">String</code> is fine!</div>
    </div>
  </div>
</section>

<!-- ══════════════ CH17 — DEBUGGING ══════════════ -->
<div class="section-divider"></div>
<section id="debugging">
  <div class="section-tag new-chapter-tag">Chapter 17 · NEW</div>
  <h2 class="section-title">Debugging & <em>Common Errors</em></h2>
  <p class="section-sub">Every programmer fights bugs. The difference between beginners and pros isn't that pros don't make mistakes — it's that pros know exactly where to look. This chapter shows you the most common Arduino errors and exactly how to fix them.</p>

  <div class="highlight-box">
    <h3>🔦 The Debug Mindset</h3>
    <p>Think of debugging like being a detective. Your Arduino is the crime scene, and the bug is the culprit. Your main tools: <strong style="color:var(--accent)">Serial.println()</strong> (print the evidence), <strong style="color:var(--accent)">LED indicators</strong> (visual signals), and <strong style="color:var(--accent)">divide and conquer</strong> (comment out sections until the bug disappears). The bug always leaves clues.</p>
  </div>

  <!-- Common Errors Grid -->
  <h3 style="font-size:1.3rem;font-weight:700;margin:2.5rem 0 .5rem;">Most Common Arduino Errors</h3>
  <div class="error-cards">
    <div class="error-card">
      <div class="error-header">
        <div class="error-type">Compile Error</div>
        <div class="error-title">Missing Semicolon</div>
      </div>
      <div class="error-body">
        <div class="error-code">int x = 5   // ← missing ;
digitalWrite(13, HIGH)  // missing ;</div>
        <div class="error-fix">int x = 5;
digitalWrite(13, HIGH);</div>
        <div class="error-explain">Every statement in C++ must end with a semicolon. If you forget one, the compiler error often points to the <em>next</em> line (confusingly). Always check the line above where the error points.</div>
      </div>
    </div>
    <div class="error-card">
      <div class="error-header">
        <div class="error-type">Compile Error</div>
        <div class="error-title">Variable Not Declared</div>
      </div>
      <div class="error-body">
        <div class="error-code">'ledPin' was not declared in this scope
digitalWrite(ledPin, HIGH); // used before declared</div>
        <div class="error-fix">int ledPin = 13; // declare BEFORE using it
digitalWrite(ledPin, HIGH);</div>
        <div class="error-explain">You must declare a variable before you use it. This happens when you typo the name, or declare it inside a function but try to use it outside (scope issue).</div>
      </div>
    </div>
    <div class="error-card">
      <div class="error-header">
        <div class="error-type">Logic Bug</div>
        <div class="error-title">= vs == Confusion</div>
      </div>
      <div class="error-body">
        <div class="error-code">if (x = 5) { // ← assigns 5, always true!
  // this ALWAYS runs!</div>
        <div class="error-fix">if (x == 5) { // ← compares x to 5
  // only runs when x equals 5</div>
        <div class="error-explain">Single <code>=</code> is assignment (put value in box). Double <code>==</code> is comparison (is it equal?). Using = in an if condition is a legal C++ expression — it won't error, it just always evaluates to true if the value is non-zero. Very sneaky bug!</div>
      </div>
    </div>
    <div class="error-card">
      <div class="error-header">
        <div class="error-type">Hardware Bug</div>
        <div class="error-title">Floating Pin / Random Reads</div>
      </div>
      <div class="error-body">
        <div class="error-code">pinMode(2, INPUT); // floating pin!
digitalRead(2); // returns random 0/1</div>
        <div class="error-fix">pinMode(2, INPUT_PULLUP); // use internal resistor
// Now reads HIGH when open, LOW when button pressed</div>
        <div class="error-explain">An unconnected input pin floats — it picks up electromagnetic noise and gives random readings. Always use INPUT_PULLUP, or wire a 10kΩ pull-down resistor to GND.</div>
      </div>
    </div>
    <div class="error-card">
      <div class="error-header">
        <div class="error-type">Runtime Bug</div>
        <div class="error-title">Integer Overflow</div>
      </div>
      <div class="error-body">
        <div class="error-code">int count = 32767;
count++; // count is now -32768! 💥
// int max is 32,767 — it wraps around</div>
        <div class="error-fix">long count = 32767; // 4 bytes, holds 2.1 billion
unsigned long timer = millis(); // always use for millis()</div>
        <div class="error-explain">An int on Arduino is only 16-bit — max value is 32,767. If you go higher, it wraps to negative. This is especially dangerous with millis() — always use unsigned long for timing variables!</div>
      </div>
    </div>
    <div class="error-card">
      <div class="error-header">
        <div class="error-type">Logic Bug</div>
        <div class="error-title">Off-By-One (Array)</div>
      </div>
      <div class="error-body">
        <div class="error-code">int arr[5] = {1,2,3,4,5};
arr[5]; // ← index 5 doesn't exist! (0–4 only)
// reads random memory — undefined behavior</div>
        <div class="error-fix">arr[4]; // ← last valid index is SIZE-1
for(int i=0; i&lt;5; i++) // use < not <=</div>
        <div class="error-explain">Arrays are zero-indexed. An array of 5 has indices 0, 1, 2, 3, 4. Accessing index 5 reads beyond the array into unknown memory — it may work, crash, or corrupt data silently.</div>
      </div>
    </div>
  </div>

  <!-- Interactive Error Matcher -->
  <div class="error-matcher">
    <div class="section-tag" style="margin-bottom:1rem;">Interactive Tool</div>
    <h3 style="font-size:1.2rem;font-weight:700;margin-bottom:.25rem;">Error Message Decoder</h3>
    <p style="color:var(--muted);font-size:.875rem;margin-bottom:1.5rem;">Paste an Arduino error message below and get an instant plain-English diagnosis with a fix.</p>
    <textarea class="error-input-big" id="errorInput" placeholder="Paste your Arduino error here, e.g.:
error: 'ledPin' was not declared in this scope
expected ';' before 'void'
error: invalid conversion from 'int*' to 'int'" oninput="diagnoseError()"></textarea>
    <div class="error-diagnosis" id="errorDiagnosis">
      <span style="color:var(--muted);">// Paste an error message above to get a diagnosis...</span>
    </div>
  </div>

  <!-- Debugging strategies -->
  <div style="margin-top:2.5rem;">
    <div class="section-tag">Strategies</div>
    <h3 style="font-size:1.3rem;font-weight:700;margin:.5rem 0 1.5rem;">The Serial Debug Pattern</h3>
    <div class="code-editor">
      <div class="editor-header">
        <div class="editor-dots"><div class="editor-dot dot-red"></div><div class="editor-dot dot-yellow"></div><div class="editor-dot dot-green"></div></div>
        <span class="editor-title">debug_example.ino</span>
      </div>
      <div class="editor-body">
        <div class="line-nums">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</div>
        <div class="code-area"><code><span class="cmt">// Debug Pattern: print EVERYTHING suspicious</span>
<span class="cmt">// Comment out debug prints when done!</span>

<span class="type">void</span> <span class="fn">setup</span>() {
  <span class="fn">Serial</span>.<span class="fn">begin</span>(<span class="num">9600</span>);
  <span class="fn">Serial</span>.<span class="fn">println</span>(<span class="str">"=== Setup Start ==="</span>);
  <span class="fn">pinMode</span>(<span class="num">13</span>, <span class="kw">OUTPUT</span>);
  <span class="fn">Serial</span>.<span class="fn">println</span>(<span class="str">"Setup done."</span>);
}

<span class="type">void</span> <span class="fn">loop</span>() {
  <span class="type">int</span> <span class="var">sensorVal</span> = <span class="fn">analogRead</span>(<span class="num">A0</span>);

  <span class="cmt">// DEBUG: print the raw value to verify it's sensible</span>
  <span class="fn">Serial</span>.<span class="fn">print</span>(<span class="str">"Raw sensor: "</span>);
  <span class="fn">Serial</span>.<span class="fn">println</span>(<span class="var">sensorVal</span>);  <span class="cmt">// should be 0–1023</span>

  <span class="type">int</span> <span class="var">brightness</span> = <span class="fn">map</span>(<span class="var">sensorVal</span>, <span class="num">0</span>, <span class="num">1023</span>, <span class="num">0</span>, <span class="num">255</span>);

  <span class="cmt">// DEBUG: verify the mapped value too</span>
  <span class="fn">Serial</span>.<span class="fn">print</span>(<span class="str">"Mapped brightness: "</span>);
  <span class="fn">Serial</span>.<span class="fn">println</span>(<span class="var">brightness</span>);  <span class="cmt">// should be 0–255</span>

  <span class="fn">analogWrite</span>(<span class="num">9</span>, <span class="var">brightness</span>);
  <span class="fn">delay</span>(<span class="num">100</span>);
}</code></div>
      </div>
    </div>
    <div class="cards-grid" style="margin-top:1.5rem;">
      <div class="card">
        <div class="card-icon">🗂</div>
        <h3>Divide &amp; Conquer</h3>
        <p>Comment out half your code. Does the bug disappear? Then the bug is in the commented half. Keep halving until you find the exact line.</p>
      </div>
      <div class="card">
        <div class="card-icon">💡</div>
        <h3>LED as Debug Signal</h3>
        <p>No serial monitor? Flash the LED differently for different states. 1 blink = reached setup, 2 blinks = entered loop, 3 = sensor read OK. Primitive but effective!</p>
      </div>
      <div class="card">
        <div class="card-icon">🔬</div>
        <h3>Minimal Reproduction</h3>
        <p>Strip your code down to the absolute minimum that still shows the bug. Remove libraries, functions, and features one by one. When the bug vanishes, you know what caused it.</p>
      </div>
    </div>
  </div>
</section>

<!-- FOOTER -->
<footer>
  <h3>⚡ Keep Building!</h3>
  <p>You now have the foundation to create amazing things with Arduino. The best way to learn is to build, break things, and build again. The maker community is always here to help.</p>
  <div class="footer-links">
    <a href="https://www.arduino.cc/reference/en/" target="_blank">Arduino Reference</a>
    <a href="https://forum.arduino.cc/" target="_blank">Arduino Forum</a>
    <a href="https://projecthub.arduino.cc/" target="_blank">Project Hub</a>
    <a href="https://www.instructables.com/circuits/arduino/projects/" target="_blank">Instructables</a>
  </div>
  <div class="footer-copy">Built for curious beginners everywhere · Arduino Guide 2025</div>
</footer>

<button class="back-top" id="backTop" onclick="window.scrollTo({top:0,behavior:'smooth'})">↑</button>

<script>
// ═══════════════════════════════════════════════════
//  PROGRESS BAR + BACK TO TOP
// ═══════════════════════════════════════════════════
window.addEventListener('scroll', () => {
  const scrollTop = window.scrollY;
  const docHeight = document.documentElement.scrollHeight - window.innerHeight;
  document.getElementById('progressBar').style.width = (scrollTop/docHeight*100)+'%';
  const btn = document.getElementById('backTop');
  scrollTop > 300 ? btn.classList.add('show') : btn.classList.remove('show');
});

// ═══════════════════════════════════════════════════
//  COMPONENTS DATA
// ═══════════════════════════════════════════════════
const components = [
  { icon:'💡', name:'LED', desc:'Light Emitting Diode. A semiconductor device that emits light when current flows through it.', usage:'Used as indicators, status lights, and in light-dependent projects. Always needs a current-limiting resistor.', specs:['2–3.3V forward voltage','10–20mA typical current','220Ω–1kΩ resistor needed'] },
  { icon:'⬛', name:'Resistor', desc:'A passive component that limits (resists) the flow of electrical current in a circuit.', usage:'Protects LEDs and other components, creates voltage dividers, sets bias currents.', specs:['Rated in Ohms (Ω)','Color bands = value','1/4W common for 5V circuits'] },
  { icon:'🔘', name:'Button', desc:'A momentary tactile switch that connects two points when pressed and disconnects when released.', usage:'User input — detecting presses to trigger actions. Use with INPUT_PULLUP for simpler wiring.', specs:['Normally open (NO)','Use 10kΩ pull-down or INPUT_PULLUP','Bounces: use debounce logic'] },
  { icon:'🌀', name:'Potentiometer', desc:'A variable resistor with 3 terminals. Rotating the knob changes the resistance between outer and center pins.', usage:'Manual control of values — volume, speed, brightness. Connect to analog pin for 0–1023 reading.', specs:['Common: 10kΩ','3 pins: GND, signal, 5V','analogRead() gives 0–1023'] },
  { icon:'🌡️', name:'Thermistor / TMP36', desc:'A temperature-sensitive resistor (thermistor) or analog IC sensor (TMP36) that changes output based on heat.', usage:'Temperature monitoring projects, thermostats, weather stations.', specs:['TMP36: −40°C to 125°C','0°C = 0.5V output','Voltage formula: Temp°C = (V-0.5)×100'] },
  { icon:'📸', name:'Photoresistor (LDR)', desc:'Light Dependent Resistor — resistance decreases as light increases. Also called a photodiode or LDR.', usage:'Light detection, automatic lighting, line-following robots.', specs:['10kΩ in dark, <1kΩ in light','Use as voltage divider','analogRead() for light level'] },
  { icon:'📳', name:'Buzzer', desc:'A piezoelectric element that vibrates at a set frequency to produce a sound. Active buzzers have internal oscillator; passive ones need a PWM signal.', usage:'Alarms, feedback tones, melody playing.', specs:['Active: just digitalWrite','Passive: use tone() function','3–5V operating voltage'] },
  { icon:'🔄', name:'Servo Motor', desc:'A motor with built-in gearing and position feedback. Controlled by a PWM signal to rotate to a specific angle (0–180°).', usage:'Robotic arms, camera panning, door mechanisms.', specs:['Signal: 50Hz PWM','0°→1ms, 90°→1.5ms, 180°→2ms','Servo.h library built-in'] },
  { icon:'📺', name:'LCD Display', desc:'Liquid Crystal Display module — typically a 16×2 (16 chars, 2 rows) display controlled via I2C or parallel interface.', usage:'Displaying sensor values, messages, menus.', specs:['16×2 or 20×4 common','I2C module needs only 2 wires','LiquidCrystal_I2C library'] },
  { icon:'📡', name:'Ultrasonic Sensor', desc:'The HC-SR04 sends an ultrasonic pulse and measures the echo time to calculate distance.', usage:'Obstacle avoidance, distance measurement, parking sensors, robotics.', specs:['2cm–400cm range','~3mm accuracy','Uses Trig + Echo pins'] },
  { icon:'🔌', name:'Capacitor', desc:'Stores electrical energy in an electric field. Acts as a tiny rechargeable battery or a high-pass/low-pass filter.', usage:'Debouncing, smoothing power supply, filtering noise from motors.', specs:['Measured in Farads (F)','Electrolytic: polarized!','100µF common for power filtering'] },
  { icon:'↕️', name:'Transistor', desc:'A semiconductor that acts as an electronic switch or amplifier. NPN type is most common in Arduino projects.', usage:'Controlling high-current devices (motors, relays, high-power LEDs) with Arduino pins.', specs:['Common: 2N2222, BC547, NPN','Base current controls collector','R needed on base: ~1kΩ'] },
];

const grid = document.getElementById('componentsGrid');
const detail = document.getElementById('componentDetail');
let selectedComp = -1;

components.forEach((c,i) => {
  const el = document.createElement('div');
  el.className = 'component-card';
  el.innerHTML = `<span class="component-icon">${c.icon}</span><div class="component-name">${c.name}</div><div class="component-desc">${c.desc.split('.')[0]}.</div>`;
  el.onclick = () => selectComponent(i, el);
  grid.appendChild(el);
});

function selectComponent(i, el) {
  document.querySelectorAll('.component-card').forEach(c=>c.classList.remove('selected'));
  el.classList.add('selected');
  const c = components[i];
  document.getElementById('detailName').textContent = c.icon + ' ' + c.name;
  document.getElementById('detailDesc').textContent = c.desc;
  document.getElementById('detailUsage').innerHTML = '<strong style="color:var(--accent2)">When to use: </strong>' + c.usage;
  const specsEl = document.getElementById('detailSpecs');
  specsEl.innerHTML = c.specs.map(s=>`<span class="spec-tag">${s}</span>`).join('');
  detail.classList.add('visible');
  detail.scrollIntoView({behavior:'smooth', block:'nearest'});
}

// ═══════════════════════════════════════════════════
//  OHM'S LAW CALCULATOR
// ═══════════════════════════════════════════════════
function calcOhm() {
  const v = parseFloat(document.getElementById('calcV').value);
  const i = parseFloat(document.getElementById('calcI').value);
  const r = parseFloat(document.getElementById('calcR').value);
  const res = document.getElementById('calcResult');
  let msg = '';

  if (!isNaN(v) && !isNaN(i) && isNaN(r)) {
    const calc = v/i;
    msg = `Resistance (R) = V/I = ${v}V / ${i}A = <strong>${calc.toFixed(2)} Ω</strong>`;
    document.getElementById('calcR').value = calc.toFixed(2);
  } else if (!isNaN(v) && isNaN(i) && !isNaN(r)) {
    const calc = v/r;
    msg = `Current (I) = V/R = ${v}V / ${r}Ω = <strong>${calc.toFixed(4)} A (${(calc*1000).toFixed(1)} mA)</strong>`;
    document.getElementById('calcI').value = calc.toFixed(4);
  } else if (isNaN(v) && !isNaN(i) && !isNaN(r)) {
    const calc = i*r;
    msg = `Voltage (V) = I×R = ${i}A × ${r}Ω = <strong>${calc.toFixed(2)} V</strong>`;
    document.getElementById('calcV').value = calc.toFixed(2);
  } else if (!isNaN(v) && !isNaN(i) && !isNaN(r)) {
    const power = v*i;
    msg = `Power (P) = V×I = <strong>${power.toFixed(3)} W</strong>  |  Check: V/I = ${(v/i).toFixed(1)}Ω vs entered ${r}Ω`;
  } else {
    msg = 'Enter exactly two values to calculate the third.';
  }

  res.innerHTML = msg;
  res.classList.add('visible');
}

function clearCalc() {
  ['calcV','calcI','calcR'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('calcResult').classList.remove('visible');
}

// ═══════════════════════════════════════════════════
//  CIRCUIT ANIMATOR
// ═══════════════════════════════════════════════════
const canvas = document.getElementById('circuitCanvas');
const ctx = canvas.getContext('2d');

const circuitData = [
  {
    how: ['Current flows from 5V pin through resistor','Resistor limits current to ~20mA','Current flows through LED (anode to cathode)','Returns to GND (0V)'],
    key: ['Always use a resistor with an LED','Typical: 220Ω for 5V circuit','LED has polarity: long leg (+) to 5V','No resistor = burned LED!'],
    draw: drawLedCircuit
  },
  {
    how: ['Button connects/breaks the circuit','When pressed: signal pin reads HIGH','When released: pull-down resistor pulls to LOW','INPUT_PULLUP inverts this logic'],
    key: ['Debounce in software or hardware','10kΩ pull-down prevents floating pin','INPUT_PULLUP uses internal 20kΩ resistor','Bouncing causes false triggers'],
    draw: drawButtonCircuit
  },
  {
    how: ['Two resistors divide supply voltage','Output voltage = V × R2/(R1+R2)','Used to scale voltages down safely','Example: 10V → 5V for Arduino input'],
    key: ['Arduino analog inputs max 5V!','Use divider to read higher voltages','Sensor outputs often need dividers','Output impedance affects accuracy'],
    draw: drawDividerCircuit
  },
  {
    how: ['Series: same current, voltages add up','Parallel: same voltage, currents add up','Series LEDs: brightness drops if one fails','Parallel LEDs: each needs its own resistor'],
    key: ['Series: V = V1+V2+V3','Parallel: I = I1+I2+I3','Batteries in series = more voltage','Batteries in parallel = more capacity'],
    draw: drawSeriesParallelCircuit
  }
];

let currentCircuit = 0;
let animFrame = 0;
let animId;
let flowOffset = 0;

function switchCircuit(idx, el) {
  currentCircuit = idx;
  document.querySelectorAll('.circuit-tab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  flowOffset = 0;
  const d = circuitData[idx];
  document.getElementById('howItWorks').innerHTML = d.how.map(h=>`<li>${h}</li>`).join('');
  document.getElementById('keyPoints').innerHTML = d.key.map(k=>`<li>${k}</li>`).join('');
}

function drawLedCircuit(t) {
  const w = canvas.width, h = canvas.height;
  ctx.clearRect(0,0,w,h);
  ctx.strokeStyle = '#2a3560'; ctx.lineWidth = 1;
  ctx.strokeRect(0,0,w,h);

  // Background
  ctx.fillStyle = '#0a0e1a';
  ctx.fillRect(0,0,w,h);

  const cx = w/2, cy = h/2;

  // Wire path: Arduino 5V → Resistor → LED → GND
  // Points: A(120,cy) [5V pin] → B(220,cy) [R left] → C(320,cy) [R right] → D(430,cy) [LED anode] → E(530,cy) [LED cathode] → F(530,220) → G(120,220) → back to A
  const pts = [
    [120,cy],[220,cy],[320,cy],[430,cy],[530,cy],[530,200],[120,200],[120,cy]
  ];

  // Draw wires
  ctx.strokeStyle = '#2a5080'; ctx.lineWidth = 3;
  ctx.beginPath(); ctx.moveTo(...pts[0]);
  pts.forEach(p=>ctx.lineTo(...p));
  ctx.stroke();

  // Animated current particles
  const pathLen = pts.length-1;
  const particleCount = 8;
  ctx.fillStyle = '#00d4ff';
  for(let p=0;p<particleCount;p++) {
    const pos = ((t*0.008 + p/particleCount) % 1);
    const segCount = pathLen;
    const totalPos = pos * segCount;
    const seg = Math.floor(totalPos) % segCount;
    const frac = totalPos - Math.floor(totalPos);
    const x1=pts[seg][0], y1=pts[seg][1], x2=pts[seg+1][0], y2=pts[seg+1][1];
    const px = x1+(x2-x1)*frac, py = y1+(y2-y1)*frac;
    ctx.beginPath();
    ctx.arc(px, py, 3, 0, Math.PI*2);
    ctx.fill();
  }

  // Arduino board (simplified)
  ctx.fillStyle = '#1a5c38'; ctx.strokeStyle = '#2ca86e'; ctx.lineWidth = 2;
  roundRect(ctx, 40, cy-50, 80, 100, 8);
  ctx.fill(); ctx.stroke();
  ctx.fillStyle = '#e8eaf6'; ctx.font = 'bold 9px Space Mono'; ctx.textAlign = 'center';
  ctx.fillText('ARDUINO', 80, cy-8);
  ctx.fillStyle = '#00ff88'; ctx.font = '8px Space Mono';
  ctx.fillText('5V ●', 80, cy+8);
  ctx.fillText('GND ●', 80, cy+20);

  // Resistor (zig-zag)
  ctx.strokeStyle = '#f59e0b'; ctx.lineWidth = 2.5;
  ctx.beginPath();
  ctx.moveTo(220,cy);
  const zigX = [230,237,244,251,258,265,272,279,286,293,300,310];
  const zigY = [cy, cy-12, cy+12, cy-12, cy+12, cy-12, cy+12, cy-12, cy+12, cy-12, cy+12, cy];
  zigX.forEach((x,i)=>ctx.lineTo(x,zigY[i]));
  ctx.stroke();
  ctx.fillStyle = '#f59e0b'; ctx.font = 'bold 10px Syne'; ctx.textAlign = 'center';
  ctx.fillText('220Ω', 265, cy-20);

  // LED
  ctx.fillStyle = '#ff6b35';
  // Triangle (anode to cathode)
  ctx.beginPath();
  ctx.moveTo(430,cy-16); ctx.lineTo(470,cy); ctx.lineTo(430,cy+16); ctx.closePath();
  ctx.fill();
  ctx.strokeStyle = '#ff6b35'; ctx.lineWidth = 2.5;
  ctx.beginPath(); ctx.moveTo(470,cy-16); ctx.lineTo(470,cy+16); ctx.stroke();
  // LED glow
  ctx.shadowColor = '#ff6b35'; ctx.shadowBlur = 20;
  ctx.beginPath(); ctx.arc(450,cy,18,0,Math.PI*2);
  ctx.fillStyle = 'rgba(255,107,53,0.15)'; ctx.fill();
  ctx.shadowBlur = 0;
  ctx.fillStyle = '#ff6b35'; ctx.font = 'bold 10px Syne'; ctx.textAlign = 'center';
  ctx.fillText('LED', 450, cy+32);

  // GND symbol
  ctx.strokeStyle = '#8892b0'; ctx.lineWidth = 2;
  ctx.beginPath(); ctx.moveTo(530,200); ctx.lineTo(530,185); ctx.stroke();
  for(let i=0;i<3;i++) {
    const y = 185-i*6, hw = 12-i*3;
    ctx.beginPath(); ctx.moveTo(530-hw,y); ctx.lineTo(530+hw,y); ctx.stroke();
  }
  ctx.fillStyle = '#8892b0'; ctx.font = '9px Space Mono'; ctx.textAlign = 'center';
  ctx.fillText('GND', 530, 170);

  // Labels
  ctx.fillStyle = '#00d4ff'; ctx.font = '9px Space Mono'; ctx.textAlign = 'left';
  ctx.fillText('→ 5V', 125, cy-6);
}

function drawButtonCircuit(t) {
  const w=canvas.width, h=canvas.height;
  ctx.clearRect(0,0,w,h);
  ctx.fillStyle='#0a0e1a'; ctx.fillRect(0,0,w,h);

  const cy=h/2;
  const pressed = Math.sin(t*0.03) > 0.3;

  // Wires
  ctx.strokeStyle = pressed ? '#2a5080' : '#1a2840'; ctx.lineWidth = 3;
  // 5V → Button → Arduino pin
  ctx.beginPath();
  ctx.moveTo(100,cy); ctx.lineTo(230,cy); ctx.stroke();
  ctx.strokeStyle = '#2a5080';
  ctx.beginPath();
  ctx.moveTo(330,cy); ctx.lineTo(440,cy); ctx.stroke();
  // Pull-down resistor to GND
  ctx.beginPath();
  ctx.moveTo(380,cy); ctx.lineTo(380,cy+80); ctx.lineTo(280,cy+80); ctx.stroke();
  // GND line
  ctx.strokeStyle = '#1a2840';
  ctx.beginPath();
  ctx.moveTo(100,cy+80); ctx.lineTo(280,cy+80); ctx.stroke();
  ctx.beginPath();
  ctx.moveTo(100,cy); ctx.lineTo(100,cy+80); ctx.stroke();

  // Current particles (only when pressed)
  if(pressed) {
    ctx.fillStyle='#00ff88';
    for(let p=0;p<6;p++) {
      const pos = ((t*0.01+p/6)%1);
      let px,py;
      if(pos<0.4) { px=100+pos/0.4*230; py=cy; }
      else if(pos<0.8) { px=330+(pos-0.4)/0.4*110; py=cy; }
      else { px=440; py=cy; }
      ctx.beginPath(); ctx.arc(px,py,3,0,Math.PI*2); ctx.fill();
    }
  }

  // Button symbol
  ctx.strokeStyle = '#d4a853'; ctx.lineWidth = 2.5;
  ctx.beginPath(); ctx.moveTo(230,cy); ctx.lineTo(255,cy); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(305,cy); ctx.lineTo(330,cy); ctx.stroke();
  // Button terminals
  ctx.beginPath(); ctx.moveTo(255,cy-15); ctx.lineTo(255,cy+15); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(305,cy-15); ctx.lineTo(305,cy+15); ctx.stroke();
  if(pressed) {
    ctx.strokeStyle='#00ff88';
    ctx.beginPath(); ctx.moveTo(255,cy); ctx.lineTo(305,cy); ctx.stroke();
  }
  // Button physical
  ctx.fillStyle = pressed ? '#00ff88' : '#d4a853';
  ctx.fillRect(263,cy-24,34,10);
  ctx.fillStyle='#e8eaf6'; ctx.font='10px Syne'; ctx.textAlign='center';
  ctx.fillText(pressed?'PRESSED':'OPEN', 280,cy-30);

  // Pull-down R
  ctx.strokeStyle='#f59e0b'; ctx.lineWidth=2.5;
  ctx.beginPath(); ctx.moveTo(380,cy+20);
  const zigX2=[380,387,373,387,373,387,373,380];
  const zigY2=[cy+20,cy+28,cy+36,cy+44,cy+52,cy+60,cy+68,cy+76];
  zigX2.forEach((x,i)=>ctx.lineTo(x,zigY2[i]));
  ctx.stroke();
  ctx.fillStyle='#f59e0b'; ctx.font='9px Space Mono'; ctx.textAlign='left';
  ctx.fillText('10kΩ', 393,cy+50);

  // Arduino
  ctx.fillStyle='#1a5c38'; ctx.strokeStyle='#2ca86e'; ctx.lineWidth=2;
  roundRect(ctx,410,cy-50,80,100,8); ctx.fill(); ctx.stroke();
  ctx.fillStyle='#e8eaf6'; ctx.font='bold 9px Space Mono'; ctx.textAlign='center';
  ctx.fillText('ARDUINO',450,cy-8);
  ctx.fillStyle=pressed?'#00ff88':'#8892b0';
  ctx.fillText(pressed?'PIN 2: HIGH':'PIN 2: LOW',450,cy+10);

  // GND symbol
  ctx.strokeStyle='#8892b0'; ctx.lineWidth=2;
  for(let i=0;i<3;i++){const hw=12-i*3; ctx.beginPath(); ctx.moveTo(190-hw,cy+80+i*6); ctx.lineTo(190+hw,cy+80+i*6); ctx.stroke();}
  ctx.fillStyle='#8892b0'; ctx.font='9px Space Mono'; ctx.textAlign='center';
  ctx.fillText('GND',190,cy+108);
}

function drawDividerCircuit(t) {
  const w=canvas.width, h=canvas.height;
  ctx.clearRect(0,0,w,h); ctx.fillStyle='#0a0e1a'; ctx.fillRect(0,0,w,h);

  const cx=240, top=60, bot=240;

  // Wires
  ctx.strokeStyle='#2a5080'; ctx.lineWidth=3;
  ctx.beginPath(); ctx.moveTo(cx,top); ctx.lineTo(cx,bot); ctx.stroke();

  // Particles
  ctx.fillStyle='#00d4ff';
  for(let p=0;p<5;p++){
    const pos=((t*0.005+p/5)%1);
    ctx.beginPath(); ctx.arc(cx,top+pos*(bot-top),3,0,Math.PI*2); ctx.fill();
  }

  // R1
  ctx.strokeStyle='#f59e0b'; ctx.lineWidth=2.5;
  const r1y=[90,98,107,116,125,134,143,150];
  ctx.beginPath(); ctx.moveTo(cx,90);
  r1y.forEach((y,i)=>ctx.lineTo(cx+(i%2?12:-12),y));
  ctx.lineTo(cx,152); ctx.stroke();
  ctx.fillStyle='#f59e0b'; ctx.font='10px Space Mono'; ctx.textAlign='left';
  ctx.fillText('R1 = 10kΩ',cx+20,118);

  // R2
  ctx.strokeStyle='#a78bfa'; ctx.lineWidth=2.5;
  const r2y=[158,166,175,184,193,202,211,218];
  ctx.beginPath(); ctx.moveTo(cx,158);
  r2y.forEach((y,i)=>ctx.lineTo(cx+(i%2?12:-12),y));
  ctx.lineTo(cx,220); ctx.stroke();
  ctx.fillStyle='#a78bfa'; ctx.font='10px Space Mono'; ctx.textAlign='left';
  ctx.fillText('R2 = 10kΩ',cx+20,188);

  // Labels
  ctx.fillStyle='#00d4ff'; ctx.font='bold 12px Syne'; ctx.textAlign='center';
  ctx.fillText('Vin = 10V',cx,48);
  ctx.fillStyle='#8892b0';
  ctx.fillText('GND',cx,255);

  // Output tap
  ctx.strokeStyle='#00ff88'; ctx.lineWidth=2;
  ctx.beginPath(); ctx.moveTo(cx,155); ctx.lineTo(cx+80,155); ctx.stroke();
  ctx.fillStyle='#00ff88'; ctx.font='11px Syne'; ctx.textAlign='left';
  ctx.fillText('Vout = 5V',cx+85,159);
  ctx.font='9px Space Mono';
  ctx.fillText('(Vin × R2/(R1+R2))',cx+85,172);

  // Arrow to Arduino
  ctx.strokeStyle='#00ff88'; ctx.lineWidth=1.5;
  ctx.beginPath(); ctx.moveTo(cx+150,155); ctx.lineTo(cx+190,155); ctx.stroke();
  ctx.fillStyle='#1a5c38'; ctx.strokeStyle='#2ca86e'; ctx.lineWidth=2;
  roundRect(ctx,cx+190,110,90,90,8); ctx.fill(); ctx.stroke();
  ctx.fillStyle='#e8eaf6'; ctx.font='bold 9px Space Mono'; ctx.textAlign='center';
  ctx.fillText('ARDUINO',cx+235,155);
  ctx.fillStyle='#00d4ff'; ctx.font='8px Space Mono';
  ctx.fillText('analogRead(A0)',cx+235,168);
  ctx.fillText('→ ~512',cx+235,180);

  // Voltage indicator bar
  const barX=440, barY=80, barW=20, barH=160;
  ctx.fillStyle='#1a2240'; ctx.strokeStyle='#2a3560'; ctx.lineWidth=1;
  ctx.fillRect(barX,barY,barW,barH); ctx.strokeRect(barX,barY,barW,barH);
  const grad=ctx.createLinearGradient(0,barY+barH,0,barY);
  grad.addColorStop(0,'#2a3560'); grad.addColorStop(0.5,'#00d4ff'); grad.addColorStop(1,'#00ff88');
  ctx.fillStyle=grad; ctx.fillRect(barX,barY+barH/2,barW,barH/2);
  ctx.fillStyle='#e8eaf6'; ctx.font='9px Space Mono'; ctx.textAlign='center';
  ctx.fillText('10V',barX+10,barY-5);
  ctx.fillText('5V',barX+10,barY+barH/2-4);
  ctx.fillText('0V',barX+10,barY+barH+12);
}

function drawSeriesParallelCircuit(t) {
  const w=canvas.width, h=canvas.height;
  ctx.clearRect(0,0,w,h); ctx.fillStyle='#0a0e1a'; ctx.fillRect(0,0,w,h);

  // Title labels
  ctx.fillStyle='#e8eaf6'; ctx.font='bold 13px Syne'; ctx.textAlign='center';
  ctx.fillText('SERIES',170,40);
  ctx.fillText('PARALLEL',500,40);

  ctx.strokeStyle='#333'; ctx.lineWidth=1; ctx.setLineDash([5,5]);
  ctx.beginPath(); ctx.moveTo(340,0); ctx.lineTo(340,300); ctx.stroke();
  ctx.setLineDash([]);

  // ── SERIES CIRCUIT ──
  const sy=150;
  // Wires
  ctx.strokeStyle='#2a5080'; ctx.lineWidth=3;
  ctx.beginPath(); ctx.moveTo(40,sy); ctx.lineTo(300,sy); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(300,sy); ctx.lineTo(300,sy+70); ctx.lineTo(40,sy+70); ctx.lineTo(40,sy); ctx.stroke();

  // 3 LEDs in series
  const ledXs=[90,170,250];
  ledXs.forEach((x,i)=>{
    const brightness=Math.sin(t*0.02+i*0.5)*0.3+0.7;
    ctx.fillStyle=`rgba(255,107,53,${brightness})`;
    ctx.beginPath(); ctx.moveTo(x-12,sy-12); ctx.lineTo(x+10,sy); ctx.lineTo(x-12,sy+12); ctx.closePath(); ctx.fill();
    ctx.strokeStyle='#ff6b35'; ctx.lineWidth=2; ctx.beginPath(); ctx.moveTo(x+10,sy-12); ctx.lineTo(x+10,sy+12); ctx.stroke();
    ctx.shadowColor='#ff6b35'; ctx.shadowBlur=15*brightness;
    ctx.beginPath(); ctx.arc(x,sy,8,0,Math.PI*2); ctx.fillStyle=`rgba(255,107,53,0.2)`; ctx.fill();
    ctx.shadowBlur=0;
  });

  // Particles
  ctx.fillStyle='#00d4ff';
  for(let p=0;p<5;p++){
    const pos=((t*0.007+p/5)%1);
    let px=40+pos*260, py=sy;
    if(pos>0.9){py=sy+(pos-0.9)/0.1*70;}
    ctx.beginPath(); ctx.arc(px,py,3,0,Math.PI*2); ctx.fill();
  }

  ctx.fillStyle='#8892b0'; ctx.font='9px Space Mono'; ctx.textAlign='center';
  ctx.fillText('Same current ↓',170,sy+90);
  ctx.fillText('Voltages add up',170,sy+103);

  // ── PARALLEL CIRCUIT ──
  const py2=120;
  ctx.strokeStyle='#2a5080'; ctx.lineWidth=3;
  // Main rails
  ctx.beginPath(); ctx.moveTo(370,80); ctx.lineTo(640,80); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(370,220); ctx.lineTo(640,220); ctx.stroke();

  // 3 parallel LEDs
  const pleds=[410,500,590];
  pleds.forEach((x,i)=>{
    const brightness=Math.sin(t*0.02+i*0.7)*0.2+0.8;
    // Branch wires
    ctx.strokeStyle='#2a5080'; ctx.lineWidth=2;
    ctx.beginPath(); ctx.moveTo(x,80); ctx.lineTo(x,140); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(x,175); ctx.lineTo(x,220); ctx.stroke();

    ctx.fillStyle=`rgba(255,107,53,${brightness})`;
    ctx.beginPath(); ctx.moveTo(x-10,140); ctx.lineTo(x+10,157); ctx.lineTo(x-10,175); ctx.closePath(); ctx.fill();
    ctx.strokeStyle='#ff6b35'; ctx.lineWidth=2; ctx.beginPath(); ctx.moveTo(x+10,140); ctx.lineTo(x+10,175); ctx.stroke();
    ctx.shadowColor='#ff6b35'; ctx.shadowBlur=12*brightness;
    ctx.beginPath(); ctx.arc(x,157,7,0,Math.PI*2); ctx.fillStyle=`rgba(255,107,53,0.2)`; ctx.fill();
    ctx.shadowBlur=0;
  });

  // Particles on rails
  ctx.fillStyle='#00d4ff';
  for(let p=0;p<4;p++){
    const pos=((t*0.009+p/4)%1);
    const px=370+pos*270;
    ctx.beginPath(); ctx.arc(px,80,3,0,Math.PI*2); ctx.fill();
  }

  ctx.fillStyle='#8892b0'; ctx.font='9px Space Mono'; ctx.textAlign='center';
  ctx.fillText('Same voltage ↕',500,240);
  ctx.fillText('Currents add up',500,253);

  // Voltage labels
  ctx.fillStyle='#00d4ff'; ctx.font='bold 10px Space Mono'; ctx.textAlign='center';
  ctx.fillText('5V',370,70); ctx.fillText('GND',370,230);
}

function roundRect(ctx,x,y,w,h,r){
  ctx.beginPath();
  ctx.moveTo(x+r,y); ctx.lineTo(x+w-r,y);
  ctx.quadraticCurveTo(x+w,y,x+w,y+r);
  ctx.lineTo(x+w,y+h-r);
  ctx.quadraticCurveTo(x+w,y+h,x+w-r,y+h);
  ctx.lineTo(x+r,y+h);
  ctx.quadraticCurveTo(x,y+h,x,y+h-r);
  ctx.lineTo(x,y+r);
  ctx.quadraticCurveTo(x,y,x+r,y);
  ctx.closePath();
}

let frame=0;
function animateCircuit(){
  circuitData[currentCircuit].draw(frame);
  frame++;
  requestAnimationFrame(animateCircuit);
}

// Init circuit info
document.getElementById('howItWorks').innerHTML = circuitData[0].how.map(h=>`<li>${h}</li>`).join('');
document.getElementById('keyPoints').innerHTML = circuitData[0].key.map(k=>`<li>${k}</li>`).join('');
animateCircuit();

// ═══════════════════════════════════════════════════
//  CODE EDITOR + VISUAL SIMULATOR
// ═══════════════════════════════════════════════════
const snippets = [
  {
    label: 'blink', title: 'blink.ino',
    lines: 14,
    code: `<span class="cmt">// Classic Blink — Hello World of Arduino!</span>
<span class="cmt">// Pin 13 has a built-in LED on most boards</span>

<span class="kw">const</span> <span class="type">int</span> <span class="var">LED_PIN</span> = <span class="num">13</span>;

<span class="type">void</span> <span class="fn">setup</span>() {
  <span class="fn">pinMode</span>(<span class="var">LED_PIN</span>, <span class="kw">OUTPUT</span>);
}

<span class="type">void</span> <span class="fn">loop</span>() {
  <span class="fn">digitalWrite</span>(<span class="var">LED_PIN</span>, <span class="kw">HIGH</span>);  <span class="cmt">// LED ON</span>
  <span class="fn">delay</span>(<span class="num">1000</span>);
  <span class="fn">digitalWrite</span>(<span class="var">LED_PIN</span>, <span class="kw">LOW</span>);   <span class="cmt">// LED OFF</span>
  <span class="fn">delay</span>(<span class="num">1000</span>);
}`,
    sim: ['⚡ pinMode(13, OUTPUT)','💡 LED ON  → HIGH','⏳ delay(1000ms)...','🌑 LED OFF → LOW','⏳ delay(1000ms)...','💡 LED ON  (repeating)','🌑 LED OFF (repeating)','✅ Blinks every 1 second!']
  },
  {
    label: 'button', title: 'button.ino',
    lines: 16,
    code: `<span class="cmt">// Button controls LED</span>
<span class="kw">const</span> <span class="type">int</span> <span class="var">BTN</span> = <span class="num">2</span>;
<span class="kw">const</span> <span class="type">int</span> <span class="var">LED</span> = <span class="num">13</span>;

<span class="type">void</span> <span class="fn">setup</span>() {
  <span class="fn">pinMode</span>(<span class="var">LED</span>, <span class="kw">OUTPUT</span>);
  <span class="fn">pinMode</span>(<span class="var">BTN</span>, <span class="kw">INPUT_PULLUP</span>);
}

<span class="type">void</span> <span class="fn">loop</span>() {
  <span class="type">int</span> <span class="var">state</span> = <span class="fn">digitalRead</span>(<span class="var">BTN</span>);
  <span class="kw">if</span> (<span class="var">state</span> <span class="op">==</span> <span class="kw">LOW</span>) {
    <span class="fn">digitalWrite</span>(<span class="var">LED</span>, <span class="kw">HIGH</span>);
  } <span class="kw">else</span> {
    <span class="fn">digitalWrite</span>(<span class="var">LED</span>, <span class="kw">LOW</span>);
  }
}`,
    sim: ['🔘 Button: NOT pressed','💡 LED → OFF','--- Click the button! ---','🔘 Button PRESSED → LOW','💡 LED → ON','🔘 Button released','💡 LED → OFF','✅ Button controls LED!']
  },
  {
    label: 'analog', title: 'analog.ino',
    lines: 13,
    code: `<span class="cmt">// Potentiometer dims an LED</span>
<span class="kw">const</span> <span class="type">int</span> <span class="var">POT</span> = <span class="num">A0</span>;
<span class="kw">const</span> <span class="type">int</span> <span class="var">LED</span> = <span class="num">9</span>;   <span class="cmt">// PWM pin ~</span>

<span class="type">void</span> <span class="fn">setup</span>() {
  <span class="fn">pinMode</span>(<span class="var">LED</span>, <span class="kw">OUTPUT</span>);
}

<span class="type">void</span> <span class="fn">loop</span>() {
  <span class="type">int</span> <span class="var">val</span> = <span class="fn">analogRead</span>(<span class="var">POT</span>);
  <span class="type">int</span> <span class="var">bright</span> = <span class="fn">map</span>(<span class="var">val</span>, <span class="num">0</span>, <span class="num">1023</span>, <span class="num">0</span>, <span class="num">255</span>);
  <span class="fn">analogWrite</span>(<span class="var">LED</span>, <span class="var">bright</span>);
  <span class="fn">delay</span>(<span class="num">10</span>);
}`,
    sim: ['🎛 Drag the knob!','🎛 Pot=0: analogRead=0','🌑 analogWrite(9, 0) → OFF','🎛 Pot=50%: read=512','🌗 analogWrite(9,127) → 50%','🎛 Pot=100%: read=1023','💡 analogWrite(9,255) → FULL','✅ Potentiometer dims LED!']
  },
  {
    label: 'serial', title: 'serial.ino',
    lines: 14,
    code: `<span class="cmt">// Serial Monitor output</span>
<span class="type">int</span> <span class="var">count</span> = <span class="num">0</span>;

<span class="type">void</span> <span class="fn">setup</span>() {
  <span class="fn">Serial</span>.<span class="fn">begin</span>(<span class="num">9600</span>);
  <span class="fn">Serial</span>.<span class="fn">println</span>(<span class="str">"Arduino ready! 🚀"</span>);
}

<span class="type">void</span> <span class="fn">loop</span>() {
  <span class="var">count</span><span class="op">++</span>;
  <span class="fn">Serial</span>.<span class="fn">print</span>(<span class="str">"Loop #"</span>);
  <span class="fn">Serial</span>.<span class="fn">println</span>(<span class="var">count</span>);
  <span class="fn">delay</span>(<span class="num">500</span>);
}`,
    sim: ['📡 Serial.begin(9600)','Arduino ready! 🚀','Loop #1','Loop #2','Loop #3','Loop #4','Loop #5','... (forever!)','✅ Open: Tools→Serial Monitor']
  },
  {
    label: 'servo', title: 'servo.ino',
    lines: 17,
    code: `<span class="kw">#include</span> <span class="str">&lt;Servo.h&gt;</span>
<span class="type">Servo</span> <span class="var">myServo</span>;

<span class="type">void</span> <span class="fn">setup</span>() {
  <span class="var">myServo</span>.<span class="fn">attach</span>(<span class="num">9</span>);
}

<span class="type">void</span> <span class="fn">loop</span>() {
  <span class="kw">for</span> (<span class="type">int</span> p=<span class="num">0</span>; p&lt;=<span class="num">180</span>; p++) {
    <span class="var">myServo</span>.<span class="fn">write</span>(p);
    <span class="fn">delay</span>(<span class="num">15</span>);
  }
  <span class="kw">for</span> (<span class="type">int</span> p=<span class="num">180</span>; p&gt;=<span class="num">0</span>; p--) {
    <span class="var">myServo</span>.<span class="fn">write</span>(p);
    <span class="fn">delay</span>(<span class="num">15</span>);
  }
}`,
    sim: ['📚 Servo.h loaded','⚙️ Attached to pin 9','🔄 Sweep 0° → 180°...','📍 pos=0°','📍 pos=90°','📍 pos=180°','🔄 Sweep 180° → 0°...','🔁 Repeating...','✅ Servo sweeping!']
  },
  {
    label: 'pwm', title: 'pwm_fade.ino',
    lines: 14,
    code: `<span class="kw">const</span> <span class="type">int</span> <span class="var">LED</span> = <span class="num">9</span>;
<span class="type">float</span> <span class="var">angle</span> = <span class="num">0</span>;

<span class="type">void</span> <span class="fn">setup</span>() {
  <span class="fn">pinMode</span>(<span class="var">LED</span>, <span class="kw">OUTPUT</span>);
}

<span class="type">void</span> <span class="fn">loop</span>() {
  <span class="type">int</span> <span class="var">b</span> = (<span class="fn">sin</span>(<span class="var">angle</span>)+<span class="num">1</span>)*<span class="num">127.5</span>;
  <span class="fn">analogWrite</span>(<span class="var">LED</span>, <span class="var">b</span>);
  <span class="var">angle</span> <span class="op">+=</span> <span class="num">0.05</span>;
  <span class="kw">if</span>(<span class="var">angle</span> <span class="op">&gt;</span> <span class="num">TWO_PI</span>) <span class="var">angle</span>=<span class="num">0</span>;
  <span class="fn">delay</span>(<span class="num">15</span>);
}`,
    sim: ['🌑 b=0   → analogWrite(9,0)','🌒 b=64  → 25% bright','🌓 b=128 → 50% bright','🌔 b=192 → 75% bright','🌕 b=255 → FULL bright','🌔 b=192 → falling...','🌓 b=128 → 50%...','🌑 b=0   → off (cycle done)','🔁 Breathing repeats!','✅ Smooth sine-wave fade!']
  }
];

let currentSnippet = 0;
let simRunning = false;
let simAnimId = null;
let simFrame = 0;
let simOutputLines = [];
let simOutputIdx = 0;
let simOutputTid = null;

// Visual simulator canvases
const simCanvas = document.getElementById('simCanvas');
const simCtx = simCanvas ? simCanvas.getContext('2d') : null;

// ── Simulator state per sketch ──
const simState = {
  blink:  { ledOn: false, t: 0 },
  button: { ledOn: false, btnPressed: false, t: 0, autoT: 0 },
  analog: { potVal: 0.5, t: 0 },
  serial: { lines: [], count: 0, t: 0, nextLine: 0 },
  servo:  { angle: 0, direction: 1, t: 0 },
  pwm:    { angle: 0, t: 0, history: [] }
};

function getSpeed() {
  return parseInt(document.getElementById('simSpeed').value) || 3;
}

// ────────────────────────────────────────────────────
//  DRAW FUNCTIONS — one per sketch
// ────────────────────────────────────────────────────

function drawArduinoBoard(ctx, x, y, w, h, ledOn, ledColor) {
  // Board body
  ctx.fillStyle = '#1a5c38';
  ctx.strokeStyle = '#2ca86e';
  ctx.lineWidth = 2;
  roundRectSim(ctx, x, y, w, h, 8);
  ctx.fill(); ctx.stroke();
  // Board label
  ctx.fillStyle = '#ffffff30';
  ctx.font = 'bold 9px Space Mono';
  ctx.textAlign = 'center';
  ctx.fillText('ARDUINO UNO', x + w/2, y + h - 8);
  // USB port
  ctx.fillStyle = '#888';
  ctx.fillRect(x - 12, y + h/2 - 8, 12, 16);
  ctx.strokeStyle = '#aaa'; ctx.lineWidth = 1;
  ctx.strokeRect(x - 12, y + h/2 - 8, 12, 16);
  // Pins top
  ctx.fillStyle = '#c8a040';
  for(let i=0; i<8; i++) ctx.fillRect(x + 8 + i*10, y - 6, 6, 8);
  // Pins bottom
  for(let i=0; i<8; i++) ctx.fillRect(x + 8 + i*10, y + h - 2, 6, 8);
  // Power LED
  ctx.fillStyle = '#00ff88';
  ctx.shadowColor = '#00ff88'; ctx.shadowBlur = 8;
  ctx.beginPath(); ctx.arc(x + 14, y + 14, 4, 0, Math.PI*2); ctx.fill();
  ctx.shadowBlur = 0;
  // Pin 13 LED
  if(ledOn) {
    ctx.shadowColor = ledColor || '#ff6b35'; ctx.shadowBlur = 20;
    ctx.fillStyle = ledColor || '#ff6b35';
  } else {
    ctx.shadowBlur = 0;
    ctx.fillStyle = '#333';
  }
  ctx.beginPath(); ctx.arc(x + 28, y + 14, 5, 0, Math.PI*2); ctx.fill();
  ctx.shadowBlur = 0;
  // Pin 13 label
  ctx.fillStyle = ledOn ? (ledColor||'#ff6b35') : '#555';
  ctx.font = '7px Space Mono'; ctx.textAlign = 'center';
  ctx.fillText('L', x + 28, y + 31);
}

function roundRectSim(ctx, x, y, w, h, r) {
  ctx.beginPath();
  ctx.moveTo(x+r, y); ctx.lineTo(x+w-r, y);
  ctx.quadraticCurveTo(x+w,y,x+w,y+r);
  ctx.lineTo(x+w,y+h-r);
  ctx.quadraticCurveTo(x+w,y+h,x+w-r,y+h);
  ctx.lineTo(x+r,y+h);
  ctx.quadraticCurveTo(x,y+h,x,y+h-r);
  ctx.lineTo(x,y+r);
  ctx.quadraticCurveTo(x,y,x+r,y);
  ctx.closePath();
}

function drawLED(ctx, x, y, r, on, color) {
  const c = color || '#ff6b35';
  // Outer glow
  if(on) {
    const g = ctx.createRadialGradient(x, y, 0, x, y, r*3);
    g.addColorStop(0, c + 'aa');
    g.addColorStop(1, c + '00');
    ctx.fillStyle = g;
    ctx.beginPath(); ctx.arc(x, y, r*3, 0, Math.PI*2); ctx.fill();
    ctx.shadowColor = c; ctx.shadowBlur = 20;
  }
  // LED body
  ctx.fillStyle = on ? c : '#2a1a0a';
  ctx.strokeStyle = on ? c : '#3a2a1a';
  ctx.lineWidth = 2;
  ctx.beginPath(); ctx.arc(x, y, r, 0, Math.PI*2);
  ctx.fill(); ctx.stroke();
  ctx.shadowBlur = 0;
  // Highlight
  if(on) {
    ctx.fillStyle = 'rgba(255,255,255,.4)';
    ctx.beginPath(); ctx.arc(x - r*.3, y - r*.3, r*.35, 0, Math.PI*2); ctx.fill();
  }
}

function drawWire(ctx, x1, y1, x2, y2, color, flowing, t) {
  ctx.strokeStyle = color; ctx.lineWidth = 3;
  ctx.beginPath(); ctx.moveTo(x1, y1); ctx.lineTo(x2, y2); ctx.stroke();
  if(flowing) {
    ctx.fillStyle = '#00d4ff';
    for(let p = 0; p < 4; p++) {
      const frac = ((t * 0.008 + p/4) % 1);
      const px = x1 + (x2-x1)*frac, py = y1 + (y2-y1)*frac;
      ctx.shadowColor = '#00d4ff'; ctx.shadowBlur = 6;
      ctx.beginPath(); ctx.arc(px, py, 3, 0, Math.PI*2); ctx.fill();
      ctx.shadowBlur = 0;
    }
  }
}

// ── BLINK sim ──
function drawBlink(t) {
  const sp = getSpeed();
  const period = Math.max(20, 180 / sp);
  const on = Math.floor(t / period) % 2 === 0;
  simState.blink.ledOn = on;

  const ctx = simCtx, W = simCanvas.width, H = simCanvas.height;
  ctx.clearRect(0,0,W,H);
  ctx.fillStyle = '#070b14'; ctx.fillRect(0,0,W,H);

  // Circuit: Arduino → resistor → LED → GND
  const bx = 18, by = Math.round(H * 0.28);
  const bw = Math.min(100, Math.round(W * 0.3));
  drawArduinoBoard(ctx, bx, by, bw, 80, on);

  // Wire from pin 13
  const wireX1 = bx + bw;
  drawWire(ctx, wireX1, by+14, wireX1+60, by+14, on?'#2a6080':'#1a2840', on, t);
  // Resistor symbol
  const rx = wireX1 + 60;
  ctx.strokeStyle = '#f59e0b'; ctx.lineWidth = 2.5;
  ctx.beginPath(); ctx.moveTo(rx, by+14);
  const zigSteps = 8, zigLen = 50;
  for(let i=0;i<=zigSteps;i++){
    const sx = rx + i*(zigLen/zigSteps);
    const sy = by+14 + (i%2===0?0:(i===zigSteps?0:-12));
    ctx.lineTo(sx, sy);
  }
  ctx.stroke();
  ctx.fillStyle='#f59e0b';ctx.font='9px Space Mono';ctx.textAlign='center';
  ctx.fillText('220Ω',rx+zigLen/2,by+2);
  // Wire to LED
  const ledX = rx + zigLen + 30;
  drawWire(ctx, rx+zigLen, by+14, ledX-14, by+14, on?'#2a6080':'#1a2840', on, t+0.3);
  // LED
  drawLED(ctx, ledX, by+14, 14, on, '#ff6b35');
  ctx.fillStyle=on?'#ff6b35':'#555';ctx.font='9px Space Mono';ctx.textAlign='center';
  ctx.fillText('LED',ledX,by+36);
  // Wire to GND
  const gndX = ledX + 28;
  drawWire(ctx, ledX+14, by+14, gndX, by+14, on?'#1a3050':'#111820', false, 0);
  ctx.strokeStyle='#8892b0';ctx.lineWidth=1.5;
  ctx.beginPath(); ctx.moveTo(gndX,by+6);ctx.lineTo(gndX,by+22);ctx.stroke();
  for(let i=0;i<3;i++){const hw=10-i*3;ctx.beginPath();ctx.moveTo(gndX-hw,by+22+i*5);ctx.lineTo(gndX+hw,by+22+i*5);ctx.stroke();}
  ctx.fillStyle='#8892b0';ctx.font='9px Space Mono';ctx.textAlign='center';ctx.fillText('GND',gndX,by+52);

  // ── Digital waveform at bottom ──
  const wfX=12, wfY=H-52, wfW=W-24, wfH=28;
  ctx.fillStyle='rgba(0,0,0,.45)'; roundRectSim(ctx,wfX-2,wfY-18,wfW+4,wfH+22,6); ctx.fill();
  ctx.strokeStyle='#1a2a40'; ctx.lineWidth=1; ctx.stroke();
  ctx.fillStyle='#3a5070'; ctx.font='7px Space Mono'; ctx.textAlign='left';
  ctx.fillText('Pin 13 digital signal:', wfX, wfY-5);
  // Square wave
  ctx.strokeStyle='#00d4ff'; ctx.lineWidth=2;
  ctx.beginPath();
  const segments = 8;
  const segW2 = wfW / segments;
  ctx.moveTo(wfX, wfY+wfH);
  for(let seg=0; seg<segments; seg++){
    const isHigh = seg%2===0;
    const x1 = wfX + seg*segW2, x2 = x1 + segW2;
    const y1 = isHigh ? wfY : wfY+wfH;
    ctx.lineTo(x1, y1);
    ctx.lineTo(x2, y1);
    if(seg<segments-1) ctx.lineTo(x2, isHigh ? wfY+wfH : wfY);
  }
  ctx.stroke();
  // Current position cursor
  const curPos = ((t / period) % segments) / segments;
  const cX = wfX + curPos * wfW;
  ctx.fillStyle = on ? 'rgba(0,212,255,.15)' : 'rgba(0,0,0,.2)';
  ctx.fillRect(cX-1,wfY-2,3,wfH+4);
  ctx.fillStyle = on ? '#00d4ff' : '#2a5060';
  ctx.beginPath(); ctx.arc(cX, on?wfY:wfY+wfH, 4,0,Math.PI*2); ctx.fill();
  // Labels
  ctx.fillStyle='#00d4ff'; ctx.font='7px Space Mono'; ctx.textAlign='right';
  ctx.fillText('5V', wfX-3, wfY+4);
  ctx.fillStyle='#555'; ctx.fillText('0V', wfX-3, wfY+wfH+4);

  // Status
  ctx.fillStyle = on?'#ff6b35':'#8892b0';
  ctx.font='bold 10px Space Mono'; ctx.textAlign='center';
  ctx.fillText(on ? '💡 Pin 13: HIGH  (LED ON)' : '🌑 Pin 13: LOW  (LED OFF)', W/2, H-58);

  // Corner indicator
  ctx.fillStyle = on ? '#ff6b35' : '#333';
  ctx.shadowColor = on ? '#ff6b35' : 'transparent'; ctx.shadowBlur = on ? 10 : 0;
  ctx.beginPath(); ctx.arc(W-14, 14, 6, 0, Math.PI*2); ctx.fill();
  ctx.shadowBlur = 0;
}

// ── BUTTON sim ──
function drawButton(t) {
  const sp = getSpeed();
  // Auto-toggle button every 3 seconds
  const cycle = Math.max(40, 300/sp);
  const autoPress = (Math.floor(t/cycle) % 3) === 1;
  const pressed = simState.button.btnPressed || autoPress;

  const ctx = simCtx, W = simCanvas.width, H = simCanvas.height;
  ctx.clearRect(0,0,W,H); ctx.fillStyle='#070b14'; ctx.fillRect(0,0,W,H);

  const bx=10, by=H/2-40;
  drawArduinoBoard(ctx, bx, by, 100, 80, pressed);

  // Wire pin 2 (bottom row) → button
  drawWire(ctx, bx+100, by+55, 170, by+55, pressed?'#2a6080':'#1a2840', pressed, t);
  // Button symbol
  ctx.strokeStyle = '#d4a853'; ctx.lineWidth = 2.5;
  ctx.beginPath(); ctx.moveTo(170, by+55); ctx.lineTo(188, by+55); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(188, by+42); ctx.lineTo(188, by+68); ctx.stroke();
  ctx.beginPath(); ctx.moveTo(208, by+42); ctx.lineTo(208, by+68); ctx.stroke();
  if(pressed) {
    ctx.strokeStyle = '#00ff88'; ctx.shadowColor='#00ff88'; ctx.shadowBlur=8;
    ctx.beginPath(); ctx.moveTo(188,by+55); ctx.lineTo(208,by+55); ctx.stroke();
    ctx.shadowBlur=0;
  }
  ctx.beginPath(); ctx.moveTo(208,by+55); ctx.lineTo(226,by+55); ctx.stroke();
  // Button cap
  ctx.fillStyle = pressed ? '#00ff88' : '#d4a853';
  if(pressed){ctx.shadowColor='#00ff88';ctx.shadowBlur=12;}
  ctx.fillRect(183, by+38, 30, 8);
  ctx.shadowBlur=0;
  ctx.fillStyle='#fff'; ctx.font='bold 9px Syne'; ctx.textAlign='center';
  ctx.fillText(pressed?'PRESSED':'PRESS ME', 198, by+32);

  // Pull-up resistor to 5V
  ctx.fillStyle='#f59e0b'; ctx.strokeStyle='#f59e0b'; ctx.lineWidth=2;
  ctx.beginPath();ctx.moveTo(198,by+14);ctx.lineTo(198,by+38);ctx.stroke();
  ctx.fillStyle='#f59e0b';ctx.font='8px Space Mono';ctx.textAlign='left';
  ctx.fillText('INPUT_PULLUP',210,by+26);ctx.fillText('(internal 20kΩ)',210,by+36);

  // LED side
  drawWire(ctx, bx+100, by+20, 240, by+20, pressed?'#2a6080':'#1a2840', pressed, t);
  drawLED(ctx, 255, by+20, 12, pressed, '#00d4ff');
  ctx.fillStyle=pressed?'#00d4ff':'#444';ctx.font='9px Space Mono';ctx.textAlign='center';
  ctx.fillText('LED (pin 13)',255,by+42);

  // Status
  ctx.fillStyle='rgba(0,0,0,.5)'; roundRectSim(ctx,10,H-70,W-20,55,8); ctx.fill();
  ctx.strokeStyle=pressed?'#00ff88':'#2a3560'; ctx.lineWidth=1; ctx.stroke();
  ctx.fillStyle=pressed?'#00ff88':'#8892b0';
  ctx.font='bold 11px Space Mono';ctx.textAlign='center';
  ctx.fillText(pressed?'🔘 Pin 2: LOW → LED ON':'🔘 Pin 2: HIGH → LED OFF', W/2, H-50);
  ctx.fillStyle='#555';ctx.font='9px Space Mono';
  ctx.fillText('Click button above to interact!', W/2, H-32);
}

// ── ANALOG sim — draggable knob ──
function drawAnalog(t) {
  const sp = getSpeed();
  // Auto-sweep pot value
  const val = (Math.sin(t * 0.012 / Math.max(1,sp) * sp) + 1) / 2;
  simState.analog.potVal = val;
  const brightness = Math.round(val * 255);
  const rawVal = Math.round(val * 1023);

  const ctx = simCtx, W = simCanvas.width, H = simCanvas.height;
  ctx.clearRect(0,0,W,H); ctx.fillStyle='#070b14'; ctx.fillRect(0,0,W,H);

  const bx=10, by=H/2-40;
  drawArduinoBoard(ctx, bx, by, 100, 80, brightness > 10, `rgba(255,107,53,${brightness/255})`);

  // Potentiometer
  const px = 180, py = H/2;
  ctx.fillStyle = '#2a3560'; ctx.strokeStyle = '#4a5580'; ctx.lineWidth=2;
  ctx.beginPath(); ctx.arc(px, py, 28, 0, Math.PI*2); ctx.fill(); ctx.stroke();
  // Knob indicator
  const knobAngle = -Math.PI*0.8 + val * Math.PI * 1.6;
  ctx.strokeStyle = '#00d4ff'; ctx.lineWidth = 3;
  ctx.beginPath();
  ctx.moveTo(px, py);
  ctx.lineTo(px + Math.cos(knobAngle)*20, py + Math.sin(knobAngle)*20);
  ctx.stroke();
  ctx.fillStyle='#00d4ff';
  ctx.beginPath(); ctx.arc(px,py,4,0,Math.PI*2); ctx.fill();
  // Knob ticks
  ctx.strokeStyle='#3a4570'; ctx.lineWidth=1;
  for(let i=0;i<=10;i++){
    const a=-Math.PI*0.8+i/10*Math.PI*1.6;
    ctx.beginPath();
    ctx.moveTo(px+Math.cos(a)*26,py+Math.sin(a)*26);
    ctx.lineTo(px+Math.cos(a)*30,py+Math.sin(a)*30);
    ctx.stroke();
  }
  ctx.fillStyle='#8892b0';ctx.font='9px Space Mono';ctx.textAlign='center';
  ctx.fillText('POT (A0)',px,py+46);
  ctx.fillStyle='#00d4ff';ctx.font='bold 10px Space Mono';
  ctx.fillText(`${rawVal}`,px,py+58);

  // Wire from Arduino A0
  drawWire(ctx, bx+100, by+60, px-28, py, '#2a5080', true, t);

  // Wire from Arduino pin 9
  drawWire(ctx, bx+100, by+20, 240, by+20, brightness>10?'#2a5080':'#1a2840', brightness>10, t+0.5);
  // LED with brightness
  drawLED(ctx, 258, by+20, 13, brightness>5, `rgb(${brightness},${Math.round(brightness*0.42)},0)`);
  ctx.fillStyle=`rgba(255,${Math.round(brightness*0.42)},0,${0.3+brightness/512})`;
  ctx.font='9px Space Mono';ctx.textAlign='center';
  ctx.fillText(`LED (PWM)`,258,by+42);

  // PWM bar
  const barX=20,barY=H-75,barW=W-40,barH=14;
  ctx.fillStyle='#111'; ctx.fillRect(barX,barY,barW,barH);
  ctx.strokeStyle='#2a3560'; ctx.lineWidth=1; ctx.strokeRect(barX,barY,barW,barH);
  ctx.fillStyle=`rgb(${brightness},${Math.round(brightness*0.42)},0)`;
  ctx.fillRect(barX, barY, barW*val, barH);
  ctx.fillStyle='#e8eaf6';ctx.font='8px Space Mono';ctx.textAlign='left';
  ctx.fillText(`analogWrite(9, ${brightness})  ←  map(${rawVal}, 0,1023, 0,255)`, barX+4, barY-4);

  // Status
  ctx.fillStyle='rgba(0,0,0,.4)'; roundRectSim(ctx,10,H-50,W-20,40,6); ctx.fill();
  ctx.fillStyle='#00d4ff';ctx.font='bold 10px Space Mono';ctx.textAlign='center';
  ctx.fillText(`analogRead(A0)=${rawVal}  →  PWM=${brightness}  →  ${Math.round(val*100)}% bright`, W/2, H-30);
  ctx.fillStyle='#555';ctx.font='8px Space Mono';
  ctx.fillText('(Knob auto-sweeps — see value change live!)', W/2, H-16);
}

// ── SERIAL sim ──
function drawSerial(t) {
  const sp = getSpeed();
  const ctx = simCtx, W = simCanvas.width, H = simCanvas.height;
  ctx.clearRect(0,0,W,H);
  // Terminal background
  ctx.fillStyle='#0a0f0a'; ctx.fillRect(0,0,W,H);
  ctx.strokeStyle='#1a4a1a'; ctx.lineWidth=1; ctx.strokeRect(0,0,W,H);

  // Scan-line overlay
  for(let y=0;y<H;y+=4){
    ctx.fillStyle='rgba(0,0,0,0.08)';
    ctx.fillRect(0,y,W,1);
  }

  // Terminal header
  ctx.fillStyle='#0d1a0d'; ctx.fillRect(0,0,W,28);
  ctx.strokeStyle='#1a4a1a'; ctx.lineWidth=1;
  ctx.beginPath(); ctx.moveTo(0,28); ctx.lineTo(W,28); ctx.stroke();
  ctx.fillStyle='#00ff88'; ctx.font='bold 9px Space Mono'; ctx.textAlign='left';
  ctx.fillText('⚡ Serial Monitor  9600 baud', 10, 18);
  // Status LEDs
  const blink = Math.floor(t/15)%2===0;
  ['#00ff88','#ff6b35','#ffd700'].forEach((c,i)=>{
    ctx.fillStyle = (i===0&&blink) ? c : (i>0 ? '#1a1a1a' : '#003300');
    ctx.beginPath(); ctx.arc(W-14-i*18,14,5,0,Math.PI*2); ctx.fill();
    if(i===0&&blink){ctx.shadowColor=c;ctx.shadowBlur=8;ctx.fill();ctx.shadowBlur=0;}
  });
  ctx.fillStyle='#004400'; ctx.font='7px Space Mono'; ctx.textAlign='right';
  ctx.fillText('RX TX PWR',W-5,22);

  // Lines
  const period = Math.max(6,40/sp);
  const lineNum = Math.floor(t/period);
  const lines = simState.serial.lines;
  const allLines = ['Arduino ready! 🚀','[setup] Serial.begin(9600)', ...Array.from({length:25},(_,i)=>`Loop #${i+1}  →  count=${i+1}`)];
  while(lines.length <= lineNum && lines.length < allLines.length) {
    lines.push(allLines[lines.length]);
  }

  const lineH = Math.max(14, Math.round(H * 0.065));
  const maxVisible = Math.floor((H - 48) / lineH);
  const startIdx = Math.max(0, lines.length - maxVisible);
  ctx.font = `${lineH-3}px JetBrains Mono`; ctx.textAlign = 'left';
  lines.slice(startIdx).forEach((line, i) => {
    const y = 44 + i * lineH;
    if(y > H - 8) return;
    const ts = String(startIdx+i).padStart(3,'0');
    // Fade in last line
    const isLast = (startIdx + i === lines.length - 1);
    ctx.globalAlpha = isLast ? Math.min(1, (t % period) / (period * 0.5)) : 1;
    ctx.fillStyle = '#1a5a1a';
    ctx.fillText(`[${ts}]`, 8, y);
    ctx.fillStyle = line.startsWith('Arduino') ? '#00ff88' :
                    line.startsWith('[setup]') ? '#00d4ff' :
                    line.startsWith('Loop') ? '#50fa7b' : '#00d4ff';
    ctx.fillText(line, 52, y);
    ctx.globalAlpha = 1;
  });

  // Blinking cursor
  if(lines.length > 0) {
    const lastY = 44 + Math.min(lines.length-1, maxVisible-1) * lineH;
    const lastLine = lines[lines.length-1];
    ctx.font = `${lineH-3}px JetBrains Mono`;
    const tw = ctx.measureText(lastLine).width;
    if(Math.floor(t/12)%2===0) {
      ctx.fillStyle='#00ff88';
      ctx.fillRect(52+tw+2, lastY-(lineH-4), 6, lineH-2);
    }
  }
  // Scrollbar
  if(lines.length > maxVisible) {
    const sbH = H - 48;
    const thumbH = Math.max(20, sbH * maxVisible / lines.length);
    const thumbY = 40 + (sbH - thumbH) * Math.min(1, (lines.length - maxVisible) / lines.length);
    ctx.fillStyle='#1a4a1a'; ctx.fillRect(W-6,40,4,sbH);
    ctx.fillStyle='#00ff44'; ctx.fillRect(W-6,thumbY,4,thumbH);
  }
}

// ── SERVO sim ──
function drawServo(t) {
  const sp = getSpeed();
  const speed = sp * 0.008;
  simState.servo.angle += simState.servo.direction * speed;
  if(simState.servo.angle >= Math.PI) simState.servo.direction = -1;
  if(simState.servo.angle <= 0) simState.servo.direction = 1;
  const deg = Math.round(simState.servo.angle * 180 / Math.PI);

  const ctx = simCtx, W = simCanvas.width, H = simCanvas.height;
  ctx.clearRect(0,0,W,H); ctx.fillStyle='#070b14'; ctx.fillRect(0,0,W,H);

  // Servo body
  const sx = W/2 - 20, sy = H/2 - 10;
  ctx.fillStyle = '#2a3560'; ctx.strokeStyle='#4a5580'; ctx.lineWidth=2;
  ctx.fillRect(sx-30,sy-20,60,40); ctx.strokeRect(sx-30,sy-20,60,40);
  ctx.fillStyle='#1a2540'; ctx.fillRect(sx-8,sy-25,16,10); // horn mount
  // Servo label
  ctx.fillStyle='#8892b0'; ctx.font='8px Space Mono'; ctx.textAlign='center';
  ctx.fillText('SERVO', sx, sy+30);
  ctx.fillText('Pin 9', sx, sy+40);

  // Pivot
  ctx.fillStyle='#00d4ff'; ctx.strokeStyle='#00a0cc'; ctx.lineWidth=2;
  ctx.beginPath(); ctx.arc(sx, sy-20, 6, 0, Math.PI*2); ctx.fill(); ctx.stroke();

  // Arm — sweeps 0-180° (mapped to -PI to 0 in screen space)
  const armAngle = -Math.PI + simState.servo.angle;
  const armLen = 55;
  const armX = sx + Math.cos(armAngle) * armLen;
  const armY = sy - 20 + Math.sin(armAngle) * armLen;

  // Arm shadow / trail
  ctx.strokeStyle = 'rgba(0,212,255,.15)'; ctx.lineWidth = 8;
  ctx.beginPath(); ctx.moveTo(sx, sy-20); ctx.lineTo(armX, armY); ctx.stroke();
  // Arm main
  ctx.strokeStyle = '#00d4ff'; ctx.lineWidth = 5;
  ctx.shadowColor='#00d4ff'; ctx.shadowBlur=12;
  ctx.beginPath(); ctx.moveTo(sx, sy-20); ctx.lineTo(armX, armY); ctx.stroke();
  ctx.shadowBlur=0;
  // Arm tip
  ctx.fillStyle='#ff6b35'; ctx.shadowColor='#ff6b35'; ctx.shadowBlur=10;
  ctx.beginPath(); ctx.arc(armX, armY, 7, 0, Math.PI*2); ctx.fill();
  ctx.shadowBlur=0;

  // Arc showing sweep range
  ctx.strokeStyle='rgba(0,212,255,.25)'; ctx.lineWidth=30; ctx.lineCap='round';
  ctx.beginPath(); ctx.arc(sx, sy-20, armLen, -Math.PI, 0); ctx.stroke();
  ctx.lineWidth=1;

  // Angle markers
  ctx.strokeStyle='#2a3560'; ctx.fillStyle='#555'; ctx.font='8px Space Mono'; ctx.textAlign='center';
  ctx.fillText('0°', sx-armLen-10, sy-20+4);
  ctx.fillText('90°', sx, sy-20-armLen-12);
  ctx.fillText('180°', sx+armLen+12, sy-20+4);

  // Digital angle display
  ctx.fillStyle='rgba(0,0,0,.6)'; roundRectSim(ctx,W/2-55,H-65,110,50,8); ctx.fill();
  ctx.strokeStyle='#00d4ff30'; ctx.lineWidth=1; ctx.stroke();
  ctx.fillStyle='#00d4ff'; ctx.font='bold 20px JetBrains Mono'; ctx.textAlign='center';
  ctx.fillText(`${deg}°`, W/2, H-40);
  ctx.fillStyle='#555'; ctx.font='8px Space Mono';
  ctx.fillText('myServo.write(pos)', W/2, H-25);

  // Arduino mini
  drawArduinoBoard(ctx, 5, H-65, 70, 50, true, '#00d4ff');
  ctx.fillStyle='#00d4ff'; ctx.font='7px Space Mono'; ctx.textAlign='center';
  ctx.fillText('Pin 9',40,H-22);
}

// ── PWM sim — breathing LED + waveform ──
function drawPWM(t) {
  const sp = getSpeed();
  simState.pwm.angle += 0.02 * sp;
  if(simState.pwm.angle > Math.PI*2) simState.pwm.angle -= Math.PI*2;
  const brightness = (Math.sin(simState.pwm.angle) + 1) / 2;
  const bVal = Math.round(brightness * 255);
  const dutyCycle = Math.round(brightness * 100);

  // Add to history
  simState.pwm.history.push(brightness);
  if(simState.pwm.history.length > 200) simState.pwm.history.shift();

  const ctx = simCtx, W = simCanvas.width, H = simCanvas.height;
  ctx.clearRect(0,0,W,H); ctx.fillStyle='#070b14'; ctx.fillRect(0,0,W,H);

  // Giant breathing LED — left half
  const lx = Math.round(W * 0.28), ly = Math.round(H * 0.42);
  const maxR = Math.min(W, H) * 0.16;
  // Multi-layer glow
  for(let r = maxR*2.5; r >= maxR; r -= maxR*0.2) {
    const alpha = brightness * (1 - r/(maxR*2.8)) * 0.35;
    ctx.fillStyle = `rgba(255,107,53,${alpha})`;
    ctx.beginPath(); ctx.arc(lx, ly, r, 0, Math.PI*2); ctx.fill();
  }
  ctx.shadowColor='#ff6b35'; ctx.shadowBlur=30*brightness;
  ctx.fillStyle=`rgb(${Math.round(50+brightness*205)},${Math.round(brightness*107)},${Math.round(brightness*53)})`;
  ctx.beginPath(); ctx.arc(lx, ly, maxR, 0, Math.PI*2); ctx.fill();
  ctx.shadowBlur=0;
  // Highlight
  ctx.fillStyle=`rgba(255,255,255,${brightness*0.4})`;
  ctx.beginPath(); ctx.arc(lx-maxR*.3, ly-maxR*.3, maxR*.35, 0, Math.PI*2); ctx.fill();

  // LED value display
  ctx.fillStyle='rgba(0,0,0,.6)'; roundRectSim(ctx,lx-50,ly+maxR+6,100,44,6); ctx.fill();
  ctx.fillStyle='#ff6b35'; ctx.font=`bold ${Math.round(H*0.07)}px JetBrains Mono`; ctx.textAlign='center';
  ctx.fillText(`${bVal}`, lx, ly+maxR+30);
  ctx.fillStyle='#555'; ctx.font=`${Math.round(H*0.04)}px Space Mono`;
  ctx.fillText('analogWrite(9, ?)', lx, ly+maxR+44);
  ctx.fillStyle='#888'; ctx.font=`${Math.round(H*0.038)}px Space Mono`;
  ctx.fillText(`${dutyCycle}% duty cycle`, lx, ly+maxR+57);

  // Duty cycle bar (horizontal) below LED
  const dbX=lx-50,dbY=ly+maxR+62,dbW=100,dbH=8;
  ctx.fillStyle='#111'; ctx.fillRect(dbX,dbY,dbW,dbH);
  ctx.fillStyle=`rgb(${Math.round(50+brightness*205)},${Math.round(brightness*107)},0)`;
  ctx.fillRect(dbX, dbY, dbW*brightness, dbH);
  ctx.strokeStyle='#2a3560'; ctx.lineWidth=1; ctx.strokeRect(dbX,dbY,dbW,dbH);

  // Waveform graph — right half
  const gx = Math.round(W * 0.52), gy = 10, gw = W - gx - 8, gh = H - 20;
  ctx.fillStyle='#0a0e1a'; ctx.strokeStyle='#1a2240'; ctx.lineWidth=1;
  ctx.fillRect(gx, gy, gw, gh); ctx.strokeRect(gx, gy, gw, gh);
  // Grid
  ctx.strokeStyle='#151e35'; ctx.lineWidth=1;
  for(let i=1;i<4;i++){
    ctx.beginPath(); ctx.moveTo(gx,gy+i*gh/4); ctx.lineTo(gx+gw,gy+i*gh/4); ctx.stroke();
  }
  // Y axis labels
  ctx.fillStyle='#3a4570'; ctx.font='7px Space Mono'; ctx.textAlign='right';
  ctx.fillText('255',gx-2,gy+6); ctx.fillText('128',gx-2,gy+gh/2+4); ctx.fillText('0',gx-2,gy+gh);
  ctx.textAlign='center'; ctx.fillStyle='#3a4570';
  ctx.fillText('time →',gx+gw/2,gy+gh+10);
  ctx.fillStyle='#5a6080'; ctx.font='7px Space Mono'; ctx.textAlign='left';
  ctx.fillText('Sine-Wave Brightness',gx+2,gy+10);

  // Plot waveform
  if(simState.pwm.history.length > 1) {
    ctx.strokeStyle='#ff6b35'; ctx.lineWidth=2;
    ctx.shadowColor='#ff6b35'; ctx.shadowBlur=4;
    ctx.beginPath();
    simState.pwm.history.forEach((v,i)=>{
      const px2=gx+gw*(i/200);
      const py2=gy+gh-v*gh;
      i===0?ctx.moveTo(px2,py2):ctx.lineTo(px2,py2);
    });
    ctx.stroke(); ctx.shadowBlur=0;
    // Fill under curve
    ctx.fillStyle='rgba(255,107,53,0.08)';
    ctx.beginPath();
    simState.pwm.history.forEach((v,i)=>{
      const px2=gx+gw*(i/200);
      const py2=gy+gh-v*gh;
      i===0?ctx.moveTo(px2,py2):ctx.lineTo(px2,py2);
    });
    ctx.lineTo(gx+gw*(simState.pwm.history.length-1)/200, gy+gh);
    ctx.lineTo(gx, gy+gh); ctx.closePath(); ctx.fill();
    // Current position dot
    const lastV=simState.pwm.history[simState.pwm.history.length-1];
    const dotX=gx+gw*(simState.pwm.history.length-1)/200;
    ctx.fillStyle='#ff6b35'; ctx.shadowColor='#ff6b35'; ctx.shadowBlur=8;
    ctx.beginPath();ctx.arc(dotX,gy+gh-lastV*gh,4,0,Math.PI*2);ctx.fill();
    ctx.shadowBlur=0;
  }
  // sin value
  ctx.fillStyle='#ff6b35'; ctx.font='bold 9px Space Mono'; ctx.textAlign='center';
  ctx.fillText(`sin(θ) = ${(Math.sin(simState.pwm.angle)).toFixed(3)}  →  ${bVal}/255`, gx+gw/2, gy+gh+22);
}

// ── Animation loop ──
let simAnimFrame = 0;
let simRafId = null;

function simLoop() {
  if(!simRunning) return;
  simAnimFrame++;
  const label = snippets[currentSnippet].label;
  if(simCtx) {
    if(label==='blink')  drawBlink(simAnimFrame);
    else if(label==='button') drawButton(simAnimFrame);
    else if(label==='analog') drawAnalog(simAnimFrame);
    else if(label==='serial') drawSerial(simAnimFrame);
    else if(label==='servo') drawServo(simAnimFrame);
    else if(label==='pwm')  drawPWM(simAnimFrame);
  }
  simRafId = requestAnimationFrame(simLoop);
}

function drawIdleState(idx) {
  if(!simCtx) return;
  const W=simCanvas.width, H=simCanvas.height;
  simCtx.clearRect(0,0,W,H);
  simCtx.fillStyle='#070b14'; simCtx.fillRect(0,0,W,H);
  // Draw a static preview
  const label = snippets[idx].label;
  if(label==='blink') drawBlink(0);
  else if(label==='button') drawButton(0);
  else if(label==='analog') drawAnalog(0);
  else if(label==='serial') { simCtx.fillStyle='#0a0f0a';simCtx.fillRect(0,0,W,H);simCtx.fillStyle='#00ff88';simCtx.font='11px Space Mono';simCtx.textAlign='center';simCtx.fillText('▶ Run to open Serial Monitor',W/2,H/2); }
  else if(label==='servo') drawServo(0);
  else if(label==='pwm') drawPWM(0);
  // "press run" overlay
  simCtx.fillStyle='rgba(0,0,0,.5)';
  roundRectSim(simCtx,W/2-60,H/2-18,120,36,8);simCtx.fill();
  simCtx.fillStyle='#00ff88';simCtx.font='bold 11px Space Mono';simCtx.textAlign='center';
  simCtx.fillText('▶ Press Run!',W/2,H/2+6);
}

function renderCode(idx) {
  const s = snippets[idx];
  const nums = Array.from({length:s.lines},(_,i)=>i+1).join('\n');
  document.getElementById('codeDisplay').innerHTML = `
    <div class="line-nums">${nums}</div>
    <div class="code-area"><code>${s.code}</code></div>
  `;
  document.getElementById('editorTitle').textContent = s.title || 'sketch.ino';
  drawIdleState(idx);
}

function switchCode(idx, el) {
  stopCode();
  currentSnippet = idx;
  // Reset sim states
  simState.blink.t=0;
  simState.button.btnPressed=false;
  simState.serial.lines=[];
  simState.servo.angle=0; simState.servo.direction=1;
  simState.pwm.angle=0; simState.pwm.history=[];
  simAnimFrame=0;
  document.querySelectorAll('.editor-tab-btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  renderCode(idx);
  document.getElementById('outputBox').classList.remove('visible');
}

function runCode() {
  if(simRunning) {
    // Pause
    simRunning = false;
    if(simRafId) cancelAnimationFrame(simRafId);
    if(simOutputTid) clearTimeout(simOutputTid);
    document.getElementById('runSimBtn').textContent='▶ Resume';
    return;
  }
  stopCode();
  simRunning = true;
  simAnimFrame = 0;
  // Reset state
  const label = snippets[currentSnippet].label;
  if(label==='serial') simState.serial.lines=[];
  if(label==='servo') { simState.servo.angle=0; simState.servo.direction=1; }
  if(label==='pwm') { simState.pwm.angle=0; simState.pwm.history=[]; }
  document.getElementById('runSimBtn').textContent='⏸ Pause';
  simLoop();
  // Text output
  const output = document.getElementById('outputBox');
  output.classList.add('visible');
  const lines = snippets[currentSnippet].sim;
  output.textContent = '';
  let i=0;
  function showLine() {
    if(i<lines.length && simRunning){
      output.textContent += lines[i]+'\n';
      i++;
      simOutputTid = setTimeout(showLine, 350);
    }
  }
  showLine();
}

function stopCode() {
  simRunning = false;
  if(simRafId) cancelAnimationFrame(simRafId);
  if(simOutputTid) clearTimeout(simOutputTid);
  document.getElementById('runSimBtn').textContent='▶ Run';
  drawIdleState(currentSnippet);
}

// Speed label
document.getElementById('simSpeed').addEventListener('input',function(){
  document.getElementById('simSpeedLabel').textContent=this.value+'×';
});

// Responsive canvas - resize simCanvas to fill its container
function resizeSimCanvas() {
  const wrap = document.getElementById('simCanvasWrap');
  if(!wrap || !simCanvas) return;
  const w = Math.floor(wrap.clientWidth);
  const h = Math.max(220, Math.round(w * 0.72));
  if(simCanvas.width !== w || simCanvas.height !== h) {
    simCanvas.width = w;
    simCanvas.height = h;
    simCanvas.style.width = w + 'px';
    simCanvas.style.height = h + 'px';
    if(!simRunning) drawIdleState(currentSnippet);
  }
}
window.addEventListener('resize', resizeSimCanvas);
setTimeout(resizeSimCanvas, 50);

// Button interaction on canvas
simCanvas.addEventListener('click',function(e){
  if(snippets[currentSnippet].label==='button' && simRunning){
    simState.button.btnPressed=!simState.button.btnPressed;
    setTimeout(()=>simState.button.btnPressed=false,800);
  }
});

renderCode(0);

// ═══════════════════════════════════════════════════
//  STEP BUILDER
// ═══════════════════════════════════════════════════
const steps = [
  { title:'Download Arduino IDE', desc:'Head to arduino.cc/en/software and download the latest IDE for your operating system (Windows, macOS, or Linux). It\'s free and around 200MB.' },
  { title:'Connect Your Board', desc:'Plug your Arduino Uno into your computer using a USB-A to USB-B cable. The green power LED on the board should light up. Windows may auto-install drivers.' },
  { title:'Select Board & Port', desc:'In the IDE, go to Tools → Board → "Arduino Uno". Then go to Tools → Port and select the COM port (Windows: COMx, Mac/Linux: /dev/tty.usbmodem...).' },
  { title:'Open Blink Example', desc:'Go to File → Examples → 01.Basics → Blink. This opens the classic LED blink sketch. Notice the two functions: setup() and loop().' },
  { title:'Upload Your First Sketch', desc:'Click the right-arrow "Upload" button (→). The IDE compiles your code and uploads it via USB. The TX/RX LEDs on the board will flicker during upload.' },
  { title:'Watch It Blink!', desc:'After "Done uploading" appears, the built-in LED on pin 13 should start blinking! Change the delay(1000) values and re-upload to change the speed. You\'re officially a maker! 🎉' }
];

const builderEl = document.getElementById('builderSteps');
let activeStep = 0;

function renderBuilder() {
  builderEl.innerHTML = '';
  steps.forEach((s,i) => {
    const done = i < activeStep;
    const active = i === activeStep;
    const el = document.createElement('div');
    el.className = `builder-step ${done?'done':''} ${active?'active':''}`;
    el.innerHTML = `
      <div class="step-connector">
        <div class="step-circle">${done?'✓':i+1}</div>
        ${i<steps.length-1?'<div class="step-line"></div>':''}
      </div>
      <div class="step-content">
        <div class="step-title">${s.title}</div>
        <div class="step-desc">${s.desc}</div>
        ${active?`<button class="step-btn" onclick="completeStep(${i})">✓ Mark Complete</button>`:''}
        <div class="step-done-badge">✅ Completed!</div>
      </div>
    `;
    builderEl.appendChild(el);
  });
}

function completeStep(i) {
  activeStep = i+1;
  renderBuilder();
  if(i<steps.length-1) {
    setTimeout(()=>{
      const next = builderEl.querySelectorAll('.builder-step')[i+1];
      if(next) next.scrollIntoView({behavior:'smooth',block:'center'});
    },100);
  }
}

renderBuilder();

// ═══════════════════════════════════════════════════
//  PROJECTS
// ═══════════════════════════════════════════════════
const projects = [
  {
    icon:'💡', title:'LED Blink', difficulty:'easy',
    desc:'Your first Arduino program! Make the built-in LED blink at different rates.',
    steps:['Connect Arduino via USB','Open File → Examples → Blink','Upload the sketch','Modify delay() values to change speed'],
    tags:['LED','digitalWrite','delay'], time:'~10 min'
  },
  {
    icon:'🚦', title:'Traffic Light', difficulty:'easy',
    desc:'Simulate a traffic light sequence with three LEDs: red, yellow, and green.',
    steps:['Wire 3 LEDs with 220Ω resistors to pins 8,9,10','Write timed sequence in loop()','Add proper timing between state changes','Bonus: add a button for pedestrian crossing'],
    tags:['LED','Timing','Multiple pins'], time:'~20 min'
  },
  {
    icon:'🌡️', title:'Temperature Monitor', difficulty:'easy',
    desc:'Read temperature with a TMP36 sensor and print it to the Serial Monitor.',
    steps:['Connect TMP36 sensor to A0','Read with analogRead(A0)','Convert voltage to Celsius: (V-0.5)×100','Print to Serial Monitor at 9600 baud'],
    tags:['TMP36','analogRead','Serial'], time:'~25 min'
  },
  {
    icon:'🎹', title:'Tone Piano', difficulty:'med',
    desc:'Build a simple 4-key piano using buttons and a buzzer that plays real notes.',
    steps:['Wire 4 buttons to pins 2,3,4,5','Connect buzzer to pin 9','Define note frequencies (C,D,E,F=261,294,330,349Hz)','Use tone() to play when button pressed'],
    tags:['Buzzer','tone()','buttons'], time:'~30 min'
  },
  {
    icon:'🔦', title:'Auto Night Light', difficulty:'med',
    desc:'LED automatically turns on when it gets dark using a photoresistor.',
    steps:['Make voltage divider: LDR + 10kΩ to A0','Read light level with analogRead()','Set threshold (e.g. below 300 = dark)','Write to LED based on light value'],
    tags:['LDR','analogRead','Auto-logic'], time:'~25 min'
  },
  {
    icon:'🤖', title:'Obstacle-Avoidance Robot', difficulty:'hard',
    desc:'Build a wheeled robot that avoids walls and objects using an HC-SR04 sensor.',
    steps:['Assemble 2WD chassis with DC motors','Connect L298N motor driver to Arduino','Wire HC-SR04 ultrasonic sensor to pins 7,8','Code: measure distance, steer away if <20cm'],
    tags:['Ultrasonic','Motor driver','Robotics'], time:'~2–3 hrs'
  },
];

const projGrid = document.getElementById('projectsGrid');
projects.forEach(p => {
  const el = document.createElement('div');
  el.className = 'project-card';
  const diffClass = p.difficulty==='easy'?'diff-easy':p.difficulty==='med'?'diff-med':'diff-hard';
  const diffLabel = p.difficulty==='easy'?'BEGINNER':p.difficulty==='med'?'INTERMEDIATE':'ADVANCED';
  el.innerHTML = `
    <div class="project-header">
      <div class="project-icon">${p.icon}</div>
      <div class="difficulty-badge ${diffClass}">${diffLabel}</div>
    </div>
    <div class="project-body">
      <div class="project-title">${p.title}</div>
      <div class="project-desc">${p.desc}</div>
      <ul class="project-steps">
        ${p.steps.map((s,i)=>`<li><div class="step-num">${i+1}</div>${s}</li>`).join('')}
      </ul>
    </div>
    <div class="project-footer">
      <div class="project-tags">${p.tags.map(t=>`<span class="project-tag">${t}</span>`).join('')}</div>
      <div class="time-badge">⏱ ${p.time}</div>
    </div>
  `;
  projGrid.appendChild(el);
});

// ═══════════════════════════════════════════════════
//  QUIZ
// ═══════════════════════════════════════════════════
const questions = [
  {q:"What does the setup() function do in an Arduino sketch?",opts:["Runs forever in a loop","Runs once when the board starts","Reads sensor values","Controls LED brightness"],a:1,exp:"setup() runs exactly once when the board powers on or resets. It's used to configure pins, start Serial, and initialize libraries."},
  {q:"What is the correct voltage of an Arduino Uno's digital output pin when set to HIGH?",opts:["3.3V","12V","5V","1.8V"],a:2,exp:"Arduino Uno's digital pins output 5V when HIGH and 0V when LOW."},
  {q:"Which function reads a value from an analog pin?",opts:["digitalRead()","analogWrite()","analogRead()","sensorRead()"],a:2,exp:"analogRead() reads a voltage from pins A0–A5 and returns a value from 0 (0V) to 1023 (5V)."},
  {q:"What range of values does analogRead() return?",opts:["0 to 255","0 to 1023","0 to 100","0 to 5"],a:1,exp:"analogRead() uses a 10-bit ADC which returns values from 0 to 1023, representing 0V to 5V."},
  {q:"Why do you always need a resistor with an LED?",opts:["To make it brighter","To change its color","To limit current and prevent burnout","To increase voltage"],a:2,exp:"Without a current-limiting resistor, too much current flows through the LED. This burns out the LED and can damage the Arduino pin. Typically 220Ω–1kΩ is used."},
  {q:"What does PWM stand for?",opts:["Power Width Modulation","Pulse Width Modulation","Pulse Wave Measurement","Power Wave Meter"],a:1,exp:"PWM = Pulse Width Modulation. It rapidly switches a pin on/off to simulate an analog output level. Used for dimming LEDs and controlling motor speed."},
  {q:"Which pins on Arduino Uno support PWM output?",opts:["All digital pins","Analog pins only","Pins marked with ~ (3,5,6,9,10,11)","Only pins 0 and 1"],a:2,exp:"Only pins marked with a tilde (~) support PWM: 3, 5, 6, 9, 10, and 11 on the Arduino Uno."},
  {q:"What does INPUT_PULLUP do when set with pinMode()?",opts:["Enables an external 10kΩ pull-up resistor","Connects the internal 20kΩ resistor to pull the pin HIGH","Makes the pin output HIGH voltage","Enables analog reading mode"],a:1,exp:"INPUT_PULLUP enables Arduino's internal ~20kΩ pull-up resistor. The pin reads HIGH when floating and LOW when a button connects it to GND. No external resistor needed!"},
  {q:"What does the loop() function do?",opts:["Runs once at startup","Creates a delay","Runs continuously, repeating forever","Reads sensor data once"],a:2,exp:"loop() is the main execution loop. After setup() finishes, loop() runs repeatedly as fast as possible (thousands of times per second unless slowed by delay())."},
  {q:"What does Serial.begin(9600) do?",opts:["Sets pin 9 to 600Hz PWM","Opens serial communication at 9600 baud","Reads 9600 bytes from sensors","Sets loop speed to 9600 Hz"],a:1,exp:"Serial.begin() initializes UART serial communication. 9600 is the baud rate (bits per second). Both the Arduino and receiving device must use the same rate."},
  {q:"What formula is Ohm's Law?",opts:["P = I²R","F = ma","V = IR","E = mc²"],a:2,exp:"Ohm's Law: V = I × R. Voltage (Volts) = Current (Amps) × Resistance (Ohms). The most fundamental formula in electronics!"},
  {q:"What does analogWrite(pin, 127) do on a PWM pin?",opts:["Outputs exactly 2.5V constantly","Blinks the pin 127 times","Outputs a ~50% duty cycle PWM signal (~2.5V average)","Sets pin to HIGH for 127ms"],a:2,exp:"analogWrite with value 127 (out of 255) creates a 50% duty cycle — the pin is HIGH half the time and LOW half the time, averaging ~2.5V."},
  {q:"The HC-SR04 is used for what purpose?",opts:["Temperature measurement","Distance measurement using ultrasound","Detecting light levels","Measuring humidity"],a:1,exp:"The HC-SR04 is an ultrasonic distance sensor. It sends a sound pulse and measures the echo return time to calculate distance (2cm–400cm)."},
  {q:"What is a 'sketch' in Arduino terminology?",opts:["A wiring diagram","A type of sensor","An Arduino program/code file","A circuit layout tool"],a:2,exp:"In Arduino, a 'sketch' is simply your program — the code file you write, compile, and upload to the board. It has a .ino extension."},
  {q:"What does millis() return?",opts:["Current date and time","Milliseconds since the board started","Clock frequency in MHz","Loop iteration count"],a:1,exp:"millis() returns the number of milliseconds since the Arduino started running. It's used for non-blocking timing instead of delay(), which pauses the entire program."},
  {q:"What happens if you don't use INPUT_PULLUP and leave a button pin floating?",opts:["It always reads HIGH","It always reads LOW","It gives random, unreliable readings","It damages the board"],a:2,exp:"A floating pin has no defined voltage — it picks up electrical noise and reads randomly HIGH or LOW. Always use INPUT_PULLUP or an external pull-down resistor!"},
  {q:"Which library is needed to control a servo motor?",opts:["Wire.h","SPI.h","Servo.h","Motor.h"],a:2,exp:"Servo.h is the built-in Arduino library for controlling servo motors. It abstracts away the PWM signal timing so you can just call myServo.write(angle)."},
  {q:"What is the maximum current a single Arduino digital pin can safely source?",opts:["100mA","500mA","40mA","10mA"],a:2,exp:"Each Arduino digital pin can safely source/sink up to 40mA. For loads requiring more current (motors, lots of LEDs), use a transistor or motor driver IC."},
  {q:"In a series circuit, what happens when one LED burns out?",opts:["Other LEDs get brighter","The circuit remains unaffected","All LEDs go out (circuit breaks)","Only that section goes dark"],a:2,exp:"In series, all components share the same current path. If one LED burns out and breaks the circuit, all LEDs in the series chain go out — just like old Christmas lights!"},
  {q:"Which Arduino board is most recommended for beginners?",opts:["Arduino Mega","Arduino Due","Arduino Nano","Arduino Uno"],a:3,exp:"The Arduino Uno is the standard beginner board. It has the most tutorials, clear documentation, is easy to wire on a breadboard, and protects itself with a resettable fuse. Start here!"},
];

let qIndex=0, score=0;

function renderQuestion() {
  const q = questions[qIndex];
  document.getElementById('qNum').textContent = `Question ${qIndex+1} / ${questions.length}`;
  document.getElementById('qProgressLabel').textContent = `${Math.round(qIndex/questions.length*100)}% complete`;
  document.getElementById('qProgressFill').style.width = (qIndex/questions.length*100)+'%';
  document.getElementById('qScore').textContent = score;
  document.getElementById('quizQuestion').textContent = q.q;
  document.getElementById('quizFeedback').className = 'quiz-feedback';
  document.getElementById('quizFeedback').textContent = '';
  document.getElementById('quizNextBtn').className = 'quiz-next';

  const letters = ['A','B','C','D'];
  const optsEl = document.getElementById('quizOptions');
  optsEl.innerHTML = '';
  q.opts.forEach((o,i)=>{
    const btn = document.createElement('button');
    btn.className = 'quiz-opt';
    btn.setAttribute('data-opt-index', i);
    btn.innerHTML = `<span class="opt-letter">${letters[i]}</span>${o}<span class="opt-key-hint" style="margin-left:auto;font-size:.65rem;color:var(--muted);font-family:'Space Mono',monospace;opacity:.6;">${i+1}</span>`;
    btn.onclick = () => answerQuestion(i, btn);
    optsEl.appendChild(btn);
  });
}

function answerQuestion(chosen, btnEl) {
  const q = questions[qIndex];
  const btns = document.querySelectorAll('.quiz-opt');
  btns.forEach(b=>b.classList.add('disabled'));
  btns.forEach(b=>b.onclick=null);

  const fb = document.getElementById('quizFeedback');
  const nextBtn = document.getElementById('quizNextBtn');

  if(chosen === q.a) {
    score++;
    document.getElementById('qScore').textContent = score;
    btnEl.classList.add('correct');
    fb.textContent = '✅ Correct! ' + q.exp;
    fb.className = 'quiz-feedback correct-fb show';
  } else {
    btnEl.classList.add('wrong');
    btns[q.a].classList.add('correct');
    fb.textContent = '❌ Not quite. ' + q.exp;
    fb.className = 'quiz-feedback wrong-fb show';
  }

  nextBtn.className = 'quiz-next show';
  nextBtn.textContent = qIndex < questions.length-1 ? 'Next Question →' : 'See Results 🎉';
}

function nextQuestion() {
  qIndex++;
  if(qIndex >= questions.length) {
    showResults();
  } else {
    renderQuestion();
  }
}

function showResults() {
  document.getElementById('quizMain').style.display='none';
  const comp = document.getElementById('quizComplete');
  comp.classList.add('show');
  const pct = Math.round(score/questions.length*100);
  document.getElementById('finalScore').textContent = `${score} / ${questions.length}`;
  let msg;
  if(pct>=90) msg = "🏆 Outstanding! You're basically an Arduino engineer!";
  else if(pct>=70) msg = "🎉 Great job! You've got a solid foundation. Keep building!";
  else if(pct>=50) msg = "👍 Good effort! Review the sections you missed and try again.";
  else msg = "📚 Keep studying! Read through the guide again — you'll get there!";
  document.getElementById('finalMsg').textContent = msg;
}

function restartQuiz() {
  qIndex=0; score=0;
  document.getElementById('quizMain').style.display='block';
  document.getElementById('quizComplete').classList.remove('show');
  renderQuestion();
}

// Keyboard navigation for quiz (1-4 to select, Enter for Next)
document.addEventListener('keydown', function(e) {
  const quizMain = document.getElementById('quizMain');
  if(!quizMain || quizMain.style.display==='none') return;
  const n = parseInt(e.key);
  if(n>=1&&n<=4) {
    const opts = document.querySelectorAll('.quiz-opt:not(.disabled)');
    if(opts[n-1]) { opts[n-1].click(); e.preventDefault(); }
  }
  if(e.key==='Enter') {
    const nextBtn = document.getElementById('quizNextBtn');
    if(nextBtn&&nextBtn.classList.contains('show')) { nextBtn.click(); e.preventDefault(); }
  }
});

renderQuestion();
</script>

<script>
// ═══════════════════════════════════════════════════
//  NEW CHAPTERS — INTERACTIVE ELEMENTS
// ═══════════════════════════════════════════════════

// ── MEMORY BARS — animate on scroll ──
(function(){
  const el = document.getElementById('memoryBars');
  if(!el) return;
  const obs = new IntersectionObserver(entries=>{
    entries.forEach(e=>{
      if(e.isIntersecting){
        setTimeout(()=>{ document.getElementById('flashBar').style.width='100%'; },100);
        setTimeout(()=>{ document.getElementById('sramBar').style.width='6.25%'; },300);
        setTimeout(()=>{ document.getElementById('eepromBar').style.width='3.125%'; },500);
        obs.disconnect();
      }
    });
  },{threshold:0.3});
  obs.observe(el);
})();

// ── LOOP DEMO — Ch08 ──
(function(){
  const boxesEl = document.getElementById('loopBoxes');
  const output = document.getElementById('loopOutput');
  const statusEl = document.getElementById('loopStatus');
  const btn = document.getElementById('loopDemoBtn');
  if(!boxesEl) return;
  const COUNT = 20;
  let loopCount=0, running=false, tid=null, currentBox=0;
  for(let i=0;i<COUNT;i++){
    const b=document.createElement('div'); b.className='loop-box'; b.id='lb'+i; b.textContent=i; boxesEl.appendChild(b);
  }
  function tick(){
    document.querySelectorAll('.loop-box').forEach(b=>b.classList.remove('active'));
    const b=document.getElementById('lb'+currentBox);
    if(b){ b.classList.add('active'); b.classList.add('done'); }
    output.textContent+=`loop() #${loopCount+1}: processing index ${currentBox}\n`;
    output.scrollTop=output.scrollHeight;
    statusEl.textContent=`Running — ${loopCount+1} iterations`;
    currentBox=(currentBox+1)%COUNT;
    if(currentBox===0) loopCount++;
    const speed=parseInt(document.getElementById('loopSpeedSlider').value);
    if(running) tid=setTimeout(tick,900-speed);
  }
  window.toggleLoopDemo=function(){
    running=!running; btn.textContent=running?'⏸ Pause':'▶ Start loop()';
    if(running) tick(); else clearTimeout(tid);
  };
  window.resetLoopDemo=function(){
    running=false; clearTimeout(tid); loopCount=0; currentBox=0;
    btn.textContent='▶ Start loop()';
    output.textContent='// Press Start to run the loop!\n';
    statusEl.textContent='Stopped — 0 iterations';
    document.querySelectorAll('.loop-box').forEach(b=>b.classList.remove('active','done'));
  };
})();

// ── FLOW CHART CANVAS — Ch10 ──
(function(){
  const canvas=document.getElementById('flowCanvas');
  if(!canvas) return;
  const ctx=canvas.getContext('2d');
  function rr(x,y,w,h,r){
    ctx.beginPath(); ctx.moveTo(x+r,y); ctx.lineTo(x+w-r,y);
    ctx.quadraticCurveTo(x+w,y,x+w,y+r); ctx.lineTo(x+w,y+h-r);
    ctx.quadraticCurveTo(x+w,y+h,x+w-r,y+h); ctx.lineTo(x+r,y+h);
    ctx.quadraticCurveTo(x,y+h,x,y+h-r); ctx.lineTo(x,y+r);
    ctx.quadraticCurveTo(x,y,x+r,y); ctx.closePath();
  }
  function drawFlowChart(temp,thresh){
    const W=canvas.width,H=canvas.height;
    ctx.clearRect(0,0,W,H); ctx.fillStyle='#0a0e1a'; ctx.fillRect(0,0,W,H);
    const hot=temp>thresh, YES_COL=hot?'#c0392b':'#27ae60', NO_COL=hot?'#27ae60':'#c0392b';
    // Code side
    const cx=350,cy=20;
    ctx.fillStyle='#0d1117'; ctx.strokeStyle='#2a3560'; ctx.lineWidth=1;
    rr(cx,cy,295,215,10); ctx.fill(); ctx.stroke();
    const lines=[
      {t:`float temp    = ${temp}.0;`,c:'#8be9fd'},
      {t:`float thresh  = ${thresh}.0;`,c:'#8be9fd'},
      {t:'',c:''},
      {t:`if (temp > thresh) {`,c:hot?'#f1fa8c':'#6272a4'},
      {t:`  fanOn = true;   // ← ${hot?'RUNS':'skipped'}`,c:hot?'#50fa7b':'#6272a4'},
      {t:`} else {`,c:hot?'#6272a4':'#f1fa8c'},
      {t:`  fanOn = false;  // ← ${hot?'skipped':'RUNS'}`,c:hot?'#6272a4':'#50fa7b'},
      {t:`}`,c:'#f8f8f2'},
      {t:'',c:''},
      {t:`// → fanOn = ${hot}`,c:hot?'#ff4757':'#00ff88'},
    ];
    lines.forEach((l,i)=>{
      if(!l.t) return;
      ctx.fillStyle=l.c; ctx.font='11px JetBrains Mono'; ctx.textAlign='left';
      ctx.fillText(l.t,cx+12,cy+22+i*20);
    });
    // Result badge
    const rc=hot?'rgba(192,57,43,.25)':'rgba(39,174,96,.25)', rs=hot?'#c0392b':'#27ae60';
    ctx.fillStyle=rc; rr(cx,cy+210,295,30,6); ctx.fill(); ctx.strokeStyle=rs; ctx.stroke();
    ctx.fillStyle=hot?'#ff6b81':'#00ff88'; ctx.font='bold 11px Syne'; ctx.textAlign='center';
    ctx.fillText(hot?`🔴 TRUE: temp(${temp}) > thresh(${thresh})`:`🟢 FALSE: temp(${temp}) ≤ thresh(${thresh})`,cx+148,cy+230);
    // Flowchart boxes
    function box(x,y,w,h,txt,fill,tc){
      ctx.fillStyle=fill; rr(x,y,w,h,8); ctx.fill();
      ctx.strokeStyle='rgba(255,255,255,.1)'; ctx.lineWidth=1.5; ctx.stroke();
      ctx.fillStyle=tc||'#fff'; ctx.font='bold 10px Space Mono'; ctx.textAlign='center';
      ctx.fillText(txt,x+w/2,y+h/2+4);
    }
    function arr(x1,y1,x2,y2,lbl,lx,ly){
      ctx.strokeStyle='#3a4570'; ctx.lineWidth=2;
      ctx.beginPath(); ctx.moveTo(x1,y1); ctx.lineTo(x2,y2); ctx.stroke();
      const dx=x2-x1,dy=y2-y1,len=Math.hypot(dx,dy)+.001;
      const ux=dx/len,uy=dy/len;
      ctx.fillStyle='#3a4570'; ctx.beginPath(); ctx.moveTo(x2,y2); ctx.lineTo(x2-ux*8-uy*5,y2-uy*8+ux*5); ctx.lineTo(x2-ux*8+uy*5,y2-uy*8-ux*5); ctx.closePath(); ctx.fill();
      if(lbl){ ctx.fillStyle='#8892b0'; ctx.font='9px Space Mono'; ctx.textAlign='center'; ctx.fillText(lbl,lx,ly); }
    }
    box(20,15,140,30,'START / setup()', '#1a3a5c','#00d4ff');
    arr(90,45,90,70,'','','');
    box(20,70,140,30,'loop()', '#1a3a5c','#00d4ff');
    arr(90,100,90,130,'','','');
    // Diamond
    ctx.fillStyle='#2a3a5a'; ctx.beginPath(); ctx.moveTo(90,130); ctx.lineTo(160,157); ctx.lineTo(90,184); ctx.lineTo(20,157); ctx.closePath(); ctx.fill();
    ctx.strokeStyle='rgba(255,255,255,.1)'; ctx.lineWidth=1; ctx.stroke();
    ctx.fillStyle='#f1fa8c'; ctx.font='bold 9px Space Mono'; ctx.textAlign='center';
    ctx.fillText(`temp>${thresh}?`,90,161);
    // YES path
    arr(160,157,220,135,'YES',193,138);
    box(220,120,110,30, hot?'FAN ON 🔴':'FAN OFF 🟢', hot?'rgba(192,57,43,.8)':'rgba(39,174,96,.8)');
    // NO path
    arr(90,184,90,215,'NO',102,205);
    box(20,215,140,30,'else block', '#2a3a4a','#8892b0');
    arr(220,150,320,150,'→','','');
  }
  window.updateFlowDemo=function(){
    const temp=parseInt(document.getElementById('tempSlider').value);
    const thresh=parseInt(document.getElementById('threshSlider').value);
    document.getElementById('tempVal').textContent=temp;
    document.getElementById('threshVal').textContent=thresh;
    const hot=temp>thresh;
    document.getElementById('flowOutput').textContent=`// temp = ${temp}°C,  threshold = ${thresh}°C\nif (${temp} > ${thresh})  →  ${hot?'TRUE':'FALSE'}\n// Executing: ${hot?'if-block (fan ON)':'else-block (fan OFF)'}`;
    drawFlowChart(temp,thresh);
  };
  updateFlowDemo();
})();

// ── FOR LOOP VISUALIZER — Ch10 ──
(function(){
  const boxesEl=document.getElementById('forLoopBoxes');
  const output=document.getElementById('forLoopOutput');
  const statusEl=document.getElementById('forLoopStatus');
  const btn=document.getElementById('forLoopBtn');
  if(!boxesEl) return;
  const COUNT=16;
  let running=false,tid=null,i=0;
  const states=new Array(COUNT).fill(0);
  for(let k=0;k<COUNT;k++){
    const cell=document.createElement('div'); cell.className='array-cell';
    cell.innerHTML=`<div class="array-idx">[${k}]</div><div class="loop-box" id="flb${k}" style="width:38px;height:38px;font-size:.7rem;">P${k}</div>`;
    boxesEl.appendChild(cell);
  }
  function tick(){
    document.querySelectorAll('[id^=flb]').forEach((b,k)=>{ b.classList.remove('active'); if(states[k]===2) b.classList.add('done'); });
    if(i>=COUNT){ output.textContent+=`for loop done! ${COUNT} pins configured.\n`; statusEl.textContent='✅ Complete!'; running=false; btn.textContent='▶ Run for loop'; return; }
    const b=document.getElementById('flb'+i); if(b) b.classList.add('active');
    output.textContent+=`i=${i}: pinMode(ledPins[${i}], OUTPUT); // pin=${[3,5,6,9,10,11,4,7,8,2,12,13,0,1,14,15][i]}\n`;
    output.scrollTop=output.scrollHeight;
    statusEl.textContent=`i=${i} of ${COUNT-1}`;
    states[i]=2; i++;
    const speed=parseInt(document.getElementById('forLoopSpeed').value);
    if(running) tid=setTimeout(tick,1000-speed);
  }
  window.toggleForLoop=function(){
    if(i>=COUNT){resetForLoop();return;} running=!running;
    btn.textContent=running?'⏸ Pause':'▶ Run for loop';
    if(running) tick(); else clearTimeout(tid);
  };
  window.resetForLoop=function(){
    running=false; clearTimeout(tid); i=0; states.fill(0);
    btn.textContent='▶ Run for loop';
    output.textContent='//  16 LED pins, using a for loop\n// Press Run!\n';
    statusEl.textContent='for(int i=0; i<16; i++)';
    document.querySelectorAll('[id^=flb]').forEach(b=>b.classList.remove('active','done'));
  };
})();

// ── FUNCTION PLAYGROUND — Ch11 ──
(function(){
  if(!document.getElementById('fnInputsArea')) return;
  const fns=[
    { name:'int add(a, b)', params:[{id:'fnA',label:'a (int)',val:'12'},{id:'fnB',label:'b (int)',val:'7'}],
      run:()=>{ const a=+document.getElementById('fnA').value||0,b=+document.getElementById('fnB').value||0; return {val:a+b,code:`add(${a}, ${b}) → ${a+b}`,label:'Return value (int)'}; } },
    { name:'float voltToC(v)', params:[{id:'fnV',label:'analogRead (0–1023)',val:'512'}],
      run:()=>{ const raw=+document.getElementById('fnV').value||0,v=raw*5/1023,c=(v-.5)*100; return {val:c.toFixed(2)+'°C',code:`raw=${raw} → ${v.toFixed(3)}V → ${c.toFixed(2)}°C`,label:'Temperature (float)'}; } },
    { name:'int map(v, 0,1023, 0,255)', params:[{id:'fnM',label:'Input value (0–1023)',val:'512'}],
      run:()=>{ const v=+document.getElementById('fnM').value||0,m=Math.round(v/1023*255); return {val:m,code:`map(${v}, 0,1023, 0,255) → ${m}`,label:'Mapped value (int)'}; } },
    { name:'bool isHot(temp)', params:[{id:'fnT',label:'Temperature (°C)',val:'25'}],
      run:()=>{ const t=+document.getElementById('fnT').value||0,h=t>30; return {val:h?'true':'false',code:`isHot(${t}) → ${h} (threshold: 30°C)`,label:'Boolean result'}; } },
  ];
  let cur=0;
  window.selectFn=function(idx){
    cur=idx;
    document.querySelectorAll('[id^=fnBtn]').forEach((b,k)=>{ b.style.background=k===idx?'var(--accent3)':'var(--border)'; b.style.color=k===idx?'white':'var(--text)'; });
    const f=fns[cur];
    document.getElementById('fnInputsArea').innerHTML=f.params.map(p=>`<label style="display:block;font-size:.75rem;color:var(--muted);font-family:'Space Mono',monospace;margin-bottom:.3rem;">${p.label}</label><input id="${p.id}" type="number" value="${p.val}" oninput="runFn()" style="width:100%;background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:.6rem .8rem;font-family:'JetBrains Mono',monospace;font-size:.9rem;color:var(--text);outline:none;margin-bottom:1rem;" onfocus="this.style.borderColor='var(--accent)'" onblur="this.style.borderColor='var(--border)'">`).join('');
    runFn();
  };
  window.runFn=function(){
    try{ const r=fns[cur].run(); document.getElementById('fnResultValue').textContent=r.val; document.getElementById('fnResultCode').textContent=r.code; document.getElementById('fnResultArea').querySelector('.fn-result-label').textContent=r.label; }catch(e){}
  };
  selectFn(0);
})();

// ── ARRAY VISUALIZER — Ch12 ──
(function(){
  const vis=document.getElementById('arrayGridVis');
  const log=document.getElementById('arrayLog');
  if(!vis) return;
  let arr=[3,5,6,9,10,11,255,128],hi=-1,mi=-1;
  function render(){
    vis.innerHTML='';
    arr.forEach((v,i)=>{
      const cell=document.createElement('div'); cell.className='array-cell';
      const idx=document.createElement('div'); idx.className='array-idx'; idx.textContent=`[${i}]`;
      const val=document.createElement('div');
      val.className='array-val'+(i===hi?' highlighted':'')+(i===mi?' modified':'');
      val.textContent=v; val.title=`[${i}]=${v}`;
      val.onclick=()=>{ hi=i; mi=-1; log.textContent=`Serial.println(ledPins[${i}]);\n→ Output: ${v}`; render(); };
      cell.appendChild(idx); cell.appendChild(val); vis.appendChild(cell);
    });
  }
  window.arrayWrite=function(){
    const idx=parseInt(document.getElementById('arrIdxInput').value),val=parseInt(document.getElementById('arrValInput').value);
    if(isNaN(idx)||idx<0||idx>=arr.length){log.textContent=`// Error: index ${idx} out of bounds (0–${arr.length-1})`;return;}
    if(isNaN(val)){log.textContent='// Enter a value to write';return;}
    const old=arr[idx]; arr[idx]=val; mi=idx; hi=-1;
    log.textContent=`ledPins[${idx}] = ${val};\n// Was: ${old}  →  Now: ${val} ✅`; render();
  };
  window.arrayRead=function(){
    const idx=parseInt(document.getElementById('arrIdxInput').value);
    if(isNaN(idx)||idx<0||idx>=arr.length){log.textContent=`// Error: index ${idx} out of bounds`;return;}
    hi=idx; mi=-1; log.textContent=`Serial.println(ledPins[${idx}]);\n→ ${arr[idx]}`; render();
  };
  window.arrayLoopThrough=function(){
    log.textContent='for(int i=0; i<8; i++) { ... }\n'; let k=0;
    function step(){ if(k>arr.length){log.textContent+='// Loop complete!\n';hi=-1;render();return;} hi=k;mi=-1; if(k<arr.length) log.textContent+=`  [${k}] → pin ${arr[k]}: pinMode(${arr[k]}, OUTPUT)\n`; render(); k++; setTimeout(step,350); } step();
  };
  render();
})();

// ── MILLIS SIMULATION — Ch13 ──
(function(){
  const canvas=document.getElementById('millisCanvas');
  if(!canvas) return;
  const ctx=canvas.getContext('2d');
  const btn=document.getElementById('millisStartBtn');
  const log1=document.getElementById('millisLog1');
  const log2=document.getElementById('millisLog2');
  let running=false,tid=null,t=0;
  const W=canvas.width,H=canvas.height;
  function rr2(x,y,w,h,r){ctx.beginPath();ctx.moveTo(x+r,y);ctx.lineTo(x+w-r,y);ctx.quadraticCurveTo(x+w,y,x+w,y+r);ctx.lineTo(x+w,y+h-r);ctx.quadraticCurveTo(x+w,y+h,x+w-r,y+h);ctx.lineTo(x+r,y+h);ctx.quadraticCurveTo(x,y+h,x,y+h-r);ctx.lineTo(x,y+r);ctx.quadraticCurveTo(x,y,x+r,y);ctx.closePath();}
  function draw(){
    ctx.clearRect(0,0,W,H); ctx.fillStyle='#0a0e1a'; ctx.fillRect(0,0,W,H);
    const maxT=7000,scl=(W/2-30)/maxT;
    ctx.strokeStyle='#2a3560';ctx.lineWidth=1;ctx.setLineDash([4,4]);
    ctx.beginPath();ctx.moveTo(W/2,0);ctx.lineTo(W/2,H);ctx.stroke();ctx.setLineDash([]);
    ctx.fillStyle='#ff4757';ctx.font='bold 11px Space Mono';ctx.textAlign='center';ctx.fillText('delay() — blocks tasks',W/4+5,16);
    ctx.fillStyle='#00ff88';ctx.font='bold 11px Space Mono';ctx.fillText('millis() — tasks run freely',W*3/4,16);
    const tasks=[{label:'LED Blink',y:55,colors:['rgba(255,107,53,.7)','rgba(255,107,53,.12)'],period:800,duty:400},
                 {label:'Sensor Read',y:95,colors:['rgba(0,212,255,.7)','rgba(0,212,255,.12)'],period:300,duty:150}];
    // delay side
    tasks.forEach((tk,ti)=>{
      const ox=10,oy=tk.y;
      ctx.fillStyle='#141c30';ctx.fillRect(ox,oy-10,W/2-20,22);
      ctx.strokeStyle='#2a3560';ctx.lineWidth=1;ctx.strokeRect(ox,oy-10,W/2-20,22);
      ctx.fillStyle=tk.colors[0];ctx.font='8px Space Mono';ctx.textAlign='left';ctx.fillText(tk.label,ox+3,oy+4);
      let tx=0;
      while(tx<=Math.min(t,maxT)){
        if(ti===0){
          const w=Math.min(tk.duty*scl,(Math.min(t,maxT)-tx)*scl);
          ctx.fillStyle=tk.colors[0];ctx.fillRect(ox+tx*scl,oy-8,Math.max(0,w),18);
          tx+=tk.duty;
          const w2=Math.min(tk.duty*scl,(Math.min(t,maxT)-tx)*scl);
          // blocked (striped)
          if(w2>0){
            const patC=document.createElement('canvas');patC.width=6;patC.height=6;
            const pCtx=patC.getContext('2d');pCtx.strokeStyle='rgba(255,0,0,.7)';pCtx.lineWidth=1;
            pCtx.beginPath();pCtx.moveTo(0,6);pCtx.lineTo(6,0);pCtx.stroke();
            const pat=ctx.createPattern(patC,'repeat');
            ctx.fillStyle=pat;ctx.fillRect(ox+tx*scl,oy-8,Math.max(0,w2),18);
          }
          tx+=tk.duty;
        } else {
          // sensor blocked during LED delay
          const ledPhase=(tx%800)<400;
          const w=Math.min(200*scl,(Math.min(t,maxT)-tx)*scl);
          if(ledPhase&&w>0){ctx.fillStyle=tk.colors[0];ctx.fillRect(ox+tx*scl,oy-8,w,18);}
          else if(w>0){const patC2=document.createElement('canvas');patC2.width=6;patC2.height=6;const pCtx2=patC2.getContext('2d');pCtx2.strokeStyle='rgba(255,0,0,.5)';pCtx2.lineWidth=1;pCtx2.beginPath();pCtx2.moveTo(0,6);pCtx2.lineTo(6,0);pCtx2.stroke();ctx.fillStyle=ctx.createPattern(patC2,'repeat');ctx.fillRect(ox+tx*scl,oy-8,w,18);}
          tx+=300;
        }
      }
    });
    // millis side
    tasks.forEach((tk,ti)=>{
      const ox=W/2+10,oy=tk.y;
      ctx.fillStyle='#141c30';ctx.fillRect(ox,oy-10,W/2-20,22);
      ctx.strokeStyle='#2a3560';ctx.lineWidth=1;ctx.strokeRect(ox,oy-10,W/2-20,22);
      ctx.fillStyle=tk.colors[0];ctx.font='8px Space Mono';ctx.textAlign='left';ctx.fillText(tk.label,ox+3,oy+4);
      let tx=0;
      while(tx<=Math.min(t,maxT)){
        const w=Math.min(tk.duty*scl,(Math.min(t,maxT)-tx)*scl);
        if(w>0){ctx.fillStyle=tk.colors[0];ctx.fillRect(ox+tx*scl,oy-8,w,18);}
        tx+=tk.period;
      }
    });
    // Cursor
    const cx=Math.min(t,maxT)*scl;
    [10,W/2+10].forEach(ox=>{
      ctx.strokeStyle='rgba(255,255,255,.5)';ctx.lineWidth=1.5;ctx.setLineDash([3,3]);
      ctx.beginPath();ctx.moveTo(ox+cx,25);ctx.lineTo(ox+cx,120);ctx.stroke();ctx.setLineDash([]);
    });
    ctx.fillStyle='#e8eaf6';ctx.font='9px Space Mono';ctx.textAlign='center';
    ctx.fillText(`${(t/1000).toFixed(1)}s`,10+cx,135);
    ctx.fillText(`${(t/1000).toFixed(1)}s`,W/2+10+cx,135);
    // Legend
    ctx.fillStyle='#141c30';rr2(10,155,200,35,6);ctx.fill();ctx.strokeStyle='#2a3560';ctx.lineWidth=1;ctx.stroke();
    ctx.fillStyle='rgba(255,0,0,.5)';ctx.fillRect(18,162,12,10);ctx.fillStyle='#ff4757';ctx.font='8px Space Mono';ctx.textAlign='left';ctx.fillText('= BLOCKED by delay()',34,171);
    ctx.fillStyle='rgba(0,212,255,.7)';ctx.fillRect(18,175,12,10);ctx.fillStyle='#00d4ff';ctx.fillText('= Running freely',34,184);
  }
  function step(){
    t+=80; draw();
    const ledOn=Math.floor(t/400)%2===0;
    if(t%400<80) log1.textContent=`[${(t/1000).toFixed(1)}s] LED ${ledOn?'ON ':'OFF'} | FROZEN for 400ms...`;
    if(t%300<80) log2.textContent=`[${(t/1000).toFixed(1)}s] LED ${ledOn?'ON ':'OFF'} | sensor=${Math.round(Math.sin(t*.006)*200+512)} | both running!`;
    if(t<7000&&running) tid=setTimeout(step,40);
    else if(t>=7000){running=false;btn.textContent='▶ Restart';}
  }
  window.toggleMillisSim=function(){
    if(!running&&t>=7000){resetMillisSim();return;}
    running=!running; btn.textContent=running?'⏸ Pause':'▶ Resume';
    if(running) step(); else clearTimeout(tid);
  };
  window.resetMillisSim=function(){
    running=false;clearTimeout(tid);t=0;btn.textContent='▶ Start Simulation';
    log1.textContent='Using delay()...';log2.textContent='Using millis()...';draw();
  };
  draw(); // draw initial state
})(); // ← FIXED: close millis IIFE

// ═══════════════════════════════════════════════════
//  HERO PARTICLE SYSTEM
// ═══════════════════════════════════════════════════
(function(){
  const container = document.getElementById('heroParticles');
  if(!container) return;
  const colors = ['#00d4ff','#ff6b35','#7c3aed','#00ff88','#ffd700'];
  for(let i=0; i<60; i++){
    const p = document.createElement('div');
    p.className = 'hparticle';
    const size = 1 + Math.random() * 3;
    p.style.cssText = `
      left: ${Math.random()*100}%;
      width: ${size}px; height: ${size}px;
      background: ${colors[Math.floor(Math.random()*colors.length)]};
      animation-duration: ${4 + Math.random()*8}s;
      animation-delay: ${Math.random()*8}s;
      opacity: 0;
    `;
    container.appendChild(p);
  }
})();

// ═══════════════════════════════════════════════════
//  CH15 — OPERATOR PLAYGROUND
// ═══════════════════════════════════════════════════
function updateOps() {
  const a = parseFloat(document.getElementById('opA').value) || 0;
  const b = parseFloat(document.getElementById('opB').value) || 0;
  const isInt = Number.isInteger(a) && Number.isInteger(b);
  const ops = [
    { expr: `${a} + ${b}`,   val: a+b,    cls:'num' },
    { expr: `${a} - ${b}`,   val: a-b,    cls:'num' },
    { expr: `${a} * ${b}`,   val: a*b,    cls:'num' },
    { expr: `${a} / ${b}`,   val: b!==0 ? (isInt ? Math.trunc(a/b) : a/b) : 'ERR÷0', cls:'num', note: isInt&&b!==0?'integer division':'' },
    { expr: `${a} % ${b}`,   val: b!==0 ? (isInt ? ((a%b)+Math.abs(b))%Math.abs(b) : 'float%') : 'ERR÷0', cls:'num' },
    { expr: `${a} == ${b}`,  val: a===b ? 'true':'false', cls: a===b?'true':'false' },
    { expr: `${a} != ${b}`,  val: a!==b ? 'true':'false', cls: a!==b?'true':'false' },
    { expr: `${a} < ${b}`,   val: a<b  ? 'true':'false',  cls: a<b?'true':'false' },
    { expr: `${a} > ${b}`,   val: a>b  ? 'true':'false',  cls: a>b?'true':'false' },
    { expr: `${a} <= ${b}`,  val: a<=b ? 'true':'false',  cls: a<=b?'true':'false' },
    { expr: `${a} >= ${b}`,  val: a>=b ? 'true':'false',  cls: a>=b?'true':'false' },
    { expr: `map(${a},0,${b||1},0,255)`, val: b ? Math.round(a/b*255) : 'N/A', cls:'num' },
    { expr: `constrain(${a},0,${b||255})`, val: Math.min(Math.max(a,0),b||255), cls:'num' },
    { expr: `abs(${a})`,  val: Math.abs(a), cls:'num' },
    { expr: `min(${a},${b})`, val: Math.min(a,b), cls:'num' },
    { expr: `max(${a},${b})`, val: Math.max(a,b), cls:'num' },
  ];
  const el = document.getElementById('opResults');
  if(!el) return;
  el.innerHTML = ops.map(o => `
    <div class="op-result-row">
      <div class="op-result-expr">${o.expr}${o.note?` <span style="color:#555;font-size:.65rem;">(${o.note})</span>`:''}:</div>
      <div class="op-result-val ${o.cls}">${o.val}</div>
    </div>
  `).join('');
}
// Init on load
document.addEventListener('DOMContentLoaded', updateOps);
setTimeout(updateOps, 100);

// ═══════════════════════════════════════════════════
//  COPY CODE BUTTONS — add to all .code-editor blocks
// ═══════════════════════════════════════════════════
(function(){
  document.querySelectorAll('.code-editor').forEach(editor=>{
    const header = editor.querySelector('.editor-header');
    if(!header || header.querySelector('.copy-code-btn')) return;
    const btn = document.createElement('button');
    btn.className = 'copy-code-btn';
    btn.title = 'Copy code';
    btn.innerHTML = '⎘ Copy';
    btn.style.cssText='background:rgba(0,212,255,.1);border:1px solid rgba(0,212,255,.2);color:var(--accent);border-radius:5px;padding:.2rem .6rem;font-family:Space Mono,monospace;font-size:.65rem;cursor:pointer;transition:all .2s;margin-left:.5rem;';
    btn.onclick = function(){
      const code = editor.querySelector('.code-area code, .cpp-code');
      if(!code) return;
      const text = code.innerText || code.textContent;
      navigator.clipboard.writeText(text).then(()=>{
        btn.innerHTML = '✓ Copied!';
        btn.style.color='var(--green)';
        btn.style.borderColor='rgba(0,255,136,.3)';
        setTimeout(()=>{ btn.innerHTML='⎘ Copy'; btn.style.color='var(--accent)'; btn.style.borderColor='rgba(0,212,255,.2)'; },1500);
      }).catch(()=>{
        btn.innerHTML='✗ Failed';
        setTimeout(()=>{ btn.innerHTML='⎘ Copy'; },1200);
      });
    };
    header.querySelector('.editor-dots').insertAdjacentElement('afterend', btn);
  });
})();

// ═══════════════════════════════════════════════════
//  SCROLL REVEAL — add .reveal to cards/sections
// ═══════════════════════════════════════════════════
(function(){
  // Mark revealable elements
  document.querySelectorAll('.card,.analogy-card,.error-card,.lib-card,.project-card,.highlight-box,.tip-box,.array-vis,.millis-demo,.op-playground,.serial-playground,.fn-vis,.circuit-demo,.flow-demo').forEach(el=>{
    el.classList.add('reveal');
  });
  const obs = new IntersectionObserver(entries=>{
    entries.forEach(e=>{
      if(e.isIntersecting) { e.target.classList.add('visible'); obs.unobserve(e.target); }
    });
  },{threshold:0.08});
  document.querySelectorAll('.reveal').forEach(el=>obs.observe(el));
})();

// ═══════════════════════════════════════════════════
//  NAV ACTIVE HIGHLIGHT on scroll
// ═══════════════════════════════════════════════════
(function(){
  const sections = document.querySelectorAll('section[id]');
  const navLinks = document.querySelectorAll('.nav-links a[href^="#"]');
  const obs = new IntersectionObserver(entries=>{
    entries.forEach(e=>{
      if(e.isIntersecting) {
        navLinks.forEach(a=>a.classList.remove('active'));
        const link = document.querySelector(`.nav-links a[href="#${e.target.id}"]`);
        if(link) link.classList.add('active');
      }
    });
  },{rootMargin:'-40% 0px -55% 0px'});
  sections.forEach(s=>obs.observe(s));
})();

// ═══════════════════════════════════════════════════
//  SIM CANVAS — add/remove running class
// ═══════════════════════════════════════════════════
const _origRunCode = runCode;
const _origStopCode = stopCode;
// Patch to add visual state class
const simWrap = document.getElementById('simCanvasWrap');
const _patchRun = function() {
  _origRunCode.apply(this, arguments);
  // Update class AFTER the call so pause/resume state is correct
  if(simWrap) {
    if(simRunning) simWrap.classList.add('running');
    else simWrap.classList.remove('running');
  }
};
const _patchStop = function() {
  if(simWrap) simWrap.classList.remove('running');
  _origStopCode.apply(this, arguments);
};
// Replace globals
window.runCode = _patchRun;
window.stopCode = _patchStop;
// Bind buttons
const runBtn = document.getElementById('runSimBtn');
const stopBtn = document.getElementById('stopSimBtn');
if(runBtn) runBtn.onclick = _patchRun;
if(stopBtn) stopBtn.onclick = _patchStop;

// Keyboard shortcut: R = run/pause, S = stop, arrows for snippet switch
document.addEventListener('keydown', function(e) {
  // Only if not typing in an input
  if(e.target.tagName==='INPUT'||e.target.tagName==='TEXTAREA') return;
  if(e.key==='r'||e.key==='R') { _patchRun(); }
  else if(e.key==='s'||e.key==='S') { _patchStop(); }
  else if(e.key==='ArrowRight'||e.key===']') {
    const btns=document.querySelectorAll('.editor-tab-btn');
    const next=(currentSnippet+1)%btns.length;
    btns[next].click();
  } else if(e.key==='ArrowLeft'||e.key==='[') {
    const btns=document.querySelectorAll('.editor-tab-btn');
    const prev=(currentSnippet-1+btns.length)%btns.length;
    btns[prev].click();
  }
});
(function(){
  let smReady = false;
  function initSerial() {
    const mon = document.getElementById('serialMonitorBig');
    if(!mon) return;
    mon.innerHTML = '';
    addSerialLine(mon, 'Ready!', '#00ff88');
    smReady = true;
  }
  function addSerialLine(mon, text, color) {
    const ts = (Date.now() % 100000 / 1000).toFixed(1);
    const line = document.createElement('div');
    line.style.cssText = `display:flex;gap:.5rem;animation:fadeInLine .2s ease;`;
    line.innerHTML = `<span style="color:#1a5a1a;flex-shrink:0;">[${ts}s]</span><span style="color:${color||'#50fa7b'}">${text}</span>`;
    mon.appendChild(line);
    mon.scrollTop = mon.scrollHeight;
  }
  window.sendSerial = function() {
    const inp = document.getElementById('serialInput');
    const mon = document.getElementById('serialMonitorBig');
    if(!mon || !inp) return;
    if(!smReady) initSerial();
    const val = inp.value.trim();
    if(!val) return;
    // Show sent value
    addSerialLine(mon, `> ${val}`, '#8892b0');
    // Simulate Arduino response
    const n = parseInt(val);
    if(!isNaN(n)) {
      const mapped = Math.round(Math.max(0,Math.min(1023,n)) / 1023 * 255);
      setTimeout(()=>addSerialLine(mon, `Got: ${n}`, '#00ff88'), 80);
      setTimeout(()=>addSerialLine(mon, ` → map→PWM: ${mapped}`, '#00d4ff'), 180);
      if(n < 0 || n > 1023) {
        setTimeout(()=>addSerialLine(mon, ` ⚠ Out of range! (0–1023)`, '#ffd700'), 280);
      }
    } else {
      setTimeout(()=>addSerialLine(mon, `Not a number: "${val}"`, '#ff6b81'), 80);
    }
    inp.value = '';
  };
  // Initialize when DOM is ready
  setTimeout(initSerial, 200);
})();

// ═══════════════════════════════════════════════════
//  CH17 — ERROR DECODER
// ═══════════════════════════════════════════════════
const errorPatterns = [
  { pattern: /was not declared in this scope/i,
    title: '❌ Variable not declared',
    fix: 'Declare the variable before using it: <code style="color:#00d4ff">int variableName = 0;</code> or check for typos.',
    color: '#ff4757' },
  { pattern: /expected ';' before/i,
    title: '❌ Missing semicolon',
    fix: 'Add a semicolon at the end of the highlighted line. Check the line ABOVE the error too.',
    color: '#ff6b81' },
  { pattern: /expected ';'/i,
    title: '❌ Missing semicolon',
    fix: 'Every statement needs a semicolon. Common fix: add ; before the line the error points to.',
    color: '#ff6b81' },
  { pattern: /no matching function for call to/i,
    title: '❌ Wrong function arguments',
    fix: 'The function exists but you called it with wrong argument types or count. Check the function signature.',
    color: '#ffd700' },
  { pattern: /invalid conversion from/i,
    title: '❌ Type mismatch',
    fix: 'You\'re passing the wrong type. Use a cast: <code style="color:#00d4ff">(int)myFloat</code> or change your variable type.',
    color: '#ffd700' },
  { pattern: /redefinition of/i,
    title: '❌ Variable defined twice',
    fix: 'You declared the same variable name twice. Remove the duplicate declaration or rename one.',
    color: '#ff6b35' },
  { pattern: /'[^']+' does not name a type/i,
    title: '❌ Missing #include',
    fix: 'You\'re using a type from a library but forgot to #include it. Add the #include at the top.',
    color: '#a78bfa' },
  { pattern: /could not convert/i,
    title: '❌ Implicit conversion error',
    fix: 'Explicit cast needed. Try: <code style="color:#00d4ff">(float)myInt</code> or use the correct type.',
    color: '#ffd700' },
  { pattern: /stray '\\\\' in program/i,
    title: '❌ Backslash error',
    fix: 'Remove the stray backslash. In strings, use \\\\ for a literal backslash.',
    color: '#ff4757' },
  { pattern: /unterminated string/i,
    title: '❌ String not closed',
    fix: 'You opened a string with " but didn\'t close it. Add a closing " to your string.',
    color: '#ff6b81' },
  { pattern: /\#include.*not found|no such file/i,
    title: '❌ Library not installed',
    fix: 'Install the library first: Sketch → Include Library → Manage Libraries. Search for the library name.',
    color: '#a78bfa' },
  { pattern: /overflow|integer overflow/i,
    title: '⚠️ Integer overflow warning',
    fix: 'Your value exceeds the int range (−32768 to 32767). Use <code style="color:#00d4ff">long</code> or <code style="color:#00d4ff">unsigned long</code>.',
    color: '#ffd700' },
];

function diagnoseError() {
  const input = document.getElementById('errorInput');
  const output = document.getElementById('errorDiagnosis');
  if(!input || !output) return;
  const text = input.value.trim();
  if(!text) {
    output.innerHTML = '<span style="color:var(--muted);">// Paste an error message above to get a diagnosis...</span>';
    return;
  }
  const matches = errorPatterns.filter(p => p.pattern.test(text));
  if(matches.length === 0) {
    output.innerHTML = `<span style="color:#ffd700;">🔍 Unknown error. Try:</span><br>
<span style="color:var(--muted);">1. Check the exact line number in the IDE (it's usually highlighted)</span><br>
<span style="color:var(--muted);">2. Look at the line ABOVE the error — that's often the real culprit</span><br>
<span style="color:var(--muted);">3. Search the error message on arduino.cc/en/Reference</span>`;
    return;
  }
  output.innerHTML = matches.map(m => `
    <div style="margin-bottom:.75rem;padding:.75rem;background:rgba(255,71,87,.05);border:1px solid rgba(255,71,87,.15);border-radius:8px;">
      <div style="font-family:'Space Mono',monospace;font-size:.8rem;font-weight:700;color:${m.color};margin-bottom:.4rem;">${m.title}</div>
      <div style="font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--text);line-height:1.6;">💡 Fix: ${m.fix}</div>
    </div>
  `).join('');
}

// New chapter tag style (injected)
(function(){
  const style = document.createElement('style');
  style.textContent = `
    .new-chapter-tag {
      background: linear-gradient(135deg, rgba(124,58,237,.3), rgba(0,212,255,.15)) !important;
      border: 1px solid rgba(124,58,237,.4) !important;
      color: #c084fc !important;
      animation: newTagPulse 3s ease-in-out infinite;
    }
    @keyframes newTagPulse {
      0%,100% { box-shadow: 0 0 0 0 rgba(124,58,237,0); }
      50% { box-shadow: 0 0 12px 2px rgba(124,58,237,.3); }
    }
    @keyframes fadeInLine {
      from { opacity:0; transform:translateX(-8px); }
      to { opacity:1; transform:translateX(0); }
    }
    .output-box { font-family:'JetBrains Mono',monospace; }

    /* ── SCROLL REVEAL ── */
    .reveal {
      opacity: 0;
      transform: translateY(24px);
      transition: opacity .6s ease, transform .6s ease;
    }
    .reveal.visible {
      opacity: 1;
      transform: translateY(0);
    }

    /* ── CIRCUIT CANVAS ANIMATION OVERLAY ── */
    .circuit-canvas-wrap::after {
      content: '⚡ Live Simulation';
      position: absolute;
      top: 8px; right: 12px;
      font-family: 'Space Mono', monospace;
      font-size: .6rem;
      color: var(--green);
      opacity: .6;
      letter-spacing: .1em;
      animation: fadeUpDown 2s ease-in-out infinite;
    }
    @keyframes fadeUpDown { 0%,100%{opacity:.4} 50%{opacity:.9} }

    /* ── COMPONENT CARD PULSE ON SELECT ── */
    .component-card.selected {
      animation: selectedPulse .4s ease;
    }
    @keyframes selectedPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.06); }
      100% { transform: scale(1.04); }
    }

    /* ── QUIZ OPTION SHAKE ── */
    .quiz-opt.wrong {
      animation: shake .4s ease;
    }
    @keyframes shake {
      0%,100%{transform:translateX(0)} 20%{transform:translateX(-8px)} 40%{transform:translateX(8px)} 60%{transform:translateX(-5px)} 80%{transform:translateX(5px)}
    }

    /* ── QUIZ OPTION CORRECT BOUNCE ── */
    .quiz-opt.correct {
      animation: correctBounce .4s ease;
    }
    @keyframes correctBounce {
      0%{transform:translateY(0)} 40%{transform:translateY(-6px)} 70%{transform:translateY(3px)} 100%{transform:translateY(0)}
    }

    /* ── MEMORY BAR ANIMATION ── */
    .memory-bar-fill {
      width: 0% !important;
      transition: width 1.2s cubic-bezier(.34,1.56,.64,1) !important;
    }

    /* ── HERO ARDUINO BOARD TILT ── */
    .arduino-visual {
      animation: boardTilt 6s ease-in-out infinite;
    }
    @keyframes boardTilt {
      0%,100%{transform:rotate(-3deg) translateY(0)}
      50%{transform:rotate(3deg) translateY(-8px)}
    }

    /* ── SECTION TAG ENTRANCE ── */
    .section-tag {
      animation: tagSlideIn .5s ease both;
    }
    @keyframes tagSlideIn {
      from{opacity:0;transform:translateX(-16px)}
      to{opacity:1;transform:translateX(0)}
    }

    /* ── LOOP BOX GLOW ── */
    .loop-box.active {
      animation: boxGlow .3s ease both, activePulse 1s ease infinite alternate;
    }
    @keyframes activePulse {
      from{box-shadow:0 0 8px rgba(0,212,255,.4)}
      to{box-shadow:0 0 24px rgba(0,212,255,.8)}
    }

    /* ── CODE EDITOR SYNTAX HIGHLIGHT ANIMATION ── */
    .kw, .fn, .type, .str, .num, .cmt {
      transition: opacity .15s;
    }

    /* ── FLOW OUTPUT TYPEWRITER ── */
    .flow-output {
      border-left: 3px solid var(--green);
    }

    /* ── ARRAY CELL MODIFIED ANIMATION ── */
    .array-val.modified {
      animation: modifiedFlash .6s ease both;
    }
    @keyframes modifiedFlash {
      0%{transform:scale(1.3);background:rgba(0,255,136,.5)}
      100%{transform:scale(1);background:rgba(0,255,136,.15)}
    }

    /* ── SIM CANVAS BORDER GLOW WHEN RUNNING ── */
    .sim-canvas-wrap.running {
      box-shadow: inset 0 0 0 2px rgba(0,255,136,.2), 0 0 20px rgba(0,255,136,.08);
    }

    /* ── PROGRESS BAR SHIMMER ── */
    .progress-bar {
      background: linear-gradient(90deg, var(--accent), var(--accent3), var(--accent));
      background-size: 200% 100%;
      animation: shimmer 2s linear infinite;
    }
    @keyframes shimmer {
      from{background-position:200% 0}
      to{background-position:-200% 0}
    }

    /* ── BACK TO TOP BOUNCE ── */
    .back-top.show {
      animation: btnBounceIn .3s cubic-bezier(.34,1.56,.64,1);
    }
    @keyframes btnBounceIn {
      from{opacity:0;transform:scale(.5) translateY(20px)}
      to{opacity:1;transform:scale(1) translateY(0)}
    }

    /* ── OP RESULT FLASH ── */
    .op-result-row {
      transition: background .2s, transform .15s;
    }
    .op-result-row:hover {
      background: rgba(0,212,255,.05);
      transform: translateX(3px);
    }

    /* ── SERIAL MONITOR LINE ENTRANCE ── */
    .serial-line {
      animation: fadeInLine .15s ease both;
    }

    /* ── CARD ENTRANCE STAGGER ── */
    .cards-grid .card:nth-child(1){animation-delay:.05s}
    .cards-grid .card:nth-child(2){animation-delay:.1s}
    .cards-grid .card:nth-child(3){animation-delay:.15s}
    .cards-grid .card:nth-child(4){animation-delay:.2s}
    .cards-grid .card:nth-child(5){animation-delay:.25s}
    .cards-grid .card:nth-child(6){animation-delay:.3s}

    /* ── TOOLTIP FADE ── */
    .spec-tag {
      transition: all .2s;
    }
    .spec-tag:hover {
      background: rgba(0,212,255,.2);
      border-color: rgba(0,212,255,.5);
      transform: scale(1.05);
    }

    /* ── ERROR CARD HOVER GLOW ── */
    .error-card:hover {
      box-shadow: 0 8px 30px rgba(255,71,87,.12);
    }

    /* ── LIB CARD SHIMMER ── */
    .lib-card:hover .lib-name {
      animation: textGlow .4s ease;
    }
    @keyframes textGlow {
      0%,100%{text-shadow:none}
      50%{text-shadow:0 0 8px var(--accent)}
    }

    /* ── FLOATING CIRCUIT ANIMATION ENHANCEMENT ── */
    @keyframes circuitFloat {
      0%,100%{filter:brightness(1)}
      50%{filter:brightness(1.15)}
    }

    /* ── CANVAS CROSSHAIR FOR INTERACTABLE ── */
    canvas.simCanvas { cursor: crosshair; }

    /* ── HIGHLIGHT BOX GLOW ON HOVER ── */
    .highlight-box {
      transition: border-color .3s, box-shadow .3s;
    }
    .highlight-box:hover {
      border-color: rgba(0,212,255,.3);
      box-shadow: 0 4px 20px rgba(0,212,255,.06);
    }

    /* ── ANALOGY CARD EMOJI SPIN ── */
    .analogy-card:hover .analogy-emoji {
      animation: emojiSpin .5s ease;
    }
    @keyframes emojiSpin {
      0%{transform:rotate(0deg) scale(1)}
      30%{transform:rotate(-15deg) scale(1.1)}
      70%{transform:rotate(10deg) scale(1.1)}
      100%{transform:rotate(0deg) scale(1)}
    }

    /* ── QUIZ SCORE CELEBRATION ── */
    .quiz-complete.show .quiz-final-score {
      animation: scoreCountUp .8s cubic-bezier(.34,1.56,.64,1) both;
    }
    @keyframes scoreCountUp {
      from{transform:scale(0) rotate(-10deg);opacity:0}
      to{transform:scale(1) rotate(0deg);opacity:1}
    }

    /* ── STEP BUILDER ACTIVE GLOW ── */
    .builder-step.active .step-circle {
      animation: circleGlow 1.5s ease-in-out infinite;
    }
    @keyframes circleGlow {
      0%,100%{box-shadow:0 0 0 0 rgba(0,212,255,.4)}
      50%{box-shadow:0 0 0 8px rgba(0,212,255,0)}
    }

    /* ── PROJECT CARD SHIMMER ── */
    .project-card:hover .project-icon {
      animation: iconBounce .4s ease;
    }
    @keyframes iconBounce {
      0%,100%{transform:translateY(0)}
      40%{transform:translateY(-8px)}
      70%{transform:translateY(4px)}
    }

    /* ── SECTION DIVIDER PULSE ── */
    .section-divider {
      background: linear-gradient(90deg, transparent, var(--border), transparent);
      background-size: 200% 100%;
      animation: dividerShimmer 4s linear infinite;
    }
    @keyframes dividerShimmer {
      from{background-position:-200% 0}
      to{background-position:200% 0}
    }

    /* ── OUTPUT BOX TYPEWRITER CURSOR ── */
    .output-box::after {
      content: '▋';
      animation: blink .8s step-end infinite;
      color: var(--green);
    }

    /* ── NAV LINK ACTIVE ── */
    .nav-links a.active {
      color: var(--accent);
      background: rgba(0,212,255,.1);
      border-radius: 6px;
    }
    .nav-links a {
      transition: all .2s;
      border-radius: 6px;
    }

    /* ── QUIZ OPTION KEY HINT ── */
    .quiz-opt { width: 100%; }
    .opt-key-hint {
      font-size: .6rem;
      color: var(--muted);
      font-family: 'Space Mono', monospace;
      opacity: 0;
      transition: opacity .2s;
    }
    .quiz-opt:hover .opt-key-hint { opacity: 0.6; }

    /* ── KEYBOARD SHORTCUT TOAST ── */
    #kbToast {
      position: fixed;
      bottom: 5rem;
      right: 1.5rem;
      background: rgba(10,14,26,.95);
      border: 1px solid rgba(0,212,255,.2);
      border-radius: 10px;
      padding: .6rem 1rem;
      font-family: 'Space Mono', monospace;
      font-size: .7rem;
      color: var(--muted);
      z-index: 9999;
      opacity: 0;
      transform: translateY(8px);
      transition: opacity .3s, transform .3s;
      pointer-events: none;
      line-height: 1.7;
    }
    #kbToast.show { opacity: 1; transform: translateY(0); }
    #kbToast kbd {
      background: rgba(0,212,255,.12);
      border: 1px solid rgba(0,212,255,.25);
      border-radius: 3px;
      padding: .1rem .35rem;
      color: var(--accent);
      font-family: 'Space Mono', monospace;
      font-size: .65rem;
    }

    /* ── SMOOTH SECTION TRANSITIONS ── */
    section { scroll-margin-top: 80px; }

    /* ── LOOP BOX DONE STYLE ── */
    .loop-box.done {
      background: rgba(0,255,136,.15) !important;
      border-color: var(--green) !important;
      color: var(--green) !important;
    }

    /* ── SERIAL INPUT FOCUS GLOW ── */
    .serial-input:focus {
      border-color: var(--accent) !important;
      box-shadow: 0 0 0 2px rgba(0,212,255,.15) !important;
    }

    /* ── SIM SPEED SLIDER STYLE ── */
    #simSpeed {
      accent-color: var(--accent);
    }

    /* ── COPY BUTTON HOVER ── */
    .copy-code-btn:hover {
      background: rgba(0,212,255,.2) !important;
      border-color: rgba(0,212,255,.4) !important;
      transform: scale(1.05);
    }

    /* ── EDITOR TAB ACTIVE INDICATOR ── */
    .editor-tab-btn.active {
      position: relative;
    }
    .editor-tab-btn.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 10%;
      width: 80%;
      height: 2px;
      background: var(--accent);
      border-radius: 2px;
    }

    /* ── CARD HOVER LIFT ── */
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 32px rgba(0,0,0,.4), 0 0 0 1px rgba(0,212,255,.08);
    }
    .card { transition: transform .2s, box-shadow .2s; }

    /* ── OHMS CALCULATOR RESULT VISIBLE ── */
    .calc-result.visible {
      animation: fadeInUp .3s ease both;
    }
    @keyframes fadeInUp {
      from { opacity:0; transform:translateY(8px); }
      to   { opacity:1; transform:translateY(0); }
    }

    /* ── IMPROVE TOOLTIP ON HOVER ── */
    button[title]:hover::after {
      content: attr(title);
      position: absolute;
      bottom: 110%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(10,14,26,.95);
      border: 1px solid rgba(0,212,255,.2);
      color: var(--text);
      font-size: .65rem;
      font-family: 'Space Mono', monospace;
      white-space: nowrap;
      padding: .3rem .6rem;
      border-radius: 6px;
      pointer-events: none;
      z-index: 100;
    }
    button[title] { position: relative; }

    /* ── MOBILE NAV TOGGLE ── */
    .nav-toggle {
      display: none;
      background: none;
      border: 1px solid rgba(0,212,255,.3);
      border-radius: 8px;
      color: var(--accent);
      cursor: pointer;
      padding: .4rem .6rem;
      font-size: 1rem;
    }
    @media(max-width:768px) {
      .nav-toggle { display: block; }
      .nav-links {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: rgba(10,14,26,.98);
        border-bottom: 1px solid var(--border);
        padding: .5rem 1rem 1rem;
        flex-direction: column;
        gap: .25rem;
      }
      .nav-links.open { display: flex; }
      nav { position: relative; }
    }
  `;
  document.head.appendChild(style);
})();

// ═══════════════════════════════════════════════════
//  KEYBOARD SHORTCUT TOAST
// ═══════════════════════════════════════════════════
(function(){
  const toast = document.createElement('div');
  toast.id = 'kbToast';
  toast.innerHTML = `
    <div style="color:var(--accent);font-weight:700;margin-bottom:.3rem;">⌨ Keyboard Shortcuts</div>
    <div><kbd>R</kbd> Run / Pause simulator</div>
    <div><kbd>S</kbd> Stop simulator</div>
    <div><kbd>←</kbd><kbd>→</kbd> Switch sketch</div>
    <div><kbd>1</kbd>–<kbd>4</kbd> Answer quiz</div>
    <div><kbd>Enter</kbd> Next question</div>
  `;
  document.body.appendChild(toast);

  let toastTimeout;
  let shown = false;
  // Show once when user first interacts with simulator area
  const simSection = document.getElementById('code');
  if(simSection) {
    const obs = new IntersectionObserver(entries => {
      if(entries[0].isIntersecting && !shown) {
        shown = true;
        setTimeout(() => {
          toast.classList.add('show');
          toastTimeout = setTimeout(() => toast.classList.remove('show'), 4000);
        }, 800);
        obs.disconnect();
      }
    }, { threshold: 0.5 });
    obs.observe(simSection);
  }
  // Also show on ? key press
  document.addEventListener('keydown', e => {
    if(e.key==='?' || (e.key==='/' && e.shiftKey)) {
      clearTimeout(toastTimeout);
      toast.classList.add('show');
      toastTimeout = setTimeout(() => toast.classList.remove('show'), 4000);
    }
  });
})();

// ═══════════════════════════════════════════════════
//  MOBILE NAV — close on link click
// ═══════════════════════════════════════════════════
(function(){
  document.querySelectorAll('.nav-links a').forEach(a => {
    a.addEventListener('click', () => {
      const navLinks = document.querySelector('.nav-links');
      const toggle = document.getElementById('navToggle');
      if(navLinks) navLinks.classList.remove('open');
      if(toggle) toggle.textContent = '☰';
    });
  });
})();

// ═══════════════════════════════════════════════════
//  SMOOTH INPUT FEEDBACK — sliders show live values
// ═══════════════════════════════════════════════════
(function(){
  // Live speed display for loop demo slider (auto-creates label)
  const ls = document.getElementById('loopSpeedSlider');
  if(ls) {
    const lsLabel = document.createElement('span');
    lsLabel.style.cssText = 'font-family:Space Mono,monospace;font-size:.7rem;color:var(--accent);margin-left:.4rem;';
    lsLabel.textContent = Math.round(ls.value/800*100)+'%';
    ls.parentNode.appendChild(lsLabel);
    ls.addEventListener('input', ()=>lsLabel.textContent = Math.round(ls.value/800*100)+'%');
  }
  const fls = document.getElementById('forLoopSpeed');
  if(fls) {
    const flsLabel = document.createElement('span');
    flsLabel.style.cssText = 'font-family:Space Mono,monospace;font-size:.7rem;color:var(--accent);margin-left:.4rem;';
    flsLabel.textContent = Math.round(fls.value/900*100)+'%';
    fls.parentNode.appendChild(flsLabel);
    fls.addEventListener('input', ()=>flsLabel.textContent = Math.round(fls.value/900*100)+'%');
  }
})();

// ═══════════════════════════════════════════════════
//  QUIZ ANSWER ANIMATIONS (correct bounce, wrong shake)
// ═══════════════════════════════════════════════════
(function(){
  const style = document.createElement('style');
  style.textContent = `
    @keyframes bounceIn {
      0%  { transform: scale(1); }
      40% { transform: scale(1.05); }
      70% { transform: scale(.97); }
      100%{ transform: scale(1); }
    }
    @keyframes shakeX {
      0%,100%{ transform:translateX(0); }
      20%    { transform:translateX(-6px); }
      40%    { transform:translateX(6px); }
      60%    { transform:translateX(-4px); }
      80%    { transform:translateX(4px); }
    }
    .quiz-opt.correct { animation: bounceIn .4s ease both !important; }
    .quiz-opt.wrong   { animation: shakeX  .4s ease both !important; }
    .quiz-next.show   { animation: fadeInUp .3s ease both; }
    @keyframes fadeInUp {
      from { opacity:0; transform:translateY(8px); }
      to   { opacity:1; transform:translateY(0); }
    }
    /* Sim canvas tooltip hint */
    .sim-canvas-wrap::before {
      content: '⌨ R = Run  S = Stop  ←→ = Switch';
      position: absolute;
      top: 8px;
      left: 50%;
      transform: translateX(-50%);
      font-family: 'Space Mono', monospace;
      font-size: .6rem;
      color: rgba(0,212,255,.4);
      pointer-events: none;
      white-space: nowrap;
      z-index: 2;
    }
  `;
  document.head.appendChild(style);
})();
</script>
</body>
</html>
